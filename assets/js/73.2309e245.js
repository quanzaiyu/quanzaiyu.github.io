(window.webpackJsonp=window.webpackJsonp||[]).push([[73],{601:function(t,a,s){"use strict";s.r(a);var e=s(1),r=Object(e.a)({},function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("div",{staticClass:"content"},[t._m(0),t._v(" "),t._m(1),t._v(" "),s("p",[t._v("数据卷（Data Volume）是一个经过特殊设计的目录，可以绕过联合文件系统（UFS），为一个或多个容器提供访问。")]),t._v(" "),s("p",[t._v("数据卷设计的目的，在于数据的永久化，它完全独立于容器的生存周期，因此，Docker 不会再容器删除时删除其挂载的数据卷，也不会存在类似的垃圾回收机制对容器应用的数据卷进行删除处理。")]),t._v(" "),s("imgLink",{attrs:{src:"date/20181026/004.png/small"}}),t._v(" "),s("p",[t._v("数据卷的特点：")]),t._v(" "),t._m(2),t._v(" "),t._m(3),t._v(" "),s("p",[t._v("使用 -v（--volume） 选项为容器添加数据卷：")]),t._v(" "),t._m(4),t._m(5),t._v(" "),t._m(6),t._v(" "),t._m(7),t._m(8),t._v(" "),t._m(9),t._v(" "),t._m(10),t._v(" "),s("p",[t._v("在使用 Dockerfile 构建包含数据卷的镜像：")]),t._v(" "),t._m(11),s("p",[t._v("注意，使用 VOLUME 指令需要提供一个数组，指定的都是容器中的路径，在容器启动时不需要添加 -v 指令，系统会自动分配一个宿主机的目录映射到指定的数据卷目录。")]),t._v(" "),t._m(12),t._v(" "),s("p",[t._v("命名的容器挂载数据卷，其他容器通过挂载这个容器实现数据共享，挂载数据卷的容器就叫做数据卷容器。")]),t._v(" "),s("imgLink",{attrs:{src:"date/20181026/005.png/small"}}),t._v(" "),s("p",[t._v("挂载数据卷容器的方法：")]),t._v(" "),t._m(13),s("p",[t._v("通过数据卷容器，可以在不暴露宿主机映射目录的情况下，使用已知容器创建的数据卷。")]),t._v(" "),t._m(14),t._v(" "),s("p",[t._v("默认情况下，删除挂载了数据卷的容器并不会删除数据卷，但可以使用以下命令来达到删除容器的同时并删除数据卷的目的：")]),t._v(" "),t._m(15),t._m(16),t._v(" "),s("p",[t._v("通过以下命令进行数据卷备份：")]),t._v(" "),t._m(17),s("imgLink",{attrs:{src:"date/20181026/006.png/small"}}),t._v(" "),s("p",[t._v("比如：")]),t._v(" "),t._m(18),t._m(19),t._v(" "),t._m(20),t._v(" "),t._m(21)],1)},[function(){var t=this.$createElement,a=this._self._c||t;return a("h1",{attrs:{id:"docker-数据管理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker-数据管理","aria-hidden":"true"}},[this._v("#")]),this._v(" Docker 数据管理")])},function(){var t=this.$createElement,a=this._self._c||t;return a("h2",{attrs:{id:"数据卷"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#数据卷","aria-hidden":"true"}},[this._v("#")]),this._v(" 数据卷")])},function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ul",[s("li",[t._v("数据卷在容器启动时初始化，如果容器使用的镜像在挂载点包含了数据，这些数据会拷贝到新初始化的数据卷中")]),t._v(" "),s("li",[t._v("数据卷存在于宿主机中，可宿主机与容器进行共享")]),t._v(" "),s("li",[t._v("数据卷可以在容器间共享和重用")]),t._v(" "),s("li",[t._v("可以对数据卷里的内容直接进行修改")]),t._v(" "),s("li",[t._v("数据卷的变化不会影响镜像的更新")]),t._v(" "),s("li",[t._v("卷会一直存在，即使挂载数据卷的容器已经被删除")])])},function(){var t=this.$createElement,a=this._self._c||t;return a("h2",{attrs:{id:"添加数据卷"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#添加数据卷","aria-hidden":"true"}},[this._v("#")]),this._v(" 添加数据卷")])},function(){var t=this.$createElement,a=this._self._c||t;return a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[this._v("$ docker run --name server -v ~/data_volume:/data -it ubuntu /bin/bash\n")])]),this._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[this._v("1")]),a("br")])])},function(){var t=this.$createElement,a=this._self._c||t;return a("p",[this._v("其中 "),a("code",[this._v("~/container_data")]),this._v(" 为宿主机上的目录，"),a("code",[this._v("/data")]),this._v(" 为容器中映射的目录。")])},function(){var t=this.$createElement,a=this._self._c||t;return a("h2",{attrs:{id:"指定访问权限"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#指定访问权限","aria-hidden":"true"}},[this._v("#")]),this._v(" 指定访问权限")])},function(){var t=this.$createElement,a=this._self._c||t;return a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[this._v("$ docker run --name server -v ~/data_volume:/data:ro -it ubuntu /bin/bash\n")])]),this._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[this._v("1")]),a("br")])])},function(){var t=this.$createElement,a=this._self._c||t;return a("p",[this._v("在创建容器的时候，可以在数据卷映射参数后面加上访问权限，比如上面的 "),a("code",[this._v("ro")]),this._v("，是只读权限。")])},function(){var t=this.$createElement,a=this._self._c||t;return a("ul",[a("li",[a("code",[this._v("ro")]),this._v(" read only")]),this._v(" "),a("li",[a("code",[this._v("rw")]),this._v(" read write")])])},function(){var t=this.$createElement,a=this._self._c||t;return a("h2",{attrs:{id:"dockerfile-配置数据卷"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#dockerfile-配置数据卷","aria-hidden":"true"}},[this._v("#")]),this._v(" Dockerfile 配置数据卷")])},function(){var t=this.$createElement,a=this._self._c||t;return a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[this._v('VOLUME["volumePath1"]\n')])]),this._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[this._v("1")]),a("br")])])},function(){var t=this.$createElement,a=this._self._c||t;return a("h2",{attrs:{id:"数据卷容器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#数据卷容器","aria-hidden":"true"}},[this._v("#")]),this._v(" 数据卷容器")])},function(){var t=this.$createElement,a=this._self._c||t;return a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[this._v("$ docker run --volumes-from "),a("span",{attrs:{class:"token punctuation"}},[this._v("[")]),this._v("CONTAINER NAME"),a("span",{attrs:{class:"token punctuation"}},[this._v("]")]),this._v("\n")])]),this._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[this._v("1")]),a("br")])])},function(){var t=this.$createElement,a=this._self._c||t;return a("h2",{attrs:{id:"删除数据卷"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#删除数据卷","aria-hidden":"true"}},[this._v("#")]),this._v(" 删除数据卷")])},function(){var t=this.$createElement,a=this._self._c||t;return a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[this._v("$ docker rm -v [CONTAINER NAME]\n")])]),this._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[this._v("1")]),a("br")])])},function(){var t=this.$createElement,a=this._self._c||t;return a("h2",{attrs:{id:"数据卷备份还原"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#数据卷备份还原","aria-hidden":"true"}},[this._v("#")]),this._v(" 数据卷备份还原")])},function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("$ docker run --volumes-from "),s("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("container name"),s("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" -v "),s("span",{attrs:{class:"token variable"}},[s("span",{attrs:{class:"token variable"}},[t._v("$(")]),s("span",{attrs:{class:"token function"}},[t._v("pwd")]),s("span",{attrs:{class:"token variable"}},[t._v(")")])]),t._v(":/backup ubuntu "),s("span",{attrs:{class:"token function"}},[t._v("tar")]),t._v(" cvf /backup/backup.tar "),s("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("container data volume"),s("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])])},function(){var t=this.$createElement,a=this._self._c||t;return a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[this._v("$ docker run --volumes-from container1 -v ~/backup:/backup ubuntu "),a("span",{attrs:{class:"token function"}},[this._v("tar")]),this._v(" cvf /backup/backup.tar /data_volume\n")])]),this._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[this._v("1")]),a("br")])])},function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("p",[t._v("以上命令，将使用 "),s("code",[t._v("tar cvf")]),t._v(" 命令将数据卷目录 "),s("code",[t._v("/data_volume")]),t._v(" 打包到 "),s("code",[t._v("/backup/backup.tar")]),t._v("，并使容器中 "),s("code",[t._v("/backup")]),t._v(" 目录与 "),s("code",[t._v("~/backup")]),t._v(" 目录进行关联，达到备份的目的。")])},function(){var t=this.$createElement,a=this._self._c||t;return a("p",[this._v("同样地，也可以使用 "),a("code",[this._v("tar xvf")]),this._v(" 命令以相同的格式还原一个数据卷：")])},function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("$ docker run --volumes-from "),s("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("container name"),s("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" -v "),s("span",{attrs:{class:"token variable"}},[s("span",{attrs:{class:"token variable"}},[t._v("$(")]),s("span",{attrs:{class:"token function"}},[t._v("pwd")]),s("span",{attrs:{class:"token variable"}},[t._v(")")])]),t._v(":/backup ubuntu "),s("span",{attrs:{class:"token function"}},[t._v("tar")]),t._v(" xvf /backup/backup.tar "),s("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("container data volume"),s("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])])}],!1,null,null,null);r.options.__file="Volume.md";a.default=r.exports}}]);