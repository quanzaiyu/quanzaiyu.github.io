(window.webpackJsonp=window.webpackJsonp||[]).push([[681],{499:function(t,e,s){"use strict";s.r(e);var a={props:["slot-key"],mounted(){this.$nextTick(function(){this.$vuepress.$emit("AsyncMarkdownContentMounted",this.slotKey)})}},r=s(0),n=Object(r.a)(a,function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.slotKey}},[s("h1",{attrs:{id:"搭建-ftp-服务器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#搭建-ftp-服务器","aria-hidden":"true"}},[t._v("#")]),t._v(" 搭建 FTP 服务器")]),t._v(" "),s("h2",{attrs:{id:"vsftpd"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#vsftpd","aria-hidden":"true"}},[t._v("#")]),t._v(" vsftpd")]),t._v(" "),s("p",[t._v("vsftpd 是 "),s("code",[t._v("very secure FTP daemon")]),t._v(" 的缩写，安全性是它的一个最大的特点。拥有非常高的安全性需求、带宽限制、良好的可伸缩性、可创建虚拟用户、支持IPv6、速率高等特性。")]),t._v(" "),s("h2",{attrs:{id:"安装"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装","aria-hidden":"true"}},[t._v("#")]),t._v(" 安装")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("yum -y install vsftpd\n")])])]),s("p",[t._v("查看安装位置")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("[root@localhost /]# whereis vsftpd\nvsftpd: /usr/sbin/vsftpd /etc/vsftpd /usr/share/man/man8/vsftpd.8.gz\n")])])]),s("h2",{attrs:{id:"启动与停止"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#启动与停止","aria-hidden":"true"}},[t._v("#")]),t._v(" 启动与停止")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("# 启动\nservice vsftpd start\n\n# 停止\nservice vsftpd stop\n\n# 重启\nservice vsftpd restart\n\n# 设置开机启动\nsystemctl enable vsftpd.service \n\n# 重启 vsftpd 服务\nsystemctl restart vsftpd.service\n\n# 查看 vsftpd 服务的状态\nsystemctl status vsftpd.service\n")])])]),s("p",[t._v("启动后，可以看到系统已经监听了 21 端口：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("netstat -nltp | grep 21\n")])])]),s("p",[t._v("配置好之后，默认可以使用匿名登录。")]),t._v(" "),s("h2",{attrs:{id:"添加防火墙设置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#添加防火墙设置","aria-hidden":"true"}},[t._v("#")]),t._v(" 添加防火墙设置")]),t._v(" "),s("p",[t._v("为 21 端口放行")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("iptables -A INPUT -p tcp --dport 21 -j ACCEPT    # 允许ftp服务的21端口 ( < CentOS7 )\n\nfirewall-cmd --add-service=ftp # 暂时开放ftp服务\n\nfirewall-cmd --add-service=ftp --permanent # 永久开启ftp服务\n\nfirewall-cmd --remove-service=ftp --permanent #  永久关闭ftp服务\n\n# 设置好后重启 firewalld\nsystemctl restart firewalld # 重启 firewalld 服务\n# or\nfirewall-cmd --reload # 重载配置文件\n")])])]),s("p",[t._v("重载配置文件之后不会断掉正在连接的tcp会话，而重启服务则会断开tcp会话")]),t._v(" "),s("h2",{attrs:{id:"selinux-设置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#selinux-设置","aria-hidden":"true"}},[t._v("#")]),t._v(" Selinux 设置")]),t._v(" "),s("p",[t._v("①、查看 ftp 的 Selinux 状态："),s("code",[t._v("sestatus -b | grep ftp")])]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("[root@localhost vsftpd]# sestatus -b | grep ftp\nftpd_anon_write                             off\nftpd_connect_all_unreserved                 off\nftpd_connect_db                             off\nftpd_full_access                            off\nftpd_use_cifs                               off\nftpd_use_fusefs                             off\nftpd_use_nfs                                off\nftpd_use_passive_mode                       off\nhttpd_can_connect_ftp                       off\nhttpd_enable_ftp_server                     off\ntftp_anon_write                             off\ntftp_home_dir                               off\n")])])]),s("p",[t._v("②、在结果中可以看到： ftpd_full_access 等都是  off")]),t._v(" "),s("p",[t._v("③、将这些状态改为 on："),s("code",[t._v("setsebool -P ftpd_full_access on")])]),t._v(" "),s("p",[t._v("④、重启 vsftp 服务："),s("code",[t._v("service vsftpd restart")])]),t._v(" "),s("h2",{attrs:{id:"配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#配置","aria-hidden":"true"}},[t._v("#")]),t._v(" 配置")]),t._v(" "),s("p",[t._v("vsftpd 的配置目录为 "),s("code",[t._v("/etc/vsftpd")]),t._v(" ，包含下列的配置文件：")]),t._v(" "),s("ul",[s("li",[t._v("vsftpd.conf 为主要配置文件")]),t._v(" "),s("li",[t._v("ftpusers 配置禁止访问 FTP 服务器的用户列表")]),t._v(" "),s("li",[t._v("user_list 配置用户访问控制")])]),t._v(" "),s("h3",{attrs:{id:"vsftpd-conf"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#vsftpd-conf","aria-hidden":"true"}},[t._v("#")]),t._v(" vsftpd.conf")]),t._v(" "),s("p",[t._v("禁止匿名登录")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("anonymous_enable=NO\n")])])]),s("p",[t._v("禁止切换根目录")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("chroot_local_user=YES\n")])])]),s("p",[t._v("可写模式")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("[root@localhost vsftpd]# cat /etc/vsftpd/vsftpd.conf | grep write_enable\nwrite_enable=YES\n#anon_mkdir_write_enable=YES\n")])])]),s("p",[t._v("开启监听")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("listen=YES\nlisten_port=21\nlisten_ipv6=NO\n")])])]),s("p",[t._v("禁止 "),s("code",[t._v("ftpusers")]),t._v(" 中的用户访问")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("userlist_enable=NO\n")])])]),s("h2",{attrs:{id:"创建用户"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#创建用户","aria-hidden":"true"}},[t._v("#")]),t._v(" 创建用户")]),t._v(" "),s("p",[t._v("设置FTP用户的账号，例如账号为“ftpuser”，目录为/home/ftpuser，且设置不允许通过ssh登录。")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("useradd -d /home/ftpuser -s /sbin/nologin ftpuser\n")])])]),s("p",[t._v("如果创建用户的时候没有声明不能通过 ssh 访问，可以随后设置")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("usermod -s /sbin/nologin ftpuser\n")])])]),s("p",[t._v("设置账号对应的密码")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("passwd ftpuser\n")])])]),s("p",[t._v("或")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v('echo "password" | passwd ftpuser --stdin\n')])])]),s("p",[t._v("这样一个用户建完，可以用这个登录，记得用普通登录不要用匿名了。登录后默认的路径为 "),s("code",[t._v("/home/ftpuser")]),t._v(" 。")]),t._v(" "),s("h2",{attrs:{id:"为用户分配主目录"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#为用户分配主目录","aria-hidden":"true"}},[t._v("#")]),t._v(" 为用户分配主目录")]),t._v(" "),s("p",[t._v("为用户 ftpuser创建主目录并约定：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("/home/ftper\t为主目录, 该目录不可上传文件 \n/home/ftper/pub\t文件只能上传到该目录下\n")])])]),s("p",[t._v("在 /data 中创建相关的目录")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("mkdir -p /home/ftper/pub\n")])])]),s("p",[t._v("创建登录欢迎文件")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v('echo "Welcome to use FTP service." > /home/ftper/welcome.txt\n')])])]),s("p",[t._v("设置访问权限")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("chmod 555 /home/ftper\nchmod 777 -R /home/ftper/pub\n")])])]),s("p",[t._v("设置为用户的主目录：")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("usermod -d /home/ftper ftper\n")])])])])},[],!1,null,null,null);n.options.__file="README.md";e.default=n.exports}}]);