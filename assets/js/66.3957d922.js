(window.webpackJsonp=window.webpackJsonp||[]).push([[66],{306:function(s,a,t){"use strict";t.r(a);var n={props:["slot-key"]},e=t(0),r=Object(e.a)(n,function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.slotKey}},[t("h1",{attrs:{id:"使用-ssh-登录"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用-ssh-登录","aria-hidden":"true"}},[s._v("#")]),s._v(" 使用 SSH 登录")]),s._v(" "),t("h3",{attrs:{id:"配置虚拟主机"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置虚拟主机","aria-hidden":"true"}},[s._v("#")]),s._v(" 配置虚拟主机")]),s._v(" "),t("p",[s._v("先修改 hosts 文件，位于 "),t("code",[s._v("/etc/hosts")]),s._v("，比如")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ vim /etc/hosts\n192.168.0.15 node1\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("使用 ssh 连接到指定虚拟主机，如果没有秘钥，则或提示输入密码：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ "),t("span",{attrs:{class:"token function"}},[s._v("ssh")]),s._v(" node1\nThe authenticity of host "),t("span",{attrs:{class:"token string"}},[s._v("'node1 (192.168.42.130)'")]),s._v(" can"),t("span",{attrs:{class:"token string"}},[s._v("'t be established.\nECDSA key fingerprint is SHA256:ahhG7mkVk4N5uuIkeXBHoqM6i5i54DRvAeCCf2RJxcM.\nECDSA key fingerprint is MD5:a5:fc:3f:43:70:ec:03:ca:5b:b1:f3:99:01:b9:8c:86.\nAre you sure you want to continue connecting (yes/no)? yes\nWarning: Permanently added '")]),s._v("node1,192.168.42.130"),t("span",{attrs:{class:"token string"}},[s._v("' (ECDSA) to the list of known hosts.\nroot@node1'")]),s._v("s password: \nPermission denied, please try again.\nroot@node1"),t("span",{attrs:{class:"token string"}},[s._v("'s password: \nPermission denied, please try again.\nroot@node1'")]),s._v("s password: \nPermission denied "),t("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("publickey,gssapi-keyex,gssapi-with-mic,password"),t("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(".\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br")])]),t("h3",{attrs:{id:"客户端配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#客户端配置","aria-hidden":"true"}},[s._v("#")]),s._v(" 客户端配置")]),s._v(" "),t("p",[s._v("在客户端使用 "),t("code",[s._v("ssh-keygen -t rsa")]),s._v(" 生成秘钥")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ ssh-keygen\nGenerating public/private rsa key pair.\nEnter "),t("span",{attrs:{class:"token function"}},[s._v("file")]),s._v(" "),t("span",{attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),t("span",{attrs:{class:"token function"}},[s._v("which")]),s._v(" to save the key "),t("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("/root/.ssh/id_rsa"),t("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": \nEnter passphrase "),t("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("empty "),t("span",{attrs:{class:"token keyword"}},[s._v("for")]),s._v(" no passphrase"),t("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": \nEnter same passphrase again: \nYour identification has been saved "),t("span",{attrs:{class:"token keyword"}},[s._v("in")]),s._v(" /root/.ssh/id_rsa.\nYour public key has been saved "),t("span",{attrs:{class:"token keyword"}},[s._v("in")]),s._v(" /root/.ssh/id_rsa.pub.\nThe key fingerprint is:\nSHA256:oGHYvzpaHaFCSxghVKQ5GR6WbZmzm24jMVSOwfMjSmo root@node1\nThe key's randomart image is:\n+---"),t("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("RSA 2048"),t("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v("----+\n"),t("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v("**"),t("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("oo            "),t("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),t("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v("+B*X             "),t("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),t("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(".*% * o          "),t("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),t("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" B.B "),t("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" o         "),t("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),t("span",{attrs:{class:"token operator"}},[s._v("|")]),t("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" + * o S        "),t("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),t("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v("oE + "),t("span",{attrs:{class:"token keyword"}},[s._v(".")]),s._v(" o         "),t("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),t("span",{attrs:{class:"token operator"}},[s._v("|")]),t("span",{attrs:{class:"token keyword"}},[s._v(".")]),s._v(" + "),t("span",{attrs:{class:"token keyword"}},[s._v(".")]),s._v(" o          "),t("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),t("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{attrs:{class:"token keyword"}},[s._v(".")]),s._v(" "),t("span",{attrs:{class:"token operator"}},[s._v("=")]),t("span",{attrs:{class:"token punctuation"}},[s._v("..")]),s._v("           "),t("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),t("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v("  +.o.           "),t("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+----"),t("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("SHA256"),t("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v("-----+\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br")])]),t("p",[s._v("或使用命令 "),t("code",[s._v('ssh-keygen -t rsa -C "你的email地址"')]),s._v(" ，会在 "),t("code",[s._v("~/.ssh/id_rsa.pub")]),s._v(" 生成SSH公钥。")]),s._v(" "),t("h3",{attrs:{id:"服务器端配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#服务器端配置","aria-hidden":"true"}},[s._v("#")]),s._v(" 服务器端配置")]),s._v(" "),t("p",[s._v("生成 key 后，可以直接将公钥复制到服务器，也可使用命令提交到服务器")]),s._v(" "),t("h4",{attrs:{id:"使用命令提交"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用命令提交","aria-hidden":"true"}},[s._v("#")]),s._v(" 使用命令提交")]),s._v(" "),t("p",[s._v("使用 "),t("code",[s._v("ssh-copy-id")]),s._v(" 命令将生成好的秘钥推给服务器，输入一次密码即可：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ ssh-copy-id node1\n/usr/bin/ssh-copy-id: INFO: Source of key"),t("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("s"),t("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" to be installed: "),t("span",{attrs:{class:"token string"}},[s._v('"/root/.ssh/id_rsa.pub"')]),s._v("\n/usr/bin/ssh-copy-id: INFO: attempting to log "),t("span",{attrs:{class:"token keyword"}},[s._v("in")]),s._v(" with the new key"),t("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("s"),t("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(", to filter out any that are already installed\n/usr/bin/ssh-copy-id: INFO: 1 key"),t("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("s"),t("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" remain to be installed -- "),t("span",{attrs:{class:"token keyword"}},[s._v("if")]),s._v(" you are prompted now it is to "),t("span",{attrs:{class:"token function"}},[s._v("install")]),s._v(" the new keys\nroot@node1"),t("span",{attrs:{class:"token string"}},[s._v("'s password: \n\nNumber of key(s) added: 1\n\nNow try logging into the machine, with:   \"ssh '")]),s._v("node1'\"\nand check to "),t("span",{attrs:{class:"token function"}},[s._v("make")]),s._v(" sure that only the key"),t("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("s"),t("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" you wanted were added.\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("p",[s._v("再次登录，不需要输入密码：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ "),t("span",{attrs:{class:"token function"}},[s._v("ssh")]),s._v(" node1\nLast failed login: Wed Oct 24 21:38:38 CST 2018 from node1 on ssh:notty\nThere were 5 failed login attempts since the last successful login.\nLast login: Wed Oct 24 20:18:50 2018 from 192.168.42.1\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("h4",{attrs:{id:"文件内容复制"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#文件内容复制","aria-hidden":"true"}},[s._v("#")]),s._v(" 文件内容复制")]),s._v(" "),t("p",[s._v("在Windows下，没有 "),t("code",[s._v("ssh-copy-id")]),s._v(" 命令，则可以使用文件复制的方式提交到服务器。")]),s._v(" "),t("p",[s._v("将 "),t("code",[s._v("id_rsa.pub")]),s._v(" 文件里面的内容复制，保存到服务器端需要登录的用户根目录下 "),t("code",[s._v(".ssh/authorized_keys")]),s._v(" 文件中，比如 "),t("code",[s._v("/root/.ssh/authorized_keys")]),s._v("、"),t("code",[s._v("/home/user/.ssh/authorized_keys")]),s._v(" 即可。")]),s._v(" "),t("p",[s._v("修改 "),t("code",[s._v("/etc/ssh/sshd_config")]),s._v("，开启 RSA 和 公钥认证")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("RSAAuthentication yes\nPubkeyAuthentication yes\nAuthorizedKeysFile      .ssh/authorized_keys\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("h2",{attrs:{id:"关闭密码验证"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#关闭密码验证","aria-hidden":"true"}},[s._v("#")]),s._v(" 关闭密码验证")]),s._v(" "),t("p",[s._v("为了安全起见，关闭密码认证，修改 "),t("code",[s._v("/etc/ssh/sshd_config")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("PasswordAuthentication no\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("重启 ssh 服务即可")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ systemctl restart sshd\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("此时，就可以在客户端使用私钥进行 SSH 登录")]),s._v(" "),t("imgLink",{attrs:{src:"articles/009.jpg/small"}})],1)},[],!1,null,null,null);r.options.__file="SSH.md";a.default=r.exports}}]);