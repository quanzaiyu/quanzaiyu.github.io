(window.webpackJsonp=window.webpackJsonp||[]).push([[623],{415:function(s,t,a){"use strict";a.r(t);var n={props:["slot-key"]},e=a(0),r=Object(e.a)(n,function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.slotKey}},[a("h1",{attrs:{id:"service-worker-集成"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#service-worker-集成","aria-hidden":"true"}},[s._v("#")]),s._v(" Service Worker 集成")]),s._v(" "),a("p",[s._v("在不同的项目中，Service Worker 有不同的集成方式。甚至可以用插件实现。")]),s._v(" "),a("h2",{attrs:{id:"spa-注册-service-worker"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#spa-注册-service-worker","aria-hidden":"true"}},[s._v("#")]),s._v(" SPA 注册 Service Worker")]),s._v(" "),a("p",[s._v("SPA（Single Page Applications），单页 Web 应用，在工程架构上只有一个 index.html 的入口，站点的内容都是异步请求数据之后在前端渲染的，应用中的页面切换都是在前端路由控制的。")]),s._v(" "),a("p",[s._v("通常会将这个 index.html 部署到 https://yourhost，对于 SPA 的 Service Worker，只会在 index.html 中注册一次，所以我们会将 sw.js 直接放在站点的根目录保证可访问，Service Worker 的 scope 通常就是 /，这样能够控制整个 SPA 的缓存。")]),s._v(" "),a("p",[s._v("SPA 每次路由的切换都是前端渲染的过程，本质上还是在 index.html 上的前端交互，通常 Service Worker 会缓存 SPA 中的 AppShell 所需的静态资源和 index.html。当然有一种情况比较特殊，当用户从 /a 页面切换到 /b 页面，然后这时候刷新页面，此时首先渲染的还是 index.html，在执行 SPA 的路由逻辑之后，通过 SPA 前端路由的处理继续在前端渲染相应的路由对应的 Component。")]),s._v(" "),a("h2",{attrs:{id:"mpa-注册-service-worker"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mpa-注册-service-worker","aria-hidden":"true"}},[s._v("#")]),s._v(" MPA 注册 Service Worker")]),s._v(" "),a("p",[s._v("MPA（Multi Page Applications），多页应用，这种架构的模式在现如今的大型站点非常常见，例如 "),a("a",{attrs:{href:"https://h5.ele.me/",target:"_blank",rel:"noopener noreferrer"}},[s._v("ele.me"),a("OutboundLink")],1),s._v(" 就是采用这种模式来架构的站点，这种站点有常规的 Web App 的特性，但是相比较 SPA 能够承受更重的业务体量，并且利于大型站点的后期维护和扩展。针对 MPA 的 PWA 可以阅读 "),a("a",{attrs:{href:"https://zhuanlan.zhihu.com/p/27853228",target:"_blank",rel:"noopener noreferrer"}},[s._v("饿了么的 PWA 升级实践"),a("OutboundLink")],1),s._v(" 进行更加深入了解。")]),s._v(" "),a("p",[s._v("在这里我们可以更加深入的了解一下 MPA PWA 是如何注册 sw.js 的，MPA 可以理解为是有多个 html 文件对应着多个不同的服务端路由，也就是说 https://yourhost/a 映射到 a.html, https://yourhost/b 映射到 b.html 等等。")]),s._v(" "),a("p",[s._v("那么这种架构下怎么去注册 Service Worker 呢？是不同的页面注册不同的 Service Worker，还是所有的页面都注册同一个 Service Worker？结论是：需要根据实际情况来定。")]),s._v(" "),a("h2",{attrs:{id:"在-vue-js-中集成"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#在-vue-js-中集成","aria-hidden":"true"}},[s._v("#")]),s._v(" 在 Vue.js 中集成")]),s._v(" "),a("p",[s._v("这里假设项目是使用 vue-cli 创建的，模板为 webpack，要集成 service worker。")]),s._v(" "),a("p",[s._v("假设要注册的 service worker 文件名为 "),a("code",[s._v("sw.js")]),s._v("。")]),s._v(" "),a("p",[s._v("首先，我们知道，如果将文件直接放到根目录下，在地址中输入 "),a("code",[s._v("localhost/sw.js")]),s._v(" 是访问不不到的，如果将 sw.js 放到 /static 目录下，倒是可以通过 "),a("code",[s._v("localhost/static/sw.js")]),s._v(" 进行访问，但是，这样的话，service worker 只能收到 /static 路径下的 fetch 事件（例如： /static/page1/, /static/page2/）。")]),s._v(" "),a("p",[s._v("因此，我们得想一个办法，让 service worker 监听到站点下所有路径的 fetch 事件。")]),s._v(" "),a("p",[s._v("我们借助 "),a("code",[s._v("copy-webpack-plugin")]),s._v(" 插件即可完成这个工作。")]),s._v(" "),a("p",[s._v("首先，安装 copy-webpack-plugin")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("yarn add copy-webpack-plugin\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("然后，改动 "),a("code",[s._v("build/webpack.base.conf.js")]),s._v(" 文件：")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[s._v("\n"),a("span",{attrs:{class:"token keyword"}},[s._v("const")]),s._v(" CopyWebpackPlugin "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{attrs:{class:"token function"}},[s._v("require")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token string"}},[s._v("'copy-webpack-plugin'")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),a("span",{attrs:{class:"token comment"}},[s._v("// ...")]),s._v("\n\n"),a("span",{attrs:{class:"token keyword"}},[s._v("const")]),s._v(" originalConfig "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{attrs:{class:"token comment"}},[s._v("// ...")]),s._v("\n  plugins"),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{attrs:{class:"token class-name"}},[s._v("CopyWebpackPlugin")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n      "),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{attrs:{class:"token keyword"}},[s._v("from")]),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" path"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token function"}},[s._v("resolve")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("__dirname"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token string"}},[s._v("'../sw.js'")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        to"),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" config"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("build"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("assetsRoot"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        ignore"),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{attrs:{class:"token string"}},[s._v("'.*'")]),a("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n      "),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),a("span",{attrs:{class:"token comment"}},[s._v("// ...")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br")])]),a("p",[s._v("这样，就可以放心地将 sw.js 存于站点根目录了，webpack 会将此文件复制到 dist 目录下，进行正常的 service worker 注册。")]),s._v(" "),a("p",[s._v("参考："),a("a",{attrs:{href:"https://webpack.js.org/plugins/copy-webpack-plugin/",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://webpack.js.org/plugins/copy-webpack-plugin/"),a("OutboundLink")],1)]),s._v(" "),a("p",[s._v("index.html")]),s._v(" "),a("div",{staticClass:"language-html line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-html"}},[a("code",[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("<")]),s._v("script")]),a("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),a("span",{attrs:{class:"token script language-javascript"}},[s._v("\n  "),a("span",{attrs:{class:"token comment"}},[s._v("// 测试 service worker")]),s._v("\n  "),a("span",{attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token string"}},[s._v("'serviceWorker'")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("in")]),s._v(" navigator"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    navigator"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("serviceWorker"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token function"}},[s._v("register")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token string"}},[s._v("'/sw.js'")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token function"}},[s._v("then")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token keyword"}},[s._v("function")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("registration"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),a("span",{attrs:{class:"token comment"}},[s._v("// Registration was successful")]),s._v("\n      console"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token function"}},[s._v("log")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token string"}},[s._v("'ServiceWorker registration successful with scope: '")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v("    registration"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("scope"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token keyword"}},[s._v("catch")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token keyword"}},[s._v("function")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("err"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),a("span",{attrs:{class:"token comment"}},[s._v("// registration failed :(")]),s._v("\n      console"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token function"}},[s._v("log")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token string"}},[s._v("'ServiceWorker registration failed: '")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" err"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")]),a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("</")]),s._v("script")]),a("span",{attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("p",[s._v("sw.js")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{attrs:{class:"token comment"}},[s._v("/* eslint-disable */")]),s._v("\n"),a("span",{attrs:{class:"token comment"}},[s._v("// Set the callback for the install step")]),s._v("\nself"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token function"}},[s._v("addEventListener")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token string"}},[s._v("'install'")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("function")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("event"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{attrs:{class:"token comment"}},[s._v("// Perform install steps")]),s._v("\n"),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{attrs:{class:"token comment"}},[s._v("// ...")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[s._v("同样的，要加入 manifest.json 也如法炮制：")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{attrs:{class:"token comment"}},[s._v("// ...")]),s._v("\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{attrs:{class:"token class-name"}},[s._v("CopyWebpackPlugin")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n      "),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{attrs:{class:"token keyword"}},[s._v("from")]),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" path"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token function"}},[s._v("resolve")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("__dirname"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token string"}},[s._v("'../sw.js'")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        to"),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" config"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("build"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("assetsRoot\n      "),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{attrs:{class:"token keyword"}},[s._v("from")]),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" path"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{attrs:{class:"token function"}},[s._v("resolve")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("__dirname"),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token string"}},[s._v("'../manifest.json'")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        to"),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" config"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("build"),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v("assetsRoot\n      "),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{attrs:{class:"token comment"}},[s._v("// ...")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br")])]),a("p",[s._v("index.html 引入即可")]),s._v(" "),a("div",{staticClass:"language-html line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-html"}},[a("code",[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token tag"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("<")]),s._v("link")]),s._v(" "),a("span",{attrs:{class:"token attr-name"}},[s._v("rel")]),a("span",{attrs:{class:"token attr-value"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{attrs:{class:"token punctuation"}},[s._v('"')]),s._v("manifest"),a("span",{attrs:{class:"token punctuation"}},[s._v('"')])]),s._v(" "),a("span",{attrs:{class:"token attr-name"}},[s._v("href")]),a("span",{attrs:{class:"token attr-value"}},[a("span",{attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{attrs:{class:"token punctuation"}},[s._v('"')]),s._v("/manifest.json"),a("span",{attrs:{class:"token punctuation"}},[s._v('"')])]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("/>")])]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("h2",{attrs:{id:"在-vuepress-中集成"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#在-vuepress-中集成","aria-hidden":"true"}},[s._v("#")]),s._v(" 在 Vuepress 中集成")]),s._v(" "),a("p",[s._v("在 Vuepress 中集成 PWA 就简单了，在 0.10 版本之后，可以直接在 config.js 配置文件中添加：")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[s._v("serviceWorker"),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("Vuepress 会自动生成并注册 service worker，用户只需要在 .vuepress/public 中添加 "),a("code",[s._v("manifest.json")]),s._v(" 即可。")]),s._v(" "),a("h2",{attrs:{id:"sw-register-webpack-plugin"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#sw-register-webpack-plugin","aria-hidden":"true"}},[s._v("#")]),s._v(" sw-register-webpack-plugin")]),s._v(" "),a("p",[s._v("无论是 Service Worker 作用域问题，还是 Service Worker 的更新问题，都与 Service Worker 的注册息息相关，一个看似简单的 Service Worker 的注册还是有很多地方需要注意，但是如果这些都需要在每个项目中都要自己完全实现一遍，还是非常繁琐的。而 "),a("a",{attrs:{href:"https://github.com/lavas-project/sw-register-webpack-plugin",target:"_blank",rel:"noopener noreferrer"}},[s._v("sw-register-webpack-plugin"),a("OutboundLink")],1),s._v(" 作为一个 Webpack Plugin 很好的帮助我们解决了 优雅的注册 Service Worker 的问题")]),s._v(" "),a("ul",[a("li",[s._v("如果项目是基于 Webpack 开发的")]),s._v(" "),a("li",[s._v("如果不希望自己考虑繁琐的 Service Worker 问题")]),s._v(" "),a("li",[s._v("无论是 SPA 还是 MPA")])]),s._v(" "),a("p",[s._v("基于以上的考虑，都可以尝试一下 sw-register-webpack-plugin")]),s._v(" "),a("p",[s._v("安装")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("yarn add sw-register-webpack-plugin\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("配置 Webpack")]),s._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{attrs:{class:"token comment"}},[s._v("// ...")]),s._v("\n"),a("span",{attrs:{class:"token keyword"}},[s._v("import")]),s._v(" SwRegisterWebpackPlugin "),a("span",{attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),a("span",{attrs:{class:"token string"}},[s._v("'sw-register-webpack-plugin'")]),s._v("\n\n"),a("span",{attrs:{class:"token comment"}},[s._v("// ...")]),s._v("\n\n"),a("span",{attrs:{class:"token function"}},[s._v("webpack")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),a("span",{attrs:{class:"token comment"}},[s._v("// ...")]),s._v("\n  plugins"),a("span",{attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{attrs:{class:"token class-name"}},[s._v("SwReginsterWebpackPlugin")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token comment"}},[s._v("/* options */")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  "),a("span",{attrs:{class:"token comment"}},[s._v("// ...")]),s._v("\n"),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),a("span",{attrs:{class:"token comment"}},[s._v("// ...")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])])])},[],!1,null,null,null);r.options.__file="SW_Integration.md";t.default=r.exports}}]);