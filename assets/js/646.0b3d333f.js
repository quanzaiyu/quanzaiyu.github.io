(window.webpackJsonp=window.webpackJsonp||[]).push([[646],{977:function(t,e,a){"use strict";a.r(e);var s=a(1),n=Object(s.a)({},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"搭建-mongodb-数据库服务器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#搭建-mongodb-数据库服务器","aria-hidden":"true"}},[t._v("#")]),t._v(" 搭建 MongoDB 数据库服务器")]),t._v(" "),a("h2",{attrs:{id:"安装与使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装与使用","aria-hidden":"true"}},[t._v("#")]),t._v(" 安装与使用")]),t._v(" "),a("h3",{attrs:{id:"在-windows-下安装与使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#在-windows-下安装与使用","aria-hidden":"true"}},[t._v("#")]),t._v(" 在 Windows 下安装与使用")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://www.mongodb.com/download-center#community",target:"_blank",rel:"noopener noreferrer"}},[t._v("MongoDB 下载"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://www.mongodb.com/download-center/compass",target:"_blank",rel:"noopener noreferrer"}},[t._v("Compass 下载"),a("OutboundLink")],1)])]),t._v(" "),a("p",[t._v("创建MongoDB存储目录:")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("d:\\\n  MongoDB\n    log\n    db\n")])])]),a("p",[t._v("创建配置文件 "),a("code",[t._v("d:\\MongoDB\\mongod.cfg")]),t._v(":")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("systemLog:\n    destination: file\n    path: d:\\MongoDB\\log\\mongod.log\nstorage:\n    dbPath: d:\\MongoDB\\db\n")])])]),a("p",[t._v("将MongoDB下的bin目录配置到环境变量 "),a("code",[t._v("PATH")]),t._v(" 中, 比如我的 "),a("code",[t._v("C:\\Program Files\\MongoDB\\Server\\4.0\\bin")])]),t._v(" "),a("p",[t._v("执行以下命令进行MongoDB服务的启动:")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("$ mongod --config "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"D:\\MongoDB\\mongod.cfg"')]),t._v(" --install\n2019-04-09T16:41:56.998+0800 I CONTROL  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("main"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" Automatically disabling TLS 1.0, to force-enable TLS 1.0 specify --sslDisabledProtocols "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'none'")]),t._v("\n\n$ net start MongoDB "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 开启MongoDB服务")]),t._v("\n请求的服务已经启动。\n请键入 NET HELPMSG 2182 以获得更多的帮助。\n\n$ net stop MongoDB "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 关闭MongoDB服务")]),t._v("\nMongoDB Server 服务正在停止.\nMongoDB Server 服务已成功停止。\n")])])]),a("p",[t._v("执行 MongoDB Shell 命令")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("$ mongo\nMongoDB shell version v4.0.3\nconnecting to: mongodb://127.0.0.1:27017\nImplicit session: session "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"id"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v(":")]),t._v(" UUID"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"e0052087-15d7-437f-80aa-ed4b2620b2e8"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\nMongoDB server version: 4.0.3\n\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" 2+2\n4\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" db\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("test")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" db.test.insert"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("name: "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"qzy"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nWriteResult"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"nInserted"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v(":")]),t._v(" 1 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" db.test.find"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"_id"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v(":")]),t._v(" ObjectId"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"5cac5ed1306ebb7943a3a618"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"name"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"qzy"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("可以看到, MongoDB 默认使用 27017 端口")]),t._v(" "),a("p",[t._v("可视化工具:")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://nosqlbooster.com/downloads",target:"_blank",rel:"noopener noreferrer"}},[t._v("NoSQL Booster"),a("OutboundLink")],1)])]),t._v(" "),a("imgLink",{attrs:{src:"date/20190410/001.png"}}),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://studio3t.com/download",target:"_blank",rel:"noopener noreferrer"}},[t._v("Studio 3T"),a("OutboundLink")],1)])]),t._v(" "),a("imgLink",{attrs:{src:"date/20190410/002.png"}}),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://github.com/iwind/rockmongo",target:"_blank",rel:"noopener noreferrer"}},[t._v("Rockmongo"),a("OutboundLink")],1)])]),t._v(" "),a("p",[a("strong",[t._v("Studio 3T 破解教程")])]),t._v(" "),a("p",[t._v("此教程并非真正破解，而是通过重置studio 3t的试用时间解决的。每次开机重启脚本重置试用时间")]),t._v(" "),a("p",[t._v("1、创建文件 "),a("code",[t._v("studio3t.bat")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('@echo off\nECHO 重置Studio 3T的使用日期......\nFOR /f "tokens=1,2,* " %%i IN (\'reg query "HKEY_CURRENT_USER\\Software\\JavaSoft\\Prefs\\3t\\mongochef\\enterprise" ^| find /V "installation" ^| find /V "HKEY"\') DO ECHO yes | reg add "HKEY_CURRENT_USER\\Software\\JavaSoft\\Prefs\\3t\\mongochef\\enterprise" /v %%i /t REG_SZ /d ""\nECHO 重置完成, 按任意键退出......\npause>nul\nexit\n')])])]),a("p",[t._v("2、将文件studio3t.bat文件移动到如下路径中")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("C:\\ProgramData\\Microsoft\\Windows\\Start Menu\\Programs\\StartUp\n")])])]),a("h3",{attrs:{id:"在-linux-下安装与使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#在-linux-下安装与使用","aria-hidden":"true"}},[t._v("#")]),t._v(" 在 Linux 下安装与使用")]),t._v(" "),a("p",[t._v("下载安装:")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" -O https://fastdl.mongodb.org/linux/mongodb-linux-x86_64-3.0.6.tgz    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 下载")]),t._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("tar")]),t._v(" -zxvf mongodb-linux-x86_64-3.0.6.tgz                                   "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 解压")]),t._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("mv")]),t._v("  mongodb-linux-x86_64-3.0.6/ /usr/local/mongodb                         "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 将解压包拷贝到指定目录")]),t._v("\n$ "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("export")]),t._v(" PATH"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("mongodb-install-directory"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("/bin:"),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$PATH")]),t._v("                          "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 配置环境变量")]),t._v("\n")])])]),a("p",[a("strong",[t._v("创建数据库目录")])]),t._v(" "),a("p",[t._v("MongoDB的数据存储在data目录的db目录下，但是这个目录在安装过程不会自动创建，所以你需要手动创建data目录，并在data目录中创建db目录。")]),t._v(" "),a("p",[t._v("以下实例中我们将data目录创建于根目录下(/)。")]),t._v(" "),a("p",[t._v("注意：/data/db 是 MongoDB 默认的启动的数据库路径(--dbpath)。")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("mkdir")]),t._v(" -p /data/db\n")])])]),a("p",[t._v("::: tip 注意\n如果你的数据库目录不是/data/db，可以通过 --dbpath 来指定。\n:::")]),t._v(" "),a("p",[t._v("启动服务:")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("$ mongod\n")])])]),a("h3",{attrs:{id:"数据库连接"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#数据库连接","aria-hidden":"true"}},[t._v("#")]),t._v(" 数据库连接")]),t._v(" "),a("p",[t._v("使用URI连接语法:")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("mongodb://username:password@host:port/database?options\n")])])]),a("ul",[a("li",[a("strong",[t._v("username:password@")]),t._v(" 选填，用户名和密码")]),t._v(" "),a("li",[a("strong",[t._v("host")]),t._v(" 服务器地址, 必填")]),t._v(" "),a("li",[a("strong",[t._v("port")]),t._v(" 选填, 默认为27017")]),t._v(" "),a("li",[a("strong",[t._v("database")]),t._v(" 选填, 若不指定，默认打开 test 数据库")]),t._v(" "),a("li",[a("strong",[t._v("options")]),t._v(" 选填, 连接选项")])]),t._v(" "),a("p",[t._v("举例:")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("mongodb://localhost\nmongodb://admin:123456@localhost/test\n")])])]),a("h2",{attrs:{id:"基础概念"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#基础概念","aria-hidden":"true"}},[t._v("#")]),t._v(" 基础概念")]),t._v(" "),a("h3",{attrs:{id:"与-rdbms-对比"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#与-rdbms-对比","aria-hidden":"true"}},[t._v("#")]),t._v(" 与 RDBMS 对比")]),t._v(" "),a("p",[t._v("与 RDBMS （关系数据库管理系统：Relational Database Management System) 的概念对比")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"left"}},[t._v("SQL术语/概念")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("MongoDB术语/概念")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("解释/说明")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("database")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("database")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("数据库")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("table")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("collection")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("数据库表/集合")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("row")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("document")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("数据记录行/文档")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("column")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("field")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("数据字段/域")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("index")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("index")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("索引")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("table joins")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}}),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("表连接,MongoDB不支持")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("primary key")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("primary key")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("主键,MongoDB自动将_id字段设置为主键")])])])]),t._v(" "),a("imgLink",{attrs:{src:"date/20190410/003.png"}}),t._v(" "),a("h2",{attrs:{id:"数据类型"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#数据类型","aria-hidden":"true"}},[t._v("#")]),t._v(" 数据类型")]),t._v(" "),a("p",[t._v("下表为MongoDB中常用的几种数据类型。")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"left"}},[t._v("数据类型")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("描述")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("String")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("字符串。存储数据常用的数据类型。在 MongoDB 中，UTF-8 编码的字符串才是合法的。")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("Integer")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("整型数值。用于存储数值。根据你所采用的服务器，可分为 32 位或 64 位。")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("Boolean")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("布尔值。用于存储布尔值（真/假）。")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("Double")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("双精度浮点值。用于存储浮点值。")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("Min/Max keys")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("将一个值与 BSON（二进制的 JSON）元素的最低值和最高值相对比。")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("Array")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("用于将数组或列表或多个值存储为一个键。")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("Timestamp")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("时间戳。记录文档修改或添加的具体时间。")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("Object")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("用于内嵌文档。")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("Null")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("用于创建空值。")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("Symbol")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("符号。该数据类型基本上等同于字符串类型，但不同的是，它一般用于采用特殊符号类型的语言。")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("Date")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("日期时间。用 UNIX 时间格式来存储当前日期或时间。你可以指定自己的日期时间：创建 Date 对象，传入年月日信息。")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("Object ID")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("对象 ID。用于创建文档的 ID。")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("Binary Data")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("二进制数据。用于存储二进制数据。")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("Code")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("代码类型。用于在文档中存储 JavaScript 代码。")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("Regular expression")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("正则表达式类型。用于存储正则表达式。")])])])]),t._v(" "),a("h3",{attrs:{id:"objectid"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#objectid","aria-hidden":"true"}},[t._v("#")]),t._v(" ObjectId")]),t._v(" "),a("p",[t._v("ObjectId 类似唯一主键，可以很快的去生成和排序，包含 12 bytes，含义是：")]),t._v(" "),a("ul",[a("li",[t._v("前 4 个字节表示创建 unix 时间戳,格林尼治时间 UTC 时间，比北京时间晚了 8 个小时")]),t._v(" "),a("li",[t._v("接下来的 3 个字节是机器标识码")]),t._v(" "),a("li",[t._v("紧接的两个字节由进程 id 组成 PID")]),t._v(" "),a("li",[t._v("最后三个字节是随机数")])]),t._v(" "),a("imgLink",{attrs:{src:"date/20190410/004.png"}}),t._v(" "),a("p",[t._v("MongoDB 中存储的文档必须有一个 _id 键。这个键的值可以是任何类型的，默认是个 ObjectId 对象")]),t._v(" "),a("h3",{attrs:{id:"日期时间"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#日期时间","aria-hidden":"true"}},[t._v("#")]),t._v(" 日期时间")]),t._v(" "),a("p",[t._v("表示当前距离 Unix新纪元（1970年1月1日）的毫秒数。日期类型是有符号的, 负数表示 1970 年之前的日期。")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('> var mydate1 = new Date() //格林尼治时间\n> mydate1\nISODate("2019-03-04T14:58:51.233Z")\n> typeof mydate1\nobject\n\n> var mydate2 = ISODate() //格林尼治时间\n> mydate2\nISODate("2019-03-04T15:00:45.479Z")\n> typeof mydate2\nobject\n\n> var mydate1str = mydate1.toString()\n> mydate1str\nSun Mar 04 2018 14:58:51 GMT+0000 (UTC)\n> typeof mydate1str\nstring\n\n> Date()\nSun Mar 04 2018 15:02:59 GMT+0000 (UTC)\n')])])]),a("p",[t._v("由于 ObjectId 中保存了创建的时间戳，所以你不需要为你的文档保存时间戳字段，可以通过 getTimestamp 函数来获取文档的创建时间:")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('> var newObject = ObjectId()\n> newObject\nObjectId("5cad684f48d6ea2451373cd1")\n\n> newObject.getTimestamp()\nISODate("2017-11-25T07:21:10Z")\n\n> newObject.str\n5cad684f48d6ea2451373cd1\n\n> newObject.toString()\nObjectId("5cad684f48d6ea2451373cd1")\n\n> typeof newObject\nobject\n')])])]),a("h2",{attrs:{id:"数据库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#数据库","aria-hidden":"true"}},[t._v("#")]),t._v(" 数据库")]),t._v(" "),a("p",[t._v("数据库通过名字来标识。数据库名可以是满足以下条件的任意UTF-8字符串。")]),t._v(" "),a("ul",[a("li",[t._v('不能是空字符串（"")。')]),t._v(" "),a("li",[t._v("不得含有' '（空格)、.、$、/、\\和\\0 (空字符)。")]),t._v(" "),a("li",[t._v("应全部小写。")]),t._v(" "),a("li",[t._v("最多64字节。")])]),t._v(" "),a("p",[t._v("有一些数据库名是保留的，可以直接访问这些有特殊作用的数据库。")]),t._v(" "),a("ul",[a("li",[t._v('admin： 从权限的角度来看，这是"root"数据库。要是将一个用户添加到这个数据库，这个用户自动继承所有数据库的权限。一些特定的服务器端命令也只能从这个数据库运行，比如列出所有的数据库或者关闭服务器。')]),t._v(" "),a("li",[t._v("local: 这个数据永远不会被复制，可以用来存储限于本地单台服务器的任意集合")]),t._v(" "),a("li",[t._v("config: 当Mongo用于分片设置时，config数据库在内部使用，用于保存分片的相关信息。")])]),t._v(" "),a("h3",{attrs:{id:"查看所有数据库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看所有数据库","aria-hidden":"true"}},[t._v("#")]),t._v(" 查看所有数据库")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("> show dbs\nadmin   0.000GB\nconfig  0.000GB\nlocal   0.000GB\ntest    0.000GB\n")])])]),a("h3",{attrs:{id:"切换-创建数据库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#切换-创建数据库","aria-hidden":"true"}},[t._v("#")]),t._v(" 切换/创建数据库")]),t._v(" "),a("p",[t._v("语法: "),a("code",[t._v("use DATABASE_NAME")])]),t._v(" "),a("p",[t._v("切换/创建数据库(如果没有则自动创建)")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('> use test1 # 创建数据库\nswitched to db test1\n> db // 查看当前数据库\ntest1\n> show dbs # 仍然看不到test1数据库\nadmin   0.000GB\nconfig  0.000GB\nlocal   0.000GB\ntest    0.000GB\n\n> db.a.insert({b: 3}) # 插入一条数据即可看到test1数据库\nWriteResult({ "nInserted" : 1 })\n> show dbs\nadmin   0.000GB\nconfig  0.000GB\nlocal   0.000GB\ntest    0.000GB\ntest1   0.000GB\n')])])]),a("h3",{attrs:{id:"删除数据库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#删除数据库","aria-hidden":"true"}},[t._v("#")]),t._v(" 删除数据库")]),t._v(" "),a("p",[t._v("语法: "),a("code",[t._v("db.dropDatabase()")])]),t._v(" "),a("p",[t._v("首先进入到指定数据库, 相当于清空数据库")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('> db.dropDatabase()\n{ "dropped" : "test1", "ok" : 1 }\n')])])]),a("h2",{attrs:{id:"集合"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#集合","aria-hidden":"true"}},[t._v("#")]),t._v(" 集合")]),t._v(" "),a("p",[t._v("集合就是 MongoDB 文档组，类似于 RDBMS （关系数据库管理系统：Relational Database Management System)中的表格。")]),t._v(" "),a("p",[t._v("集合存在于数据库中，集合没有固定的结构，这意味着你在对集合可以插入不同格式和类型的数据，但通常情况下我们插入集合的数据都会有一定的关联性。")]),t._v(" "),a("p",[t._v("当第一个文档插入时，集合就会被创建。")]),t._v(" "),a("ul",[a("li",[t._v("合法的集合名")]),t._v(" "),a("li",[t._v('集合名不能是空字符串""。')]),t._v(" "),a("li",[t._v("集合名不能含有\\0字符（空字符)，这个字符表示集合名的结尾。")]),t._v(" "),a("li",[t._v('集合名不能以"system."开头，这是为系统集合保留的前缀。')]),t._v(" "),a("li",[t._v("用户创建的集合名字不能含有保留字符。有些驱动程序的确支持在集合名里面包含，这是因为某些系统生成的集合中包含该字符。除非你要访问这种系统创建的集合，否则千万不要在名字里出现$。")])]),t._v(" "),a("h3",{attrs:{id:"创建集合"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建集合","aria-hidden":"true"}},[t._v("#")]),t._v(" 创建集合")]),t._v(" "),a("p",[t._v("语法: "),a("code",[t._v("db.createCollection(name, options)")])]),t._v(" "),a("p",[t._v("options 包括如下参数:")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("字段")]),t._v(" "),a("th",[t._v("类型")]),t._v(" "),a("th",[t._v("描述")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("capped")]),t._v(" "),a("td",[t._v("布尔")]),t._v(" "),a("td",[t._v("（可选）如果为 true，则创建固定集合。固定集合是指有着固定大小的集合，当达到最大值时，它会自动覆盖最早的文档。 "),a("strong",[t._v("当该值为 true 时，必须指定 size 参数。")])])]),t._v(" "),a("tr",[a("td",[t._v("autoIndexId")]),t._v(" "),a("td",[t._v("布尔")]),t._v(" "),a("td",[t._v("（可选）如为 true，自动在 _id 字段创建索引。默认为 false。")])]),t._v(" "),a("tr",[a("td",[t._v("size")]),t._v(" "),a("td",[t._v("数值")]),t._v(" "),a("td",[t._v("（可选）为固定集合指定一个最大值（以字节计）。 "),a("strong",[t._v("如果 capped 为 true，也需要指定该字段。")])])]),t._v(" "),a("tr",[a("td",[t._v("max")]),t._v(" "),a("td",[t._v("数值")]),t._v(" "),a("td",[t._v("（可选）指定固定集合中包含文档的最大数量。")])])])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('> db.createCollection(\'x\')\n{ "ok" : 1 }\n> db.createCollection("mycol", { capped: true, autoIndexId: true, size: 6142800, max: 10000 } )\n> show collections\nx\nmycol\n')])])]),a("p",[t._v("在MongoDB中, 不需要显式创建集合, 在插入数据的时候即可自动创建:")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('> db.a.insert({b: 3}) # 插入一条文档即可看到test1数据库\nWriteResult({ "nInserted" : 1 })\n> show collections\na\n')])])]),a("h3",{attrs:{id:"删除集合"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#删除集合","aria-hidden":"true"}},[t._v("#")]),t._v(" 删除集合")]),t._v(" "),a("p",[t._v("语法: "),a("code",[t._v("db.collection.drop()")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("> db.a.drop()\ntrue\n")])])]),a("h2",{attrs:{id:"文档"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#文档","aria-hidden":"true"}},[t._v("#")]),t._v(" 文档")]),t._v(" "),a("p",[t._v("文档是一组键值(key-value)对(即 BSON, 是一种类似 JSON 的二进制形式的存储格式，是 Binary JSON 的简称)。MongoDB 的文档不需要设置相同的字段，并且相同的字段不需要相同的数据类型，这与关系型数据库有很大的区别，也是 MongoDB 非常突出的特点。")]),t._v(" "),a("p",[t._v("注意：")]),t._v(" "),a("ul",[a("li",[t._v("文档中的键/值对是有序的。")]),t._v(" "),a("li",[t._v("文档中的值不仅可以是在双引号里面的字符串，还可以是其他几种数据类型（甚至可以是整个嵌入的文档)。")]),t._v(" "),a("li",[t._v("MongoDB区分类型和大小写。")]),t._v(" "),a("li",[t._v("MongoDB的文档不能有重复的键。")]),t._v(" "),a("li",[t._v("文档的键是字符串。除了少数例外情况，键可以使用任意UTF-8字符。")])]),t._v(" "),a("p",[t._v("文档键命名规范：")]),t._v(" "),a("ul",[a("li",[t._v("键不能含有\\0 (空字符)。这个字符用来表示键的结尾。")]),t._v(" "),a("li",[t._v(".和$有特别的意义，只有在特定环境下才能使用。")]),t._v(" "),a("li",[t._v('以下划线"_"开头的键是保留的(不是严格要求的)。')])]),t._v(" "),a("h3",{attrs:{id:"插入文档"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#插入文档","aria-hidden":"true"}},[t._v("#")]),t._v(" 插入文档")]),t._v(" "),a("p",[t._v("MongoDB 使用 insert() 或 save() 方法向集合中插入文档")]),t._v(" "),a("p",[t._v("语法: "),a("code",[t._v("db.COLLECTION_NAME.insert(document)")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('> db.col.insert({ name: \'qzy\', age: 23 })\nWriteResult({ "nInserted" : 1 })\n> db.col.find()\n{ "_id" : ObjectId("5cad8f8748d6ea2451373cd7"), "name" : "qzy", "age" : 23 }\n')])])]),a("p",[t._v("先定义变量, 再进行插入:")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('> doc = {name: \'qiaoer\', age: 22}\n{ "name" : "qiaoer", "age" : 22 }\n> db.col.insert(doc)\nWriteResult({ "nInserted" : 1 })\n> db.col.find()\n{ "_id" : ObjectId("5cad8f8748d6ea2451373cd7"), "name" : "qzy", "age" : 23 }\n{ "_id" : ObjectId("5cad8ff848d6ea2451373cd8"), "name" : "qiaoer", "age" : 22 }\n')])])]),a("p",[t._v("插入文档也可以使用 db.col.save(document) 命令。如果不指定 _id 字段 save() 方法类似于 insert() 方法。如果指定 _id 字段，则会更新该 _id 的数据。")]),t._v(" "),a("h3",{attrs:{id:"更新文档"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#更新文档","aria-hidden":"true"}},[t._v("#")]),t._v(" 更新文档")]),t._v(" "),a("p",[t._v("MongoDB 使用 update() 和 save() 方法来更新集合中的文档。")]),t._v(" "),a("h4",{attrs:{id:"update"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#update","aria-hidden":"true"}},[t._v("#")]),t._v(" update")]),t._v(" "),a("p",[t._v("update() 方法用于更新已存在的文档。语法如下:")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("db.collection.update(\n   <query>,\n   <update>,\n   {\n     upsert: <boolean>,\n     multi: <boolean>,\n     writeConcern: <document>\n   }\n)\n")])])]),a("p",[t._v("参数说明:")]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("query")]),t._v(" : update的查询条件，类似sql update查询内where后面的。")]),t._v(" "),a("li",[a("strong",[t._v("update")]),t._v(" : update的对象和一些更新的操作符（如"),a("code",[t._v("$")]),t._v(","),a("code",[t._v("$inc")]),t._v("...）等，也可以理解为sql update查询内set后面的")]),t._v(" "),a("li",[a("strong",[t._v("upsert")]),t._v(" : 可选，这个参数的意思是，如果不存在update的记录，是否插入objNew,true为插入，默认是false，不插入。")]),t._v(" "),a("li",[a("strong",[t._v("multi")]),t._v(" : 可选，mongodb 默认是false,只更新找到的第一条记录，如果这个参数为true,就把按条件查出来多条记录全部更新。")]),t._v(" "),a("li",[a("strong",[t._v("writeConcern")]),t._v(" :可选，抛出异常的级别。")])]),t._v(" "),a("p",[t._v("示例:")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('> db.test.insert( {name: \'qzy\', age: 23} )\nWriteResult({ "nInserted" : 1 })\n> db.test.find()\n{ "_id" : ObjectId("5cad911248d6ea2451373cd9"), "name" : "qzy", "age" : 23 }\n> db.test.update({name: \'qzy\'}, {name: \'quanzaiyu\'})\nWriteResult({ "nMatched" : 1, "nUpserted" : 0, "nModified" : 1 })\n> db.test.find()\n{ "_id" : ObjectId("5cad911248d6ea2451373cd9"), "name" : "quanzaiyu" }\n')])])]),a("p",[t._v("以上语句只会修改第一条发现的文档，如果你要修改多条相同的文档，则需要设置 multi 参数为 true。")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("> db.col.update({name: 'qzy'}, {$set: {name: 'quanzaiyu'}}, {multi:true})\n")])])]),a("p",[t._v("更多示例:")]),t._v(" "),a("p",[t._v("只更新第一条记录：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('db.col.update( { "count" : { $gt : 1 } } , { $set : { "test2" : "OK"} } );\n')])])]),a("p",[t._v("全部更新：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('db.col.update( { "count" : { $gt : 3 } } , { $set : { "test2" : "OK"} },false,true );\n')])])]),a("p",[t._v("只添加第一条：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('db.col.update( { "count" : { $gt : 4 } } , { $set : { "test5" : "OK"} },true,false );\n')])])]),a("p",[t._v("全部添加进去:")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('db.col.update( { "count" : { $gt : 5 } } , { $set : { "test5" : "OK"} },true,true );\n')])])]),a("p",[t._v("全部更新：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('db.col.update( { "count" : { $gt : 15 } } , { $inc : { "count" : 1} },false,true );\n')])])]),a("p",[t._v("只更新第一条记录：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('db.col.update( { "count" : { $gt : 10 } } , { $inc : { "count" : 1} },false,false );\n')])])]),a("h4",{attrs:{id:"save"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#save","aria-hidden":"true"}},[t._v("#")]),t._v(" save")]),t._v(" "),a("p",[t._v("save() 方法通过传入的文档来"),a("strong",[t._v("替换")]),t._v("已有文档。语法如下:")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("db.collection.save(\n   <document>,\n   {\n     writeConcern: <document>\n   }\n)\n")])])]),a("p",[a("strong",[t._v("参数说明：")])]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("document")]),t._v(" : 文档数据。")]),t._v(" "),a("li",[a("strong",[t._v("writeConcern")]),t._v(" :可选，抛出异常的级别。")])]),t._v(" "),a("p",[t._v("示例:")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('> db.test.find()\n{ "_id" : ObjectId("5cad911248d6ea2451373cd9"), "name" : "quanzaiyu" }\n> db.test.save({_id: ObjectId("5cad911248d6ea2451373cd9"), name: "xiaoyu"})\nWriteResult({ "nMatched" : 1, "nUpserted" : 0, "nModified" : 1 })\n> db.test.find()\n{ "_id" : ObjectId("5cad911248d6ea2451373cd9"), "name" : "xiaoyu" }\n')])])]),a("h4",{attrs:{id:"最新方法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#最新方法","aria-hidden":"true"}},[t._v("#")]),t._v(" 最新方法")]),t._v(" "),a("p",[t._v("3.2版本之后, 官方推荐使用 insertOne() 和 insertMany() 方法。")]),t._v(" "),a("p",[t._v("示例:")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('#  插入单条数据\n> var document = db.collection.insertOne({"a": 3})\n> document\n{\n        "acknowledged" : true,\n        "insertedId" : ObjectId("571a218011a82a1d94c02333")\n}\n\n#  插入多条数据\n> var res = db.collection.insertMany([{"b": 3}, {\'c\': 4}])\n> res\n{\n        "acknowledged" : true,\n        "insertedIds" : [\n                ObjectId("571a22a911a82a1d94c02337"),\n                ObjectId("571a22a911a82a1d94c02338")\n        ]\n}\n')])])]),a("h3",{attrs:{id:"删除文档"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#删除文档","aria-hidden":"true"}},[t._v("#")]),t._v(" 删除文档")]),t._v(" "),a("h4",{attrs:{id:"remove"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#remove","aria-hidden":"true"}},[t._v("#")]),t._v(" remove")]),t._v(" "),a("p",[t._v("MongoDB 中 remove() 函数是用来移除集合中的数据。语法如下:")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("db.collection.remove(\n   <query>,\n   {\n     justOne: <boolean>,\n     writeConcern: <document>\n   }\n)\n")])])]),a("p",[a("strong",[t._v("参数说明：")])]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("query")]),t._v(" :（可选）删除的文档的条件。")]),t._v(" "),a("li",[a("strong",[t._v("justOne")]),t._v(" : （可选）如果设为 true 或 1，则只删除一个文档，如果不设置该参数，或使用默认值 false，则删除所有匹配条件的文档。")]),t._v(" "),a("li",[a("strong",[t._v("writeConcern")]),t._v(" :（可选）抛出异常的级别。")])]),t._v(" "),a("p",[t._v("示例:")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('>db.test.remove({\'name\': \'xiaoyu\'})\nWriteResult({ "nRemoved" : 2 })  # 删除了两条数据\n\n> db.test.find()\n{ "_id" : ObjectId("5cad911248d6ea2451373cd9"), "name" : "xiaoyu" }\n{ "_id" : ObjectId("5cad95af48d6ea2451373cda"), "name" : "xiaoyu", "age" : 18 }\n> db.test.remove({name: \'xiaoyu\'}, { justOne: true}) # 只删除第一条数据\nWriteResult({ "nRemoved" : 1 })\n> db.test.find()\n{ "_id" : ObjectId("5cad95af48d6ea2451373cda"), "name" : "xiaoyu", "age" : 18 }\n')])])]),a("p",[t._v("如果想删除所有数据，可以使用以下方式（类似常规 SQL 的 truncate 命令）:")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("> db.col.remove({})\n")])])]),a("h4",{attrs:{id:"释放空间"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#释放空间","aria-hidden":"true"}},[t._v("#")]),t._v(" 释放空间")]),t._v(" "),a("p",[t._v("remove() 方法 并不会真正释放空间。")]),t._v(" "),a("p",[t._v("需要继续执行 db.repairDatabase() 来回收磁盘空间。")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("> db.repairDatabase()\n或者\n> db.runCommand({ repairDatabase: 1 })\n")])])]),a("h4",{attrs:{id:"最新方法-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#最新方法-2","aria-hidden":"true"}},[t._v("#")]),t._v(" 最新方法")]),t._v(" "),a("p",[t._v("3.2版本之后, 官方推荐使用 deleteOne() 和 deleteMany() 方法。")]),t._v(" "),a("p",[t._v("示例:")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('# 删除集合下全部文档\n> db.test.deleteMany({})\n\n# 删除 status 等于 A 的全部文档\n> db.test.deleteMany({ status : "A" })\n\n# 删除 status 等于 D 的第一个文档\n> db.test.deleteOne( { status: "D" } )\n')])])]),a("h3",{attrs:{id:"查询文档"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查询文档","aria-hidden":"true"}},[t._v("#")]),t._v(" 查询文档")]),t._v(" "),a("p",[t._v("语法: "),a("code",[t._v("db.collection.find(query, projection)")])]),t._v(" "),a("ul",[a("li",[t._v("query ：可选，使用查询操作符指定查询条件")]),t._v(" "),a("li",[t._v("projection ：可选，使用投影操作符指定返回的键。查询时返回文档中所有键值， 只需省略该参数即可（默认省略）。")])]),t._v(" "),a("p",[t._v("如果你需要以易读的方式来读取数据，可以使用 pretty() 方法，语法格式如下：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("> db.col.find().pretty()\n")])])]),a("p",[t._v("除了 find() 方法之外，还有一个 findOne() 方法，它只返回一个文档。")]),t._v(" "),a("h2",{attrs:{id:"条件查询"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#条件查询","aria-hidden":"true"}},[t._v("#")]),t._v(" 条件查询")]),t._v(" "),a("p",[a("strong",[t._v("MongoDB 条件操作符 与 RDBMS Where条件语句 比较")])]),t._v(" "),a("p",[t._v("如果你熟悉常规的 SQL 数据，通过下表可以更好的理解 MongoDB 的条件语句查询：")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"left"}},[t._v("操作")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("格式")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("范例")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("RDBMS中的类似语句")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("等于")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("{<key>:<value>")]),t._v("}")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v('db.col.find({"by":"菜鸟教程"}).pretty()')])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("where by = '菜鸟教程'")])])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("小于")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("{<key>:{$lt:<value>}}")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v('db.col.find({"likes":{$lt:50}}).pretty()')])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("where likes < 50")])])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("小于或等于")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("{<key>:{$lte:<value>}}")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v('db.col.find({"likes":{$lte:50}}).pretty()')])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("where likes <= 50")])])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("大于")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("{<key>:{$gt:<value>}}")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v('db.col.find({"likes":{$gt:50}}).pretty()')])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("where likes > 50")])])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("大于或等于")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("{<key>:{$gte:<value>}}")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v('db.col.find({"likes":{$gte:50}}).pretty()')])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("where likes >= 50")])])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("不等于")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("{<key>:{$ne:<value>}}")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v('db.col.find({"likes":{$ne:50}}).pretty()')])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("where likes != 50")])])])])]),t._v(" "),a("h3",{attrs:{id:"and"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#and","aria-hidden":"true"}},[t._v("#")]),t._v(" AND")]),t._v(" "),a("p",[t._v("MongoDB 的 find() 方法可以传入多个键(key)，每个键(key)以逗号隔开，即常规 SQL 的 AND 条件。")]),t._v(" "),a("p",[t._v("语法格式如下：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("> db.col.find({key1:value1, key2:value2}).pretty()\n")])])]),a("h3",{attrs:{id:"or"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#or","aria-hidden":"true"}},[t._v("#")]),t._v(" OR")]),t._v(" "),a("p",[t._v("MongoDB OR 条件语句使用了关键字 $or,语法格式如下：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("> db.col.find(\n   {\n      $or: [\n         {key1: value1}, {key2:value2}\n      ]\n   }\n).pretty()\n")])])]),a("h3",{attrs:{id:"多重条件查询"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#多重条件查询","aria-hidden":"true"}},[t._v("#")]),t._v(" 多重条件查询")]),t._v(" "),a("p",[t._v("示例:")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('> db.col.find({"likes": {$gt:50}, $or: [{"name": "xiaoyu"}, {"age": {$lte: 30}}]}).pretty()\n')])])]),a("h2",{attrs:{id:"类型检测"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#类型检测","aria-hidden":"true"}},[t._v("#")]),t._v(" 类型检测")]),t._v(" "),a("p",[a("code",[t._v("$type")]),t._v(" 操作符是基于BSON类型来检索集合中匹配的数据类型，并返回结果。")]),t._v(" "),a("p",[t._v("MongoDB 中可以使用的类型如下表所示：")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"left"}},[a("strong",[t._v("类型")])]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[a("strong",[t._v("数字")])]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[a("strong",[t._v("备注")])])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("Double")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("1")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}})]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("String")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("2")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}})]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("Object")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("3")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}})]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("Array")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("4")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}})]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("Binary data")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("5")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}})]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("Undefined")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("6")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("已废弃。")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("Object id")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("7")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}})]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("Boolean")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("8")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}})]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("Date")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("9")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}})]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("Null")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("10")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}})]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("Regular Expression")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("11")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}})]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("JavaScript")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("13")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}})]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("Symbol")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("14")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}})]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("JavaScript (with scope)")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("15")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}})]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("32-bit integer")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("16")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}})]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("Timestamp")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("17")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}})]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("64-bit integer")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("18")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}})]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("Min key")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("255")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("Query with "),a("code",[t._v("-1")]),t._v(".")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("Max key")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("127")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}})])])]),t._v(" "),a("p",[t._v('比如, 如果想获取 "col" 集合中 title 为 String 的数据，你可以使用以下命令：')]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('> db.col.find({"title" : {$type : 2}})\n或\n> db.col.find({"title" : {$type : \'string\'}})\n')])])]),a("h2",{attrs:{id:"数量限制"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#数量限制","aria-hidden":"true"}},[t._v("#")]),t._v(" 数量限制")]),t._v(" "),a("p",[t._v("跟 SQL 类似, 在 MongoDB 中通过 limit 进行查询数量限制:")]),t._v(" "),a("p",[t._v("语法: "),a("code",[t._v("db.COLLECTION_NAME.find().limit(NUMBER)")])]),t._v(" "),a("p",[t._v("例如:")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("> db.COLLECTION_NAME.find().limit(NUMBER)\n")])])]),a("hr"),t._v(" "),a("p",[t._v("除了可以使用limit()方法来读取指定数量的数据外，还可以使用skip()方法来跳过指定数量的数据，skip方法同样接受一个数字参数作为跳过的记录条数。")]),t._v(" "),a("p",[t._v("语法: "),a("code",[t._v("db.COLLECTION_NAME.find().limit(NUMBER).skip(NUMBER)")])]),t._v(" "),a("ul",[a("li",[t._v("skip()方法默认参数为 0")])]),t._v(" "),a("p",[t._v("例如, 以下实例只会显示第二条文档数据:")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('> db.col.find({},{"title":1,_id:0}).limit(1).skip(1)\n')])])]),a("h2",{attrs:{id:"排序"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#排序","aria-hidden":"true"}},[t._v("#")]),t._v(" 排序")]),t._v(" "),a("p",[t._v("在 MongoDB 中使用 sort() 方法对数据进行排序，sort() 方法可以通过参数指定排序的字段，并使用 1 和 -1 来指定排序的方式，其中 1 为升序排列，而 -1 是用于降序排列。")]),t._v(" "),a("p",[t._v("语法: "),a("code",[t._v("db.COLLECTION_NAME.find().sort({KEY:1})")])]),t._v(" "),a("p",[t._v("示例:")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('> db.col.find({},{"title":1,_id:0}).sort({"likes":-1})\n')])])]),a("p",[t._v("skip(), limilt(), sort()三个放在一起执行的时候，执行的顺序是先 sort(), 然后是 skip()，最后是显示的 limit()。")]),t._v(" "),a("h2",{attrs:{id:"索引"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#索引","aria-hidden":"true"}},[t._v("#")]),t._v(" 索引")]),t._v(" "),a("p",[t._v("索引通常能够极大的提高查询的效率，如果没有索引，MongoDB在读取数据时必须扫描集合中的每个文件并选取那些符合查询条件的记录。这种扫描全集合的查询效率是非常低的，特别在处理大量的数据时，查询可以要花费几十秒甚至几分钟，这对网站的性能是非常致命的。")]),t._v(" "),a("p",[t._v("索引是特殊的数据结构，索引存储在一个易于遍历读取的数据集合中，索引是对数据库表中一列或多列的值进行排序的一种结构")]),t._v(" "),a("p",[t._v("MongoDB使用 createIndex() 方法来创建索引")]),t._v(" "),a("p",[t._v("语法: "),a("code",[t._v("db.collection.createIndex(keys, options)")])]),t._v(" "),a("p",[t._v("options 包括如下参数:")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"left"}},[t._v("Parameter")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("Type")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("Description")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("background")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("Boolean")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v('建索引过程会阻塞其它数据库操作，background可指定以后台方式创建索引，即增加 "background" 可选参数。 "background" 默认值为'),a("strong",[t._v("false")]),t._v("。")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("unique")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("Boolean")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("建立的索引是否唯一。指定为true创建唯一索引。默认值为"),a("strong",[t._v("false")]),t._v(".")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("name")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("string")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("索引的名称。如果未指定，MongoDB的通过连接索引的字段名和排序顺序生成一个索引名称。")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("sparse")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("Boolean")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("对文档中不存在的字段数据不启用索引；这个参数需要特别注意，如果设置为true的话，在索引字段中不会查询出不包含对应字段的文档.。默认值为 "),a("strong",[t._v("false")]),t._v(".")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("expireAfterSeconds")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("integer")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("指定一个以秒为单位的数值，完成 TTL设定，设定集合的生存时间。")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("v")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("index version")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("索引的版本号。默认的索引版本取决于mongod创建索引时运行的版本。")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("weights")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("document")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("索引权重值，数值在 1 到 99,999 之间，表示该索引相对于其他索引字段的得分权重。")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("default_language")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("string")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("对于文本索引，该参数决定了停用词及词干和词器的规则的列表。 默认为英语")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("language_override")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("string")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("对于文本索引，该参数指定了包含在文档中的字段名，语言覆盖默认的language，默认值为 language.")])])])]),t._v(" "),a("p",[t._v("示例:")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('> db.col.createIndex({"title":1})\n> db.values.createIndex({open: 1, close: 1}, {background: true}) # 在后台创建索引\n')])])]),a("h2",{attrs:{id:"聚合"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#聚合","aria-hidden":"true"}},[t._v("#")]),t._v(" 聚合")]),t._v(" "),a("p",[t._v("MongoDB中聚合(aggregate)主要用于处理数据(诸如统计平均值,求和等)，并返回计算后的数据结果。有点类似sql语句中的 count(*)。")]),t._v(" "),a("p",[t._v("语法: "),a("code",[t._v("db.COLLECTION_NAME.aggregate(AGGREGATE_OPERATION)")])]),t._v(" "),a("h3",{attrs:{id:"聚合表达式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#聚合表达式","aria-hidden":"true"}},[t._v("#")]),t._v(" 聚合表达式")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"left"}},[t._v("表达式")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("描述")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("实例")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("$sum")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("计算总和。")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v('db.mycol.aggregate([{$group : {_id : "$by_user", num_tutorial : {$sum : "$likes"}}}])')])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("$avg")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("计算平均值")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v('db.mycol.aggregate([{$group : {_id : "$by_user", num_tutorial : {$avg : "$likes"}}}])')])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("$min")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("获取集合中所有文档对应值得最小值。")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v('db.mycol.aggregate([{$group : {_id : "$by_user", num_tutorial : {$min : "$likes"}}}])')])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("$max")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("获取集合中所有文档对应值得最大值。")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v('db.mycol.aggregate([{$group : {_id : "$by_user", num_tutorial : {$max : "$likes"}}}])')])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("$push")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("在结果文档中插入值到一个数组中。")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v('db.mycol.aggregate([{$group : {_id : "$by_user", url : {$push: "$url"}}}])')])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("$addToSet")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("在结果文档中插入值到一个数组中，但不创建副本。")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v('db.mycol.aggregate([{$group : {_id : "$by_user", url : {$addToSet : "$url"}}}])')])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("$first")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("根据资源文档的排序获取第一个文档数据。")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v('db.mycol.aggregate([{$group : {_id : "$by_user", first_url : {$first : "$url"}}}])')])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[a("code",[t._v("$last")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("根据资源文档的排序获取最后一个文档数据")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v('db.mycol.aggregate([{$group : {_id : "$by_user", last_url : {$last : "$url"}}}])')])])])]),t._v(" "),a("p",[t._v("举例:")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('# 先插入几条数据\n> db.test.insertMany([\n  {"name" : "xiaoyu", "age" : 18},\n  {"name" : "xiaoqiao", "age" : 18},\n  {"name" : "xiaohong", "age" : 18},\n  {"name" : "xiaowang", "age" : 20},\n  {"name" : "xiaoyu", "age" : 23},\n])\n> db.test.find()\n{ "_id" : ObjectId("5cad95af48d6ea2451373cda"), "name" : "xiaoyu", "age" : 18 }\n{ "_id" : ObjectId("5cada46c48d6ea2451373cde"), "name" : "xiaoqiao", "age" : 18 }\n{ "_id" : ObjectId("5cada46c48d6ea2451373cdf"), "name" : "xiaohong", "age" : 18 }\n{ "_id" : ObjectId("5cada46c48d6ea2451373ce0"), "name" : "xiaowang", "age" : 20 }\n{ "_id" : ObjectId("5cada46c48d6ea2451373ce1"), "name" : "xiaoyu", "age" : 23 }\n\n# 按照年龄分组查询对应的人数\n> db.test.aggregate([{$group: {_id : "$age", num: {$sum : 1}}}])\n{ "_id" : 23, "num" : 1 }\n{ "_id" : 20, "num" : 1 }\n{ "_id" : 18, "num" : 3 }\n')])])]),a("p",[t._v("以上语句相当于 SQL 语句:")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("select by_user, count(*) from test group by age\n")])])]),a("h3",{attrs:{id:"聚合管道"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#聚合管道","aria-hidden":"true"}},[t._v("#")]),t._v(" 聚合管道")]),t._v(" "),a("p",[t._v("MongoDB聚合管道与Linux的管道操作类似, 上一个输出作为下一个的参数")]),t._v(" "),a("p",[t._v("常用的管道有:")]),t._v(" "),a("ul",[a("li",[t._v("$project：修改输入文档的结构。可以用来重命名、增加或删除域，也可以用于创建计算结果以及嵌套文档。")]),t._v(" "),a("li",[t._v("$match：用于过滤数据，只输出符合条件的文档。$match使用MongoDB的标准查询操作。")]),t._v(" "),a("li",[t._v("$limit：用来限制MongoDB聚合管道返回的文档数。")]),t._v(" "),a("li",[t._v("$skip：在聚合管道中跳过指定数量的文档，并返回余下的文档。")]),t._v(" "),a("li",[t._v("$unwind：将文档中的某一个数组类型字段拆分成多条，每条包含数组中的一个值。")]),t._v(" "),a("li",[t._v("$group：将集合中的文档分组，可用于统计结果。")]),t._v(" "),a("li",[t._v("$sort：将输入文档排序后输出。")]),t._v(" "),a("li",[t._v("$geoNear：输出接近某一地理位置的有序文档。")])]),t._v(" "),a("h4",{attrs:{id:"project"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#project","aria-hidden":"true"}},[t._v("#")]),t._v(" $project")]),t._v(" "),a("p",[t._v("相当于SQL中的 "),a("code",[t._v("select field")]),t._v(", 选择需要查询的字段")]),t._v(" "),a("p",[t._v("例如")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("> db.test.aggregate({ $project : { name : 1 }});\n")])])]),a("p",[t._v("默认查询出来的结果包含 "),a("code",[t._v("_id")]),t._v(", 如果不想包含则需要指定:")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("> db.test.aggregate({ $project : { _id: 0, name : 1 }});\n")])])]),a("h4",{attrs:{id:"match"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#match","aria-hidden":"true"}},[t._v("#")]),t._v(" $match")]),t._v(" "),a("p",[t._v("使用 $match 可以指定查询条件, 相当于SQL中的where子句")]),t._v(" "),a("p",[t._v("比如: 统计年龄在20-30岁之间的人数")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("db.test.aggregate( [\n  { $match : { age : { $gte : 20, $lte : 30 } } },\n  { $group: { _id: null, count: { $sum: 1 } } }\n]);\n")])])]),a("h4",{attrs:{id:"skip"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#skip","aria-hidden":"true"}},[t._v("#")]),t._v(" $skip")]),t._v(" "),a("p",[t._v('经过$skip管道操作符处理后，前五个文档被"过滤"掉。')]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("db.test.aggregate({ $skip : 5 });\n")])])]),a("h2",{attrs:{id:"参考资料"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参考资料","aria-hidden":"true"}},[t._v("#")]),t._v(" 参考资料")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"http://www.runoob.com/mongodb/mongodb-tutorial.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("MongoDB 教程 - RUNOOB"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://blog.csdn.net/yanpenglei/article/details/79261875",target:"_blank",rel:"noopener noreferrer"}},[t._v("Spring Boot 中使用 MongoDB 增删改查"),a("OutboundLink")],1)])])],1)},[],!1,null,null,null);e.default=n.exports}}]);