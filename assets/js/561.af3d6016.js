(window.webpackJsonp=window.webpackJsonp||[]).push([[561],{936:function(t,s,a){"use strict";a.r(s);var e=a(1),n=Object(e.a)({},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"kubernetes-核心概念-数据存储-pv、pvc"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#kubernetes-核心概念-数据存储-pv、pvc","aria-hidden":"true"}},[t._v("#")]),t._v(" Kubernetes 核心概念 - 数据存储 (PV、PVC)")]),t._v(" "),a("p",[t._v("在Docker中就有数据卷的概念，当容器删除时，数据也一起会被删除，想要持久化使用数据，需要把主机上的目录挂载到Docker中去，在K8S中，数据卷是通过Pod实现持久化的，如果Pod删除，数据卷也会一起删除，k8s的数据卷是docker数据卷的扩展，K8S适配各种存储系统，包括本地存储EmptyDir,HostPath,网络存储NFS,GlusterFS,PV/PVC等，下面就详细介绍下K8S的存储如何实现。")]),t._v(" "),a("h2",{attrs:{id:"本地存储"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#本地存储","aria-hidden":"true"}},[t._v("#")]),t._v(" 本地存储")]),t._v(" "),a("h3",{attrs:{id:"emptydir"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#emptydir","aria-hidden":"true"}},[t._v("#")]),t._v(" EmptyDir")]),t._v(" "),a("ol",[a("li",[t._v("编辑EmptyDir配置文件")])]),t._v(" "),a("p",[a("code",[t._v("emptydir.yaml")])]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Pod        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#类型是Pod")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("labels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" redis\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("role")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" master        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#定义为主redis")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" redis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("master\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("containers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" master\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" redis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("latest\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("env")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#定义环境变量")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" MASTER\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("value")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"true"')]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#容器内端口")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("containerPort")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6379")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumeMounts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#容器内挂载点")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("mountPath")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /data\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" redis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("data        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#必须有名称")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" redis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("data        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#跟上面的名称对应")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("emptyDir")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#宿主机挂载点")]),t._v("\n")])])]),a("ol",{attrs:{start:"2"}},[a("li",[t._v("创建Pod")])]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("$ kubectl create -f emptydir.yaml\n")])])]),a("p",[t._v("此时Emptydir已经创建成功，在宿主机上的访问路径为 "),a("code",[t._v("/var/lib/kubelet/pods/<pod uid>/volumes/kubernetes.io~empty-dir/redis-data")]),t._v(",如果在此目录中创建删除文件，都将对容器中的/data目录有影响，如果删除Pod，文件将全部删除，即使是在宿主机上创建的文件也是如此，在宿主机上删除容器则k8s会再自动创建一个容器，此时文件仍然存在。")]),t._v(" "),a("h3",{attrs:{id:"hostdir"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#hostdir","aria-hidden":"true"}},[t._v("#")]),t._v(" HostDir")]),t._v(" "),a("p",[t._v("在宿主机上指定一个目录，挂载到Pod的容器中，其实跟上面的写法不尽相同，这里只截取不同的部分，当pod删除时，本地仍然保留文件")]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("...")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" redis"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("data "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#跟上面的名称对应")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hostPath")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("path")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /data "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#宿主机挂载点")]),t._v("\n")])])]),a("h2",{attrs:{id:"网络数据卷-nfs"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#网络数据卷-nfs","aria-hidden":"true"}},[t._v("#")]),t._v(" 网络数据卷 (NFS)")]),t._v(" "),a("p",[t._v("编辑一个使用NFS的Pod的配置文件")]),t._v(" "),a("p",[a("code",[t._v("nfs.yaml")])]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Pod\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nfs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("web\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("containers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" web\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nginx\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("imagePullPolicy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Never        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#如果已经有镜像，就不需要再拉取镜像")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" web\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("containerPort")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hostPort")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("80        ")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#将容器的80端口映射到宿主机的80端口")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumeMounts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nfs        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#指定名称必须与下面一致")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("mountPath")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/usr/share/nginx/html"')]),t._v("        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#容器内的挂载点")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nfs            "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#指定名称必须与上面一致")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("nfs")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("            "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#nfs存储")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("server")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 192.168.66.50        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#nfs服务器ip或是域名")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("path")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/test"')]),t._v("                "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#nfs服务器共享的目录")]),t._v("\n")])])]),a("p",[t._v("创建Pod")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("$ kubectl create -f nfs.yaml\n")])])]),a("p",[t._v("在节点端可以用 "),a("code",[t._v("mount")]),t._v(" 命令查询挂载情况")]),t._v(" "),a("p",[t._v("因为我映射的是代码目录，在/test目录中创建index.html文件后，这个文件也将在容器中生效，当Pod删除时，文件不受影响，实现了数据持久化。")]),t._v(" "),a("h2",{attrs:{id:"persistent-volume-pv"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#persistent-volume-pv","aria-hidden":"true"}},[t._v("#")]),t._v(" Persistent Volume (PV)")]),t._v(" "),a("ol",[a("li",[t._v("编辑PV配置文件")])]),t._v(" "),a("p",[a("code",[t._v("persistent-volume.yaml")])]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" PersistentVolume\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" test"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("pv\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("labels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nfs        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#指定类型是NFS")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("capacity")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("            "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#指定访问空间是15G")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("storage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 15Gi\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("accessModes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#指定访问模式是能在多节点上挂载，并且访问权限是读写执行")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ReadWriteMany\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("persistentVolumeReclaimPolicy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Recycle        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#指定回收模式是自动回收，当空间被释放时，K8S自动清理，然后可以继续绑定使用")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("nfs")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("server")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 172.18.50.200\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("path")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /test\n")])])]),a("p",[a("strong",[t._v("Reclaim")]),t._v(" 回收策略")]),t._v(" "),a("ul",[a("li",[t._v("Retain – 允许用户手动回收")]),t._v(" "),a("li",[t._v("Recycle – 删除PV上的数据 (“rm -rf /thevolume/*”)")]),t._v(" "),a("li",[t._v("Delete – 删除PV")])]),t._v(" "),a("ol",{attrs:{start:"2"}},[a("li",[t._v("创建PV")])]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("$ kubectl create -f persistent-volume.yaml\n")])])]),a("p",[t._v("状态已经变成可用")]),t._v(" "),a("ol",{attrs:{start:"3"}},[a("li",[t._v("获取pv信息")])]),t._v(" "),a("p",[t._v("pv 没有命名空间的限制")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("$ kubectl get "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("pv")]),t._v("\nNAME      CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM           STORAGECLASS   REASON   AGE\ntest-pv   15Gi       RWX            Recycle          Bound    test/nfs-data                           51s\n")])])]),a("p",[t._v("查看pv详情")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("$ kubectl describe "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("pv")]),t._v(" test-pv\nName:            test-pv\nLabels:          type"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("nfs\nAnnotations:     pv.kubernetes.io/bound-by-controller: "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("yes")]),t._v("\nFinalizers:      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("kubernetes.io/pv-protection"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\nStorageClass:\nStatus:          Bound\nClaim:           test/nfs-data\nReclaim Policy:  Recycle\nAccess Modes:    RWX\nVolumeMode:      Filesystem\nCapacity:        15Gi\nNode Affinity:   "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\nMessage:\nSource:\n    Type:      NFS "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("an NFS "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("mount")]),t._v(" that lasts the lifetime of a pod"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    Server:    192.168.126.130\n    Path:      /test\n    ReadOnly:  "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),t._v("\nEvents:        "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n")])])]),a("p",[t._v("可以看到, test-pv 被 PVC "),a("code",[t._v("test/nfs-data")]),t._v(" 声明, 挂载到 "),a("code",[t._v("192.168.126.130/test")]),t._v(" 下")]),t._v(" "),a("h2",{attrs:{id:"persistent-volume-claim-pvc"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#persistent-volume-claim-pvc","aria-hidden":"true"}},[t._v("#")]),t._v(" Persistent Volume Claim (PVC)")]),t._v(" "),a("ol",[a("li",[t._v("编辑PVC配置文件")])]),t._v(" "),a("p",[a("code",[t._v("nfs-data.yaml")])]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" PersistentVolumeClaim\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nfs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("data\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("accessModes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ReadWriteOnce"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("resources")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 指定请求的资源，存储3G")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("requests")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("storage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 3Gi\n")])])]),a("p",[a("strong",[t._v("Access Modes")]),t._v(" 访问模式")]),t._v(" "),a("p",[t._v("k8s不会真正检查存储的访问模式或根据访问模式做访问限制，只是对真实存储的描述，最终的控制权在真实的存储端。目前支持三种访问模式：")]),t._v(" "),a("ul",[a("li",[t._v("ReadWriteOnce – PV以 read-write 挂载到一个节点")]),t._v(" "),a("li",[t._v("ReadOnlyMany – PV以read-only方式挂载到多个节点")]),t._v(" "),a("li",[t._v("ReadWriteMany – PV以read-write方式挂载到多个节点")])]),t._v(" "),a("ol",{attrs:{start:"2"}},[a("li",[t._v("创建PVC")])]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("$ kubectl create -f nfs-data.yaml\n")])])]),a("ol",{attrs:{start:"3"}},[a("li",[t._v("创建Pod以使用平台空间")])]),t._v(" "),a("p",[a("code",[t._v("pv-pod.yaml")])]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Pod\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" redis\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("labels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("app")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" redis\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("containers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" redis\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" redis\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("imagePullPolicy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Never\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumeMounts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("mountPath")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/data"')]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" data\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("containerPort")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6379")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" data\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("persistentVolumeClaim")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 指定使用的PVC")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("claimName")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nfs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("data "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 名字一定要正确")]),t._v("\n")])])]),a("p",[t._v("当前Pod可用空间为3G，如果超过3G，则需要再创建存储来满足需求，因为是网络数据卷，如果需要扩展空间，直接删除Pod再建立一个即可。")]),t._v(" "),a("ol",[a("li",[t._v("获取pvc信息")])]),t._v(" "),a("p",[t._v("pvc 可以指定命名空间, 默认为 default")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("$ kubectl get pvc --all-namespaces\nNAMESPACE   NAME       STATUS   VOLUME    CAPACITY   ACCESS MODES   STORAGECLASS   AGE\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("test")]),t._v("        nfs-data   Bound    test-pv   15Gi       RWX                           5m20s\n\n$ kubectl get pvc -n "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("test")]),t._v("\nNAME       STATUS   VOLUME    CAPACITY   ACCESS MODES   STORAGECLASS   AGE\nnfs-data   Bound    test-pv   15Gi       RWX                           44m\n")])])]),a("p",[t._v("查看pvc详情")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("$ kubectl describe pvc nfs-data -n "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("test")]),t._v("\nName:          nfs-data\nNamespace:     "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("test")]),t._v("\nStorageClass:\nStatus:        Bound\nVolume:        test-pv\nLabels:        "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\nAnnotations:   pv.kubernetes.io/bind-completed: "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("yes")]),t._v("\n               pv.kubernetes.io/bound-by-controller: "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("yes")]),t._v("\nFinalizers:    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("kubernetes.io/pvc-protection"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\nCapacity:      15Gi\nAccess Modes:  RWX\nVolumeMode:    Filesystem\nEvents:\n  Type       Reason         Age                 From                         Message\n  ----       ------         ----                ----                         -------\n  Normal     FailedBinding  43m "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("x12 over 46m"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("  persistentvolume-controller  no persistent volumes available "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" this claim and no storage class is "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("set")]),t._v("\nMounted By:  "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("none"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n")])])]),a("p",[t._v("可以看到, nfs-data 使用了持久卷 "),a("code",[t._v("test-pv")])]),t._v(" "),a("h2",{attrs:{id:"动态配置和存储类"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#动态配置和存储类","aria-hidden":"true"}},[t._v("#")]),t._v(" 动态配置和存储类")]),t._v(" "),a("p",[t._v("Dynamic Provisioning的目标是完全自动化存储资源的生命周期管理，让用户无需过多的关注存储的管理，可以按需求自动动态创建和调整存储资源。StorageClass本质上是底层存储介质的抽象：不同的存储介质拥有统一的表示和行为。")]),t._v(" "),a("h3",{attrs:{id:"什么是-storage-classes"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#什么是-storage-classes","aria-hidden":"true"}},[t._v("#")]),t._v(" 什么是 Storage Classes")]),t._v(" "),a("p",[t._v("StorageClass是Dynamic Provisioning（动态配置）的基础，允许集群管理员位底层存储平台做定义抽象。用户只需在PersistentVolumeClaim(PVC)通过名字引用StorageClass即可。")]),t._v(" "),a("p",[t._v("示例: PVC使用storageClassName")]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" PersistentVolumeClaim\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" mypvc\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("namespace")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" test\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("storageClassName")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" standard\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("accessModes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ReadWriteOnce\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("resources")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("requests")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("storage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 1Gi\n")])])]),a("h3",{attrs:{id:"定义存储类"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#定义存储类","aria-hidden":"true"}},[t._v("#")]),t._v(" 定义存储类")]),t._v(" "),a("p",[t._v("每一个存储类都包含provisioner、parameters和reclaimPolicy这三个参数域，当一个属于某个类的PersistentVolume需要被动态提供时，将会使用上述的参数域。")]),t._v(" "),a("p",[t._v("存储类对象的名称非常重要，用户通过名称类请求特定的存储类。管理员创建存储类对象时，会设置类的名称和其它的参数，存储类的对象一旦被创建，将不能被更新。管理员能够为PVC指定一个默认的存储类。")]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" storage.k8s.io/v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" StorageClass\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" standard\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 指定存储类的供应者")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("provisioner")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kubernetes.io/glusterfs\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("parameters")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("resturl")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"http://10.97.20.153:8080"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("clusterid")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"630372ccdc720a92c681fb928f27b53f"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("restauthenabled")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"true"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("restuser")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"admin"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("secretNamespace")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"default"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("secretName")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"heketi-secret"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("gidMin")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"40000"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("gidMax")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"50000"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumetype")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"replicate:3"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 指定回收策略")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("reclaimPolicy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Retain\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("mountOptions")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" debug\n")])])]),a("h3",{attrs:{id:"供应者"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#供应者","aria-hidden":"true"}},[t._v("#")]),t._v(" 供应者")]),t._v(" "),a("p",[t._v("存储类有一个供应者的参数域，此参数域决定PV使用什么存储卷插件。参数必需进行设置：")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[a("strong",[t._v("存储卷")])]),t._v(" "),a("th",[a("strong",[t._v("内置供应者")])]),t._v(" "),a("th",[a("strong",[t._v("配置例子")])])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("AWSElasticBlockStore")]),t._v(" "),a("td",[t._v("✓")]),t._v(" "),a("td",[a("a",{attrs:{href:"https://kubernetes.io/docs/concepts/storage/storage-classes/#aws",target:"_blank",rel:"noopener noreferrer"}},[t._v("AWS"),a("OutboundLink")],1)])]),t._v(" "),a("tr",[a("td",[t._v("AzureFile")]),t._v(" "),a("td",[t._v("✓")]),t._v(" "),a("td",[a("a",{attrs:{href:"https://kubernetes.io/docs/concepts/storage/storage-classes/#azure-file",target:"_blank",rel:"noopener noreferrer"}},[t._v("Azure File"),a("OutboundLink")],1)])]),t._v(" "),a("tr",[a("td",[t._v("AzureDisk")]),t._v(" "),a("td",[t._v("✓")]),t._v(" "),a("td",[a("a",{attrs:{href:"https://kubernetes.io/docs/concepts/storage/storage-classes/#azure-disk",target:"_blank",rel:"noopener noreferrer"}},[t._v("Azure Disk"),a("OutboundLink")],1)])]),t._v(" "),a("tr",[a("td",[t._v("CephFS")]),t._v(" "),a("td",[t._v("–")]),t._v(" "),a("td",[t._v("–")])]),t._v(" "),a("tr",[a("td",[t._v("Cinder")]),t._v(" "),a("td",[t._v("✓")]),t._v(" "),a("td",[a("a",{attrs:{href:"https://kubernetes.io/docs/concepts/storage/storage-classes/#openstack-cinder",target:"_blank",rel:"noopener noreferrer"}},[t._v("OpenStack Cinder"),a("OutboundLink")],1)])]),t._v(" "),a("tr",[a("td",[t._v("FC")]),t._v(" "),a("td",[t._v("–")]),t._v(" "),a("td",[t._v("–")])]),t._v(" "),a("tr",[a("td",[t._v("FlexVolume")]),t._v(" "),a("td",[t._v("–")]),t._v(" "),a("td",[t._v("–")])]),t._v(" "),a("tr",[a("td",[t._v("Flocker")]),t._v(" "),a("td",[t._v("✓")]),t._v(" "),a("td",[t._v("–")])]),t._v(" "),a("tr",[a("td",[t._v("GCEPersistentDisk")]),t._v(" "),a("td",[t._v("✓")]),t._v(" "),a("td",[a("a",{attrs:{href:"https://kubernetes.io/docs/concepts/storage/storage-classes/#gce",target:"_blank",rel:"noopener noreferrer"}},[t._v("GCE"),a("OutboundLink")],1)])]),t._v(" "),a("tr",[a("td",[t._v("Glusterfs")]),t._v(" "),a("td",[t._v("✓")]),t._v(" "),a("td",[a("a",{attrs:{href:"https://kubernetes.io/docs/concepts/storage/storage-classes/#glusterfs",target:"_blank",rel:"noopener noreferrer"}},[t._v("Glusterfs"),a("OutboundLink")],1)])]),t._v(" "),a("tr",[a("td",[t._v("iSCSI")]),t._v(" "),a("td",[t._v("–")]),t._v(" "),a("td",[t._v("–")])]),t._v(" "),a("tr",[a("td",[t._v("PhotonPersistentDisk")]),t._v(" "),a("td",[t._v("✓")]),t._v(" "),a("td",[t._v("–")])]),t._v(" "),a("tr",[a("td",[t._v("Quobyte")]),t._v(" "),a("td",[t._v("✓")]),t._v(" "),a("td",[a("a",{attrs:{href:"https://kubernetes.io/docs/concepts/storage/storage-classes/#quobyte",target:"_blank",rel:"noopener noreferrer"}},[t._v("Quobyte"),a("OutboundLink")],1)])]),t._v(" "),a("tr",[a("td",[t._v("NFS")]),t._v(" "),a("td",[t._v("–")]),t._v(" "),a("td",[t._v("–")])]),t._v(" "),a("tr",[a("td",[t._v("RBD")]),t._v(" "),a("td",[t._v("✓")]),t._v(" "),a("td",[a("a",{attrs:{href:"https://kubernetes.io/docs/concepts/storage/storage-classes/#ceph-rbd",target:"_blank",rel:"noopener noreferrer"}},[t._v("Ceph RBD"),a("OutboundLink")],1)])]),t._v(" "),a("tr",[a("td",[t._v("VsphereVolume")]),t._v(" "),a("td",[t._v("✓")]),t._v(" "),a("td",[a("a",{attrs:{href:"https://kubernetes.io/docs/concepts/storage/storage-classes/#vsphere",target:"_blank",rel:"noopener noreferrer"}},[t._v("vSphere"),a("OutboundLink")],1)])]),t._v(" "),a("tr",[a("td",[t._v("PortworxVolume")]),t._v(" "),a("td",[t._v("✓")]),t._v(" "),a("td",[a("a",{attrs:{href:"https://kubernetes.io/docs/concepts/storage/storage-classes/#portworx-volume",target:"_blank",rel:"noopener noreferrer"}},[t._v("Portworx Volume"),a("OutboundLink")],1)])]),t._v(" "),a("tr",[a("td",[t._v("ScaleIO")]),t._v(" "),a("td",[t._v("✓")]),t._v(" "),a("td",[a("a",{attrs:{href:"https://kubernetes.io/docs/concepts/storage/storage-classes/#scaleio",target:"_blank",rel:"noopener noreferrer"}},[t._v("ScaleIO"),a("OutboundLink")],1)])]),t._v(" "),a("tr",[a("td",[t._v("StorageOS")]),t._v(" "),a("td",[t._v("✓")]),t._v(" "),a("td",[a("a",{attrs:{href:"https://kubernetes.io/docs/concepts/storage/storage-classes/#storageos",target:"_blank",rel:"noopener noreferrer"}},[t._v("StorageOS"),a("OutboundLink")],1)])]),t._v(" "),a("tr",[a("td",[t._v("Local")]),t._v(" "),a("td",[t._v("–")]),t._v(" "),a("td",[a("a",{attrs:{href:"https://kubernetes.io/docs/concepts/storage/storage-classes/#local",target:"_blank",rel:"noopener noreferrer"}},[t._v("Local"),a("OutboundLink")],1)])])])]),t._v(" "),a("p",[t._v("Kubernetes的存储类并不局限于表中的“interneal”供应者，“interneal”供应者的名称带有“kubernetes.io”前缀；也可以允许和指定外部的供应者，外部供应者通过独立的程序进行实现。外部供应者的作者对代码在何处生存、如何供应、如何运行、使用什么卷插件（包括Flex）等有充分的判断权， kubernetes-incubator/external-storage 仓库中存在编写外部提供者的类库。例如，NFS不是内部的供应者，但也是可以使用。在 kubernetes-incubator/external-storage 仓库中以列表的形式展示了一些外部的供应者，一些第三方供应商也提供了他们自己的外部供应者。")]),t._v(" "),a("h2",{attrs:{id:"错误解决"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#错误解决","aria-hidden":"true"}},[t._v("#")]),t._v(" 错误解决")]),t._v(" "),a("h3",{attrs:{id:"nfs共享出现有坏的超级块"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nfs共享出现有坏的超级块","aria-hidden":"true"}},[t._v("#")]),t._v(" NFS共享出现有坏的超级块")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("$ yum -y "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" nfs-utils\n$ systemctl start nfs-utils\n$ systemctl "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("enable")]),t._v(" nfs-utils\n")])])]),a("h2",{attrs:{id:"参考资料"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参考资料","aria-hidden":"true"}},[t._v("#")]),t._v(" 参考资料")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"http://dockone.io/article/2082",target:"_blank",rel:"noopener noreferrer"}},[t._v("Kubernetes 存储功能和源码深度解析（一）"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://www.kubernetes.org.cn/1857.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Kubernetes 1.6新特性系列 | 动态配置和存储类"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://www.kubernetes.org.cn/4078.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Kubernetes-基于StorageClass的动态存储供应"),a("OutboundLink")],1)])])])},[],!1,null,null,null);s.default=n.exports}}]);