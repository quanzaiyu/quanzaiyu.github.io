(window.webpackJsonp=window.webpackJsonp||[]).push([[537],{924:function(t,s,n){"use strict";n.r(s);var a=n(1),e=Object(a.a)({},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h1",{attrs:{id:"持续集成工具-jenkins-的使用"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#持续集成工具-jenkins-的使用","aria-hidden":"true"}},[t._v("#")]),t._v(" 持续集成工具 Jenkins 的使用")]),t._v(" "),n("p",[n("a",{attrs:{href:"https://jenkins.io/zh/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Jenkins"),n("OutboundLink")],1),t._v("是一款开源CI&CD软件，用于自动化各种任务，包括构建、测试和部署软件.")]),t._v(" "),n("p",[t._v("Jenkins支持各种运行方式，可通过系统包,Docker或者通过一个独立的Java程序.")]),t._v(" "),n("h2",{attrs:{id:"jenkins-安装"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#jenkins-安装","aria-hidden":"true"}},[t._v("#")]),t._v(" Jenkins 安装")]),t._v(" "),n("h3",{attrs:{id:"通过-war-部署-jenkins"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#通过-war-部署-jenkins","aria-hidden":"true"}},[t._v("#")]),t._v(" 通过 war 部署 Jenkins")]),t._v(" "),n("ol",[n("li",[n("a",{attrs:{href:"http://mirrors.jenkins.io/war-stable/latest/jenkins.war",target:"_blank",rel:"noopener noreferrer"}},[t._v("下载Jenkins"),n("OutboundLink")],1),t._v(".")]),t._v(" "),n("li",[t._v("打开终端进入到下载目录.")]),t._v(" "),n("li",[t._v("运行命令 "),n("code",[t._v("java -jar jenkins.war --httpPort=8080")]),t._v(".")]),t._v(" "),n("li",[t._v("打开浏览器进入链接 "),n("code",[t._v("http://localhost:8080")]),t._v(".")])]),t._v(" "),n("h3",{attrs:{id:"通过-docker-部署-jenkins"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#通过-docker-部署-jenkins","aria-hidden":"true"}},[t._v("#")]),t._v(" 通过 Docker 部署 Jenkins")]),t._v(" "),n("p",[t._v("使用以下命令启动一个 Jenkins 容器")]),t._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[t._v("docker run \\\n  --name jenkins \\\n  -d \\\n  -u root \\\n  -p 8084:8080 \\\n  -p 50000:50000 \\\n  -v /usr/share/nginx/html/jenkins/data:/var/jenkins_home \\\n  -v /var/run/docker.sock:/var/run/docker.sock \\\n  -v "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),n("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$HOME")]),t._v('"')]),t._v(":/home \\\n  --privileged"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("true \\\n  jenkinsci/blueocean\n")])])]),n("p",[t._v("以上命令, 执行以下操作:")]),t._v(" "),n("ol",[n("li",[t._v("命名一个名叫 jenkins 的 docker 容器")]),t._v(" "),n("li",[t._v("-d 后台运行")]),t._v(" "),n("li",[t._v("使用 root 用户登录")]),t._v(" "),n("li",[t._v("将容器中 8080 端口映射到宿主机的 8084 端口")]),t._v(" "),n("li",[t._v("将容器中 50000 端口映射到宿主机的 50000 端口")]),t._v(" "),n("li",[t._v("挂载卷, 将其中的"),n("code",[t._v("/var/jenkins_home")]),t._v("目录挂载到宿主机"),n("code",[t._v("/usr/share/nginx/html/jenkins/data")]),t._v("下")]),t._v(" "),n("li",[t._v("挂载卷, 将其中用户目录挂载到宿主机用户目录("),n("code",[t._v("~")]),t._v(")")]),t._v(" "),n("li",[t._v("由于本人使用 root 用户进行操作, 为了容器避免权限不足添加 "),n("code",[t._v("--privileged=true")]),t._v(" 参数")]),t._v(" "),n("li",[t._v("使用镜像 "),n("code",[t._v("jenkinsci/blueocean")]),t._v(" 创建容器")])]),t._v(" "),n("p",[t._v("如果推出容器, 可以使用 "),n("code",[t._v("docker start jenkins")]),t._v(" 开启")]),t._v(" "),n("p",[t._v("如果在运行途中想要进入容器, 输入:")]),t._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[t._v("$ docker "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("exec")]),t._v(" -it jenkins "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("bash")]),t._v("\n")])])]),n("h3",{attrs:{id:"安装过程"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#安装过程","aria-hidden":"true"}},[t._v("#")]),t._v(" 安装过程")]),t._v(" "),n("p",[t._v("查看控制台, 出现:")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("INFO: Jenkins is fully up and running\n")])])]),n("p",[t._v("即表明运行容器启动成功, 浏览器中输入 "),n("code",[t._v("http://192.168.42.130:8084")]),t._v(" 即可看到")]),t._v(" "),n("imgLink",{attrs:{src:"date/20190101/Jenkins/001.png"}}),t._v(" "),n("p",[t._v("此处要求输入秘钥, 在控制台 "),n("code",[t._v("*")]),t._v(" 中即可看到秘钥:")]),t._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v("*************************************************************\n*************************************************************\n*************************************************************\n\nJenkins initial setup is required. An admin user has been created and a password generated.\nPlease use the following password to proceed to installation:\n\na7fae2529edb4f0392d427b5355613d7\n\nThis may also be found at: /var/jenkins_home/secrets/initialAdminPassword\n\n*************************************************************\n*************************************************************\n*************************************************************\n")])])]),n("p",[t._v("如果没记住, 可以在容器内 "),n("code",[t._v("/var/jenkins_home/secrets/initialAdminPassword")]),t._v(" 中看到")]),t._v(" "),n("imgLink",{attrs:{src:"date/20190101/Jenkins/002.png"}}),t._v(" "),n("p",[t._v("接下来进行插件安装(需要梯子, 否则可能提示 "),n("code",[t._v("This Jenkins instance appears to be offline")]),t._v(")")]),t._v(" "),n("imgLink",{attrs:{src:"date/20190101/Jenkins/003.png"}}),t._v(" "),n("imgLink",{attrs:{src:"date/20190101/Jenkins/004.png"}}),t._v(" "),n("p",[t._v("创建管理员")]),t._v(" "),n("imgLink",{attrs:{src:"date/20190101/Jenkins/005.png"}}),t._v(" "),n("p",[t._v("设置实例地址")]),t._v(" "),n("imgLink",{attrs:{src:"date/20190101/Jenkins/006.png"}}),t._v(" "),n("p",[t._v("即可安装成功")]),t._v(" "),n("imgLink",{attrs:{src:"date/20190101/Jenkins/007.png"}}),t._v(" "),n("h2",{attrs:{id:"单分支流水线"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#单分支流水线","aria-hidden":"true"}},[t._v("#")]),t._v(" 单分支流水线")]),t._v(" "),n("h3",{attrs:{id:"克隆-git-仓库"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#克隆-git-仓库","aria-hidden":"true"}},[t._v("#")]),t._v(" 克隆 git 仓库")]),t._v(" "),n("p",[t._v("以一个简单的 react 项目为例, 首先将仓库克隆到本地")]),t._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[t._v("$ "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" clone https://github.com/quanzaiyu/building-a-multibranch-pipeline-project.git\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("pwd")]),t._v("\n/home/data/building-a-multibranch-pipeline-project\n")])])]),n("h3",{attrs:{id:"创建单流水线"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#创建单流水线","aria-hidden":"true"}},[t._v("#")]),t._v(" 创建单流水线")]),t._v(" "),n("p",[t._v("在 Jenkins 中创建一条流水线")]),t._v(" "),n("imgLink",{attrs:{src:"date/20190101/Jenkins/008.png"}}),t._v(" "),n("p",[t._v("找到 "),n("code",[t._v("Pipeline")]),t._v(" 选项, Definition 选择 "),n("code",[t._v("Pipeline script from SCM")]),t._v(", 在 SCM 中选择 "),n("code",[t._v("Git")])]),t._v(" "),n("imgLink",{attrs:{src:"date/20190101/Jenkins/009.png"}}),t._v(" "),n("h3",{attrs:{id:"创建-jenkinsfile"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#创建-jenkinsfile","aria-hidden":"true"}},[t._v("#")]),t._v(" 创建 Jenkinsfile")]),t._v(" "),n("p",[t._v("在项目根目录创建 Jenkinsfile, 输入以下内容")]),t._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[t._v("$ "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("vim")]),t._v(" Jenkinsfile\npipeline "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    agent "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        docker "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            image "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'node:10.12.0'")]),t._v("\n            args "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'-p 3000:3000'")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    environment "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        CI "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'true'")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    stages "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        stage"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Build'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            steps "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                sh "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'npm config set registry https://registry.npm.taobao.org'")]),t._v("\n                sh "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'npm install'")]),t._v("\n                sh "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'npm run build'")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        stage"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Test'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            steps "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                sh "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./jenkins/scripts/test.sh'")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[t._v("修改 Jenkinsfile 后提交修改")]),t._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[t._v("$ "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v(".")]),t._v("\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" commit -m Jenkinsfile\n")])])]),n("h3",{attrs:{id:"运行流水线"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#运行流水线","aria-hidden":"true"}},[t._v("#")]),t._v(" 运行流水线")]),t._v(" "),n("p",[t._v("在浏览器中打开 "),n("code",[t._v("Open Blue Ocean")]),t._v(", 选择运行, 可以看到输出结果:")]),t._v(" "),n("imgLink",{attrs:{src:"date/20190101/Jenkins/010.png"}}),t._v(" "),n("imgLink",{attrs:{src:"date/20190101/Jenkins/011.png"}}),t._v(" "),n("p",[t._v("使用 Jenkins 项目的检出位于 "),n("code",[t._v("/var/jenkins_home/workspace/")])]),t._v(" "),n("h2",{attrs:{id:"多分支流水线"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#多分支流水线","aria-hidden":"true"}},[t._v("#")]),t._v(" 多分支流水线")]),t._v(" "),n("p",[t._v("以上节仓库为例, 新建两个分支: "),n("code",[t._v("development")]),t._v(" 和 "),n("code",[t._v("production")]),t._v(", 将 "),n("code",[t._v("master")]),t._v(" 分支下的内容检出到当前分支:")]),t._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[t._v("$ "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" branch development\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" checkout development\nSwitched to branch "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'development'")]),t._v("\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" pull "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v(".")]),t._v(" master\nFrom "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v(".")]),t._v("\n * branch            master     -"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" FETCH_HEAD\nAlready up to date.\n\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" branch production\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" checkout production\nSwitched to branch "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'production'")]),t._v("\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" pull "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v(".")]),t._v(" master\nFrom "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v(".")]),t._v("\n * branch            master     -"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" FETCH_HEAD\nAlready up to date.\n")])])]),n("h3",{attrs:{id:"创建-jenkinsfile-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#创建-jenkinsfile-2","aria-hidden":"true"}},[t._v("#")]),t._v(" 创建 Jenkinsfile")]),t._v(" "),n("p",[t._v("创建 Jenkinsfile 如下:")]),t._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[t._v("pipeline "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    agent "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        docker "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            image "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'node:10.12.0'")]),t._v("\n            args "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'-p 3000:3000 -p 5000:5000'")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    environment "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        CI "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'true'")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    stages "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        stage"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Build'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            steps "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                sh "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'npm config set registry https://registry.npm.taobao.org'")]),t._v("\n                sh "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'npm install'")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        stage"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Test'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            steps "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                sh "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./jenkins/scripts/test.sh'")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        stage"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Deliver for development'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            when "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                branch "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'development'")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n            steps "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                sh "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./jenkins/scripts/deliver-for-development.sh'")]),t._v("\n                input message: "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Finished using the web site? (Click \"Proceed\" to continue)'")]),t._v("\n                sh "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./jenkins/scripts/kill.sh'")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        stage"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Deploy for production'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            when "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                branch "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'production'")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n            steps "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                sh "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./jenkins/scripts/deploy-for-production.sh'")]),t._v("\n                input message: "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Finished using the web site? (Click \"Proceed\" to continue)'")]),t._v("\n                sh "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./jenkins/scripts/kill.sh'")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("h3",{attrs:{id:"创建多分支流水线"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#创建多分支流水线","aria-hidden":"true"}},[t._v("#")]),t._v(" 创建多分支流水线")]),t._v(" "),n("imgLink",{attrs:{src:"date/20190101/Jenkins/012.png"}}),t._v(" "),n("imgLink",{attrs:{src:"date/20190101/Jenkins/013.png"}}),t._v(" "),n("imgLink",{attrs:{src:"date/20190101/Jenkins/014.png"}}),t._v(" "),n("h2",{attrs:{id:"自由风格的软件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#自由风格的软件","aria-hidden":"true"}},[t._v("#")]),t._v(" 自由风格的软件")]),t._v(" "),n("ul",[n("li",[n("code",[t._v("General")]),t._v(" 基本配置")])]),t._v(" "),n("imgLink",{attrs:{src:"date/20190314/004.png"}}),t._v(" "),n("p",[t._v("添加一个仓库, 可能会报权限问题:")]),t._v(" "),n("imgLink",{attrs:{src:"date/20190314/001.png"}}),t._v(" "),n("p",[t._v("添加证书即可, 输入ssh私钥:")]),t._v(" "),n("imgLink",{attrs:{src:"date/20190314/003.png"}}),t._v(" "),n("p",[t._v("选择刚才添加的证书:")]),t._v(" "),n("imgLink",{attrs:{src:"date/20190314/002.png"}}),t._v(" "),n("ul",[n("li",[n("code",[t._v("Build Triggers")]),t._v(" 触发器")])]),t._v(" "),n("imgLink",{attrs:{src:"date/20190314/005.png"}}),t._v(" "),n("ul",[n("li",[n("code",[t._v("Build Environment")]),t._v(" 构建环境")])]),t._v(" "),n("imgLink",{attrs:{src:"date/20190314/006.png"}}),t._v(" "),n("ul",[n("li",[n("code",[t._v("Build")]),t._v(" 构建步骤")])]),t._v(" "),n("imgLink",{attrs:{src:"date/20190314/007.png"}}),t._v(" "),n("ul",[n("li",[n("code",[t._v("Post-build Actions")]),t._v(" 构建后行为")])]),t._v(" "),n("h2",{attrs:{id:"系统管理"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#系统管理","aria-hidden":"true"}},[t._v("#")]),t._v(" 系统管理")]),t._v(" "),n("h3",{attrs:{id:"全局工具配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#全局工具配置","aria-hidden":"true"}},[t._v("#")]),t._v(" 全局工具配置")]),t._v(" "),n("p",[t._v("配置已安装的Jenkins工具")]),t._v(" "),n("imgLink",{attrs:{src:"date/20190314/008.png"}}),t._v(" "),n("h3",{attrs:{id:"插件管理"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#插件管理","aria-hidden":"true"}},[t._v("#")]),t._v(" 插件管理")]),t._v(" "),n("p",[t._v("下载、安装和管理Jenkins插件")]),t._v(" "),n("imgLink",{attrs:{src:"date/20190314/009.png"}}),t._v(" "),n("p",[t._v("常用插件:")]),t._v(" "),n("ul",[n("li",[t._v("Pipeline")]),t._v(" "),n("li",[n("a",{attrs:{href:"https://plugins.jenkins.io/coding-webhook",target:"_blank",rel:"noopener noreferrer"}},[t._v("Coding Webhook Plugin"),n("OutboundLink")],1)]),t._v(" "),n("li",[n("a",{attrs:{href:"https://plugins.jenkins.io/nodejs",target:"_blank",rel:"noopener noreferrer"}},[t._v("NodeJS Plugin"),n("OutboundLink")],1),t._v("、"),n("a",{attrs:{href:"https://wiki.jenkins.io/display/JENKINS/NodeJS+Plugin",target:"_blank",rel:"noopener noreferrer"}},[t._v("wiki"),n("OutboundLink")],1)]),t._v(" "),n("li",[t._v("Workspace Cleanup Plugin")]),t._v(" "),n("li",[t._v("Blue Ocean")]),t._v(" "),n("li",[t._v("Build Timeout")])]),t._v(" "),n("h2",{attrs:{id:"jenkinsfile-详解"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#jenkinsfile-详解","aria-hidden":"true"}},[t._v("#")]),t._v(" Jenkinsfile 详解")]),t._v(" "),n("p",[n("a",{attrs:{href:"https://jenkins.io/zh/doc/book/pipeline/jenkinsfile/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Jenkinsfile"),n("OutboundLink")],1),t._v(" 中所有有效的声明式流水线必须包含在一个 pipeline 块中:")]),t._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[t._v("pipeline "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    /* insert Declarative Pipeline here */\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("h3",{attrs:{id:"agent"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#agent","aria-hidden":"true"}},[t._v("#")]),t._v(" agent")]),t._v(" "),n("p",[t._v("agent 指令告诉Jenkins在哪里以及如何执行Pipeline或者Pipeline子集。 正如您所预料的，所有的Pipeline都需要 agent 指令。")]),t._v(" "),n("p",[t._v("在执行引擎中，agent 指令会引起以下操作的执行：")]),t._v(" "),n("ul",[n("li",[t._v("所有在块block中的步骤steps会被Jenkins保存在一个执行队列中。 一旦一个执行器 executor 是可以利用的，这些步骤将会开始执行。")]),t._v(" "),n("li",[t._v("一个工作空间 workspace 将会被分配， 工作空间中会包含来自远程仓库的文件和一些用于Pipeline的工作文件")])]),t._v(" "),n("h3",{attrs:{id:"docker"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#docker","aria-hidden":"true"}},[t._v("#")]),t._v(" docker")]),t._v(" "),n("p",[t._v("使用给定的容器执行流水线或阶段。")]),t._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[t._v("agent "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    docker "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        image "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'maven:3-alpine'")]),t._v("\n        label "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'my-defined-label'")]),t._v("\n        args  "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'-v /tmp:/tmp'")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("h3",{attrs:{id:"各语言代理示例"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#各语言代理示例","aria-hidden":"true"}},[t._v("#")]),t._v(" 各语言代理示例")]),t._v(" "),n("p",[t._v("下面是一个简单的Pipeline各种语言示例。")]),t._v(" "),n("p",[t._v("Java")]),t._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[t._v("pipeline "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    agent "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" docker "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'maven:3.3.3'")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    stages "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        stage"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'build'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            steps "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                sh "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'mvn --version'")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[t._v("Node.js / JavaScript")]),t._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[t._v("pipeline "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    agent "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" docker "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'node:10.12.0'")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    stages "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        stage"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'build'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            steps "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                sh "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'npm --version'")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[t._v("Ruby")]),t._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[t._v("pipeline "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    agent "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" docker "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'ruby'")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    stages "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        stage"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'build'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            steps "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                sh "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'ruby --version'")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[t._v("Python")]),t._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[t._v("pipeline "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    agent "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" docker "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'python:3.5.1'")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    stages "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        stage"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'build'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            steps "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                sh "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'python --version'")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[t._v("PHP")]),t._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[t._v("pipeline "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    agent "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" docker "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'php'")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    stages "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        stage"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'build'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            steps "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                sh "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'php --version'")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("h3",{attrs:{id:"阶段级代理"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#阶段级代理","aria-hidden":"true"}},[t._v("#")]),t._v(" 阶段级代理")]),t._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[t._v("pipeline "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    agent none\n    stages "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        stage"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Example Build'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            agent "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" docker "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'maven:3-alpine'")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n            steps "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("echo")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Hello, Maven'")]),t._v("\n                sh "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'mvn --version'")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        stage"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Example Test'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            agent "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" docker "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'openjdk:8-jre'")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n            steps "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("echo")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Hello, JDK'")]),t._v("\n                sh "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'java -version'")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("h3",{attrs:{id:"stages"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#stages","aria-hidden":"true"}},[t._v("#")]),t._v(" stages")]),t._v(" "),n("p",[t._v("Pipelines由多重steps组成，包括构建、测试和部署等应用。 Jenkins Pipeline允许您使用一种简单的方式组合多重steps，以帮助您实现多种类型的自动化构建过程。")]),t._v(" "),n("p",[t._v("可以把“step”看作一个简单的命令去执行一个简单的动作，或者说是一个步骤。 当一个步骤运行成功时继续运行下一个步骤。 当任何一个步骤执行失败时，Pipeline的执行结果也为失败。")]),t._v(" "),n("p",[t._v("当所有的步骤都执行完成并且为成功时，Pipeline的执行结果为成功。")]),t._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[t._v("pipeline "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    agent any\n    stages "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        stage"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Example'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            steps "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("echo")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Hello World'")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        stage"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Test'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            steps "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("echo")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Test'")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("h3",{attrs:{id:"steps"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#steps","aria-hidden":"true"}},[t._v("#")]),t._v(" steps")]),t._v(" "),n("p",[t._v("steps 部分在给定的"),n("code",[t._v("stage")]),t._v(" 指令中执行的定义了一系列的一个或多个steps。")]),t._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[t._v("pipeline "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    agent any\n    stages "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        stage"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Example'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            steps "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                sh "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'whoami'")]),t._v("\n                "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("echo")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Hello World'")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("h3",{attrs:{id:"post"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#post","aria-hidden":"true"}},[t._v("#")]),t._v(" post")]),t._v(" "),n("p",[t._v("当Pipeline运行完成时，你可能需要做一些清理工作或者基于Pipeline的运行结果执行不同的操作， 这些操作可以放在 post 部分。")]),t._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[t._v("pipeline "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    agent any\n    stages "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        stage"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Test'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            steps "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                sh "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'echo \"Fail!\"; exit 1'")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    post "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        always "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("echo")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'This will always run'")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        success "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("echo")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'This will run only if successful'")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        failure "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("echo")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'This will run only if failed'")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        unstable "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("echo")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'This will run only if the run was marked as unstable'")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        changed "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("echo")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'This will run only if the state of the Pipeline has changed'")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("echo")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'For example, if the Pipeline was previously failing but is now successful'")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("h2",{attrs:{id:"jenkinsfile-示例"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#jenkinsfile-示例","aria-hidden":"true"}},[t._v("#")]),t._v(" jenkinsfile 示例")]),t._v(" "),n("h3",{attrs:{id:"使用jenkins构建vue项目的示例"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#使用jenkins构建vue项目的示例","aria-hidden":"true"}},[t._v("#")]),t._v(" 使用Jenkins构建Vue项目的示例")]),t._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[t._v("pipeline "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    agent "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" docker "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'node:latest'")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    stages "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        stage"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'build'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            steps "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                sh "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'whoami'")]),t._v("\n                sh "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'node --version'")]),t._v("\n                sh "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'npm --version'")]),t._v("\n                sh "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'npm config set chromedriver_cdnurl http://cdn.npm.taobao.org/dist/chromedriver'")]),t._v("\n                sh "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'npm config set sass_binary_site https://npm.taobao.org/mirrors/node-sass/'")]),t._v("\n                sh "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'npm config set phantomjs_cdnurl https://npm.taobao.org/mirrors/phantomjs/'")]),t._v("\n                sh "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'npm config set electron_mirror https://npm.taobao.org/mirrors/electron/'")]),t._v("\n                sh "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'npm install'")]),t._v("\n                sh "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'npm run build'")]),t._v("\n                sh "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'mkdir -p www'")]),t._v("\n                sh "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'rm -rf www/*'")]),t._v("\n                sh "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'\\\\cp -r -a dist/* www'")]),t._v("\n                sh "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'ls www'")]),t._v("\n                sh "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'pwd'")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[t._v("部署时使用 www 目录即可")]),t._v(" "),n("h2",{attrs:{id:"解决方案"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#解决方案","aria-hidden":"true"}},[t._v("#")]),t._v(" 解决方案")]),t._v(" "),n("h3",{attrs:{id:"卷权限问题"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#卷权限问题","aria-hidden":"true"}},[t._v("#")]),t._v(" 卷权限问题")]),t._v(" "),n("p",[t._v("如果挂载卷时提示权限错误 "),n("code",[t._v("Permission denied")]),t._v(", 有以下解决方案:")]),t._v(" "),n("ol",[n("li",[t._v("在运行容器的时候，给容器加特权，及加上 "),n("code",[t._v("--privileged=true")]),t._v(" 参数")]),t._v(" "),n("li",[t._v("临时关闭 selinux, 执行 "),n("code",[t._v("setenforce 0")])]),t._v(" "),n("li",[t._v("添加selinux规则，改变要挂载的目录的安全性文本")])]),t._v(" "),n("p",[t._v("查看容器内权限:")]),t._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[t._v("$ docker "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("exec")]),t._v(" jenkins "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("whoami")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("id")]),t._v("\n$ docker "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("exec")]),t._v(" jenkins "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("ls")]),t._v(" -la /var/jenkins_home\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# or")]),t._v("\n\n$ docker run -ti --rm --entrypoint"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/bin/bash"')]),t._v(" jenkinsci/blueocean -c "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"whoami && id"')]),t._v("\n$ docker run -ti --rm --entrypoint"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/bin/bash"')]),t._v(" jenkinsci/blueocean -c "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ls -la /var/jenkins_home"')]),t._v("\n")])])]),n("h2",{attrs:{id:"相关概念"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#相关概念","aria-hidden":"true"}},[t._v("#")]),t._v(" 相关概念")]),t._v(" "),n("h3",{attrs:{id:"jenkins-pipeline"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#jenkins-pipeline","aria-hidden":"true"}},[t._v("#")]),t._v(" Jenkins Pipeline")]),t._v(" "),n("p",[t._v('Jenkins Pipeline (或简称为"Pipeline")是一套插件，将持续交付的实现和实施集成到Jenkins中。')]),t._v(" "),n("p",[t._v("持续交付Pipeline自动化的表达了这样一种流程：将基于版本控制管理的软件持续的交付到您的用户和消费者手中。")]),t._v(" "),n("p",[t._v("Jenkins Pipeline提供了一套可扩展的工具，用于将“简单到复杂”的交付流程实现为“持续交付即代码”。 Jenkins Pipeline的定义通常被写入到一个文本文件（称为 Jenkinsfile ）中，该文件可以被检入到项目的源代码控制库中。")]),t._v(" "),n("h2",{attrs:{id:"参考资料"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#参考资料","aria-hidden":"true"}},[t._v("#")]),t._v(" 参考资料")]),t._v(" "),n("p",[t._v("教程")]),t._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"https://www.yiibai.com/jenkins/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Jenkins教程 - 易百教程"),n("OutboundLink")],1)]),t._v(" "),n("li",[n("a",{attrs:{href:"https://www.cnblogs.com/xiaoqi/p/docker-jenkins-cicd.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Docker+Jenkins持续集成环境（1）使用Docker搭建Jenkins+Docker持续集成环境"),n("OutboundLink")],1)])]),t._v(" "),n("p",[t._v("配置")]),t._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"https://blog.csdn.net/zzy1078689276/article/details/77494012",target:"_blank",rel:"noopener noreferrer"}},[t._v("Jenkins的Credentials（证书）管理"),n("OutboundLink")],1)])]),t._v(" "),n("p",[t._v("构建")]),t._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"https://blog.csdn.net/zxb730916/article/details/80913579",target:"_blank",rel:"noopener noreferrer"}},[t._v("使用 Jenkins 构建 Coding 项目"),n("OutboundLink")],1)]),t._v(" "),n("li",[n("a",{attrs:{href:"https://blog.csdn.net/gavid0124/article/details/53463831",target:"_blank",rel:"noopener noreferrer"}},[t._v("使用Jenkins自动编译部署web应用"),n("OutboundLink")],1)]),t._v(" "),n("li",[n("a",{attrs:{href:"https://jenkins.io/zh/doc/tutorials/build-a-node-js-and-react-app-with-npm/",target:"_blank",rel:"noopener noreferrer"}},[t._v("使用npm构建Node.js和React应用"),n("OutboundLink")],1)])]),t._v(" "),n("p",[t._v("插件")]),t._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"https://blog.csdn.net/houyefeng/article/details/51027885",target:"_blank",rel:"noopener noreferrer"}},[t._v("Jenkins——应用篇——插件使用——Publish over SSH"),n("OutboundLink")],1)]),t._v(" "),n("li",[n("a",{attrs:{href:"https://blog.csdn.net/tragedyxd/article/details/51861526",target:"_blank",rel:"noopener noreferrer"}},[t._v("Jenkins Publish over SSH，上传文件及执行命令"),n("OutboundLink")],1)]),t._v(" "),n("li",[n("a",{attrs:{href:"https://blog.csdn.net/u012946310/article/details/80969447",target:"_blank",rel:"noopener noreferrer"}},[t._v("jenkins通过SSH Publishers自动构建发包到远程服务器"),n("OutboundLink")],1)])]),t._v(" "),n("p",[t._v("Docker")]),t._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"https://www.jianshu.com/p/0391e225e4a6",target:"_blank",rel:"noopener noreferrer"}},[t._v("Docker版本Jenkins的使用"),n("OutboundLink")],1)]),t._v(" "),n("li",[n("a",{attrs:{href:"https://yq.aliyun.com/articles/53990",target:"_blank",rel:"noopener noreferrer"}},[t._v("谈谈 Docker Volume 之权限管理（一）"),n("OutboundLink")],1)])]),t._v(" "),n("p",[t._v("问题解决")]),t._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"https://www.jianshu.com/p/5854f6e9eaf0",target:"_blank",rel:"noopener noreferrer"}},[t._v("Docker容器搭建 Jenkines CI/CD踩坑记"),n("OutboundLink")],1)]),t._v(" "),n("li",[n("a",{attrs:{href:"https://blog.csdn.net/linuxiao/article/details/80116083",target:"_blank",rel:"noopener noreferrer"}},[t._v("Docker Permission denied"),n("OutboundLink")],1)]),t._v(" "),n("li",[n("a",{attrs:{href:"https://www.cnblogs.com/xinhaige/p/9687269.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("jenkins docker 错误总结"),n("OutboundLink")],1)]),t._v(" "),n("li",[n("a",{attrs:{href:"https://blog.csdn.net/qq_37212970/article/details/86610494",target:"_blank",rel:"noopener noreferrer"}},[t._v("Jenkins Build step 'Execute shell' marked build as failure"),n("OutboundLink")],1)])])],1)},[],!1,null,null,null);s.default=e.exports}}]);