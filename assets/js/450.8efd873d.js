(window.webpackJsonp=window.webpackJsonp||[]).push([[450],{606:function(t,s,a){"use strict";a.r(s);var n=a(1),e=Object(n.a)({},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"content"},[t._m(0),t._v(" "),t._m(1),t._v(" "),a("p",[t._v("当在同一个 PHP 项目中访问同一个项目中的接口的时候，会出现访问超时、加载不出数据甚至卡死的问题。")]),t._v(" "),t._m(2),t._v(" "),a("p",[t._v("NGINX 中，看 PHP 文件块 fastcig-pass 的设置值(127.0.0.1:9000)。设置都是以 keepalive 方式请求，接收到 PHP 文件时，交于后端过程 PHPCGI 解析处理(127.0.0.1:9000)，等待响应。")]),t._v(" "),a("p",[t._v("而在本地文件以 CURL 请求本地环境中 PHP 文件时，之前的 PHP 还在等待 CURL 后的结果，这时 9000 端口已经被占用。导致 CURL 一直在处于等待状态。不设置 timeout 超时，程序就会卡死。")]),t._v(" "),t._m(3),t._v(" "),a("p",[t._v("第一步，使用负载均衡的方式为 php-cgi 设置多个端口，比如:")]),t._v(" "),t._m(4),a("p",[t._v("第二步，重启 nginx，并新开启一个 phpcgi 进程监听不同端口，比如:")]),t._v(" "),t._m(5),t._m(6),t._v(" "),t._m(7),t._v(" "),a("p",[a("a",{attrs:{href:"https://www.cnblogs.com/wamptao/p/6381913.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("PHP----------用curl方式请求接口在同一个项目里面的时候不能请求的情况"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("a",{attrs:{href:"https://blog.csdn.net/yicixing7/article/details/77323706",target:"_blank",rel:"noopener noreferrer"}},[t._v("为什么本地开发时使用CURL请求本地URL会卡死"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("a",{attrs:{href:"https://blog.csdn.net/php_younger/article/details/54890136",target:"_blank",rel:"noopener noreferrer"}},[t._v("搭建nginx负载均衡"),a("OutboundLink")],1)])])},[function(){var t=this.$createElement,s=this._self._c||t;return s("h1",{attrs:{id:"nginx-服务器中-php-调用本地接口失败的解决方案"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#nginx-服务器中-php-调用本地接口失败的解决方案","aria-hidden":"true"}},[this._v("#")]),this._v(" Nginx 服务器中 PHP 调用本地接口失败的解决方案")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"问题现象"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#问题现象","aria-hidden":"true"}},[this._v("#")]),this._v(" 问题现象")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"问题原因"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#问题原因","aria-hidden":"true"}},[this._v("#")]),this._v(" 问题原因")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"解决方案"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#解决方案","aria-hidden":"true"}},[this._v("#")]),this._v(" 解决方案")])},function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"language-nginx line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[a("span",{attrs:{class:"token keyword"}},[t._v("upstream")]),t._v(" backend"),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{attrs:{class:"token keyword"}},[t._v("server")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("127.0")]),a("span",{attrs:{class:"token number"}},[t._v(".0")]),a("span",{attrs:{class:"token number"}},[t._v(".1")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{attrs:{class:"token number"}},[t._v("9000")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{attrs:{class:"token keyword"}},[t._v("server")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("127.0")]),a("span",{attrs:{class:"token number"}},[t._v(".0")]),a("span",{attrs:{class:"token number"}},[t._v(".1")]),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{attrs:{class:"token number"}},[t._v("9001")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{attrs:{class:"token keyword"}},[t._v("server")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{attrs:{class:"token keyword"}},[t._v("listen")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("80")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{attrs:{class:"token keyword"}},[t._v("server_name")]),t._v("  www"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("dyt_api"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("com "),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{attrs:{class:"token keyword"}},[t._v("root")]),t._v("   "),a("span",{attrs:{class:"token string"}},[t._v('"D:/projects/dyt_api/public"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{attrs:{class:"token keyword"}},[t._v("location")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("index")]),t._v("  "),a("span",{attrs:{class:"token keyword"}},[t._v("index")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("html "),a("span",{attrs:{class:"token keyword"}},[t._v("index")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("htm "),a("span",{attrs:{class:"token keyword"}},[t._v("index")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("php"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{attrs:{class:"token comment"}},[t._v("#autoindex  on;")]),t._v("\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token operator"}},[t._v("!")]),a("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v("e "),a("span",{attrs:{class:"token variable"}},[t._v("$request_filename")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{attrs:{class:"token keyword"}},[t._v("rewrite")]),t._v("  "),a("span",{attrs:{class:"token operator"}},[t._v("^")]),a("span",{attrs:{class:"token operator"}},[t._v("/")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token operator"}},[t._v("*")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("$  "),a("span",{attrs:{class:"token operator"}},[t._v("/")]),a("span",{attrs:{class:"token keyword"}},[t._v("index")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("php"),a("span",{attrs:{class:"token operator"}},[t._v("/")]),t._v("$"),a("span",{attrs:{class:"token number"}},[t._v("1")]),t._v("  last"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),a("span",{attrs:{class:"token keyword"}},[t._v("break")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{attrs:{class:"token keyword"}},[t._v("location")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("~")]),t._v(" \\"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token function"}},[t._v("php")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token operator"}},[t._v("*")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("$ "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("fastcgi_pass")]),t._v("   backend"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("fastcgi_index")]),t._v("  "),a("span",{attrs:{class:"token keyword"}},[t._v("index")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("php"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("fastcgi_split_path_info")]),t._v("  "),a("span",{attrs:{class:"token operator"}},[t._v("^")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token operator"}},[t._v("?")]),t._v("U"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token operator"}},[t._v("+")]),t._v("\\"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("php"),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{attrs:{class:"token operator"}},[t._v("/")]),a("span",{attrs:{class:"token operator"}},[t._v("?")]),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token operator"}},[t._v("+")]),a("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("$"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("fastcgi_param")]),t._v("  SCRIPT_FILENAME  "),a("span",{attrs:{class:"token variable"}},[t._v("$document_root")]),a("span",{attrs:{class:"token variable"}},[t._v("$fastcgi_script_name")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("fastcgi_param")]),t._v("  PATH_INFO  "),a("span",{attrs:{class:"token variable"}},[t._v("$fastcgi_path_info")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("fastcgi_param")]),t._v("  PATH_TRANSLATED  "),a("span",{attrs:{class:"token variable"}},[t._v("$document_root")]),a("span",{attrs:{class:"token variable"}},[t._v("$fastcgi_path_info")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{attrs:{class:"token keyword"}},[t._v("include")]),t._v("        fastcgi_params"),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br"),a("span",{staticClass:"line-number"},[t._v("20")]),a("br"),a("span",{staticClass:"line-number"},[t._v("21")]),a("br"),a("span",{staticClass:"line-number"},[t._v("22")]),a("br"),a("span",{staticClass:"line-number"},[t._v("23")]),a("br"),a("span",{staticClass:"line-number"},[t._v("24")]),a("br"),a("span",{staticClass:"line-number"},[t._v("25")]),a("br"),a("span",{staticClass:"line-number"},[t._v("26")]),a("br"),a("span",{staticClass:"line-number"},[t._v("27")]),a("br")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[this._v("D:\\phpStudy\\php70n\\php-cgi.exe -b 127.0.0.1:9001 -c D:\\phpStudy\\php70n\\php.ini\n")])]),this._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[this._v("1")]),s("br")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("使用 "),s("code",[this._v("netstat -no")]),this._v(" 命令查看端口是否工作正常。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"参考资料"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#参考资料","aria-hidden":"true"}},[this._v("#")]),this._v(" 参考资料")])}],!1,null,null,null);e.options.__file="Local_API.md";s.default=e.exports}}]);