(window.webpackJsonp=window.webpackJsonp||[]).push([[57],{456:function(s,t,a){"use strict";a.r(t);var e=a(1),n=Object(e.a)({},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"content"},[s._m(0),s._v(" "),s._m(1),s._v(" "),a("imgLink",{attrs:{src:"date/20181026/007.png/small"}}),s._v(" "),a("p",[s._v("原理：在两台主机上，配置可相互通讯的网桥，将不同主机中 Docker 的网桥连接到此网桥。")]),s._v(" "),s._m(2),s._v(" "),s._m(3),s._v(" "),a("p",[s._v("ovs （Open VSwitch） 是一个高质量、多层虚拟交换机，使用开源Apache2.0许可协议，由 Nicira Networks 开发，主要实现代码为可移植的 C 代码。它的目的是让大规模网络自动化可以通过编程扩展，同时仍然支持标准的管理接口和协议（例如 NetFlow，SFlow，SPAN，RSPAN，CLI，LACP，802.lag）")]),s._v(" "),a("imgLink",{attrs:{src:"date/20181026/008.png/small"}}),s._v(" "),s._m(4),s._v(" "),a("p",[s._v("GRE：通用路由协议封装。")]),s._v(" "),a("p",[s._v("隧道技术（Tunneling）是一种通过使用互联网络的基础设施在网络之间传递数据的方式。使用隧道传递的数据(或负载)可以是不同协议的数据帧或包。隧道协议将其它协议的数据帧或包重新封裝然后通过隧道发送。新的帧头提供路由信息,以便通过互联网传递被封装的负载数据。")]),s._v(" "),s._m(5),s._v(" "),a("p",[s._v("安装")]),s._v(" "),s._m(6),a("p",[s._v("检测安装")]),s._v(" "),s._m(7),a("p",[s._v("添加 ovs 网桥 obr0")]),s._v(" "),s._m(8),a("p",[s._v("为 obr0 添加接口 gre0")]),s._v(" "),s._m(9),a("p",[s._v("设置接口类型")]),s._v(" "),s._m(10),a("p",[s._v("使用网桥管理工具在物理机新建一个 br0 的网桥，并设置其 ip")]),s._v(" "),s._m(11),a("p",[s._v("为 br0 网桥添加 ovs 网桥的连接")]),s._v(" "),s._m(12),s._m(13),s._v(" "),s._m(14),s._v(" "),s._m(15),a("p",[s._v("编写脚本，使其开机自启：")]),s._v(" "),s._m(16),s._v(" "),s._m(17),a("p",[s._v("修改其权限")]),s._v(" "),s._m(18),s._m(19),s._v(" "),s._m(20),a("p",[s._v("参考：")]),s._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://blog.csdn.net/tantexian/article/details/46707175",target:"_blank",rel:"noopener noreferrer"}},[s._v("OpenvSwitch完全使用手册"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://blog.csdn.net/xyq54/article/details/51371819",target:"_blank",rel:"noopener noreferrer"}},[s._v("ovs-vsctl: unix:/usr/local/var/run/openvswitch/db.sock: database connection failed"),a("OutboundLink")],1)])])],1)},[function(){var s=this.$createElement,t=this._self._c||s;return t("h1",{attrs:{id:"docker-跨主机连接"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#docker-跨主机连接","aria-hidden":"true"}},[this._v("#")]),this._v(" Docker 跨主机连接")])},function(){var s=this.$createElement,t=this._self._c||s;return t("h2",{attrs:{id:"使用网桥连接"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用网桥连接","aria-hidden":"true"}},[this._v("#")]),this._v(" 使用网桥连接")])},function(){var s=this.$createElement,t=this._self._c||s;return t("h2",{attrs:{id:"使用-open-vswitch-连接"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用-open-vswitch-连接","aria-hidden":"true"}},[this._v("#")]),this._v(" 使用 Open vSwitch 连接")])},function(){var s=this.$createElement,t=this._self._c||s;return t("h3",{attrs:{id:"什么是-open-vswitch"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#什么是-open-vswitch","aria-hidden":"true"}},[this._v("#")]),this._v(" 什么是 Open VSwitch")])},function(){var s=this.$createElement,t=this._self._c||s;return t("h3",{attrs:{id:"什么是-gre-隧道"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#什么是-gre-隧道","aria-hidden":"true"}},[this._v("#")]),this._v(" 什么是 GRE 隧道")])},function(){var s=this.$createElement,t=this._self._c||s;return t("h3",{attrs:{id:"使用-ovs-实现跨主机通讯"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用-ovs-实现跨主机通讯","aria-hidden":"true"}},[this._v("#")]),this._v(" 使用 ovs 实现跨主机通讯")])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ "),a("span",{attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" "),a("span",{attrs:{class:"token function"}},[s._v("install")]),s._v(" openvswitch-switch\n// or\n$ yum "),a("span",{attrs:{class:"token function"}},[s._v("install")]),s._v(" openvswitch\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[this._v("$ ovs-vsctl show\nfdbecc9f-193a-45c0-b1b7-599d53e22df9\n    ovs_version: "),t("span",{attrs:{class:"token string"}},[this._v('"2.10.1"')]),this._v("\n")])]),this._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[this._v("1")]),t("br"),t("span",{staticClass:"line-number"},[this._v("2")]),t("br"),t("span",{staticClass:"line-number"},[this._v("3")]),t("br")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[this._v("$ ovs-vsctl add-br obr0\n")])]),this._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[this._v("1")]),t("br")])])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ ovs-vsctl add-port obr0 gre0\novs-vsctl: Error detected "),a("span",{attrs:{class:"token keyword"}},[s._v("while")]),s._v(" setting up "),a("span",{attrs:{class:"token string"}},[s._v("'gre0'")]),a("span",{attrs:{class:"token keyword"}},[s._v(":")]),s._v(" could not add network device gre0 to ofproto "),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Invalid argument"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v(".  See ovs-vswitchd log "),a("span",{attrs:{class:"token keyword"}},[s._v("for")]),s._v(" details.\novs-vsctl: The default log directory is "),a("span",{attrs:{class:"token string"}},[s._v('"/usr/local/var/log/openvswitch"')]),a("span",{attrs:{class:"token keyword"}},[s._v(".")]),s._v("\n\n$ ovs-vsctl show\nfdbecc9f-193a-45c0-b1b7-599d53e22df9\n    Bridge "),a("span",{attrs:{class:"token string"}},[s._v('"obr0"')]),s._v("\n        Port "),a("span",{attrs:{class:"token string"}},[s._v('"gre0"')]),s._v("\n            Interface "),a("span",{attrs:{class:"token string"}},[s._v('"gre0"')]),s._v("\n                error: "),a("span",{attrs:{class:"token string"}},[s._v('"could not add network device gre0 to ofproto (Invalid argument)"')]),s._v("\n        Port "),a("span",{attrs:{class:"token string"}},[s._v('"obr0"')]),s._v("\n            Interface "),a("span",{attrs:{class:"token string"}},[s._v('"obr0"')]),s._v("\n                type: internal\n    ovs_version: "),a("span",{attrs:{class:"token string"}},[s._v('"2.10.1"')]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ ovs-vsctl "),a("span",{attrs:{class:"token keyword"}},[s._v("set")]),s._v(" interface gre0 type"),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("gre options:remote_ip"),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("192.168.42.131\n\n$ ovs-vsctl show\nfdbecc9f-193a-45c0-b1b7-599d53e22df9\n    Bridge "),a("span",{attrs:{class:"token string"}},[s._v('"obr0"')]),s._v("\n        Port "),a("span",{attrs:{class:"token string"}},[s._v('"gre0"')]),s._v("\n            Interface "),a("span",{attrs:{class:"token string"}},[s._v('"gre0"')]),s._v("\n                type: gre\n                options: "),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("remote_ip"),a("span",{attrs:{class:"token operator"}},[s._v("=")]),a("span",{attrs:{class:"token string"}},[s._v('"192.168.42.131"')]),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        Port "),a("span",{attrs:{class:"token string"}},[s._v('"obr0"')]),s._v("\n            Interface "),a("span",{attrs:{class:"token string"}},[s._v('"obr0"')]),s._v("\n                type: internal\n    ovs_version: "),a("span",{attrs:{class:"token string"}},[s._v('"2.10.1"')]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[this._v("$ brctl addbr br0\n$ "),t("span",{attrs:{class:"token function"}},[this._v("ifconfig")]),this._v(" br0 192.168.1.1 netmask 255.255.255.0\n")])]),this._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[this._v("1")]),t("br"),t("span",{staticClass:"line-number"},[this._v("2")]),t("br")])])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ brctl addif br0 obr0\n$ brctl show\nbridge name\tbridge "),a("span",{attrs:{class:"token function"}},[s._v("id")]),s._v("\t\tSTP enabled\tinterfaces\nbr0\t\t8000.aed32285704b\tno\t\tobr0\ndocker0\t\t8000.0242a6aa2d07\tno\t\t\nvirbr0\t\t8000.525400e0956a\t"),a("span",{attrs:{class:"token function"}},[s._v("yes")]),s._v("\t\tvirbr0-nic\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("h3",{attrs:{id:"错误解决"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#错误解决","aria-hidden":"true"}},[this._v("#")]),this._v(" 错误解决")])},function(){var s=this.$createElement,t=this._self._c||s;return t("p",[t("code",[this._v("ovs-vsctl: unix:/usr/local/var/run/openvswitch/db.sock: database connection failed")]),this._v(" 解决方案")])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ ovsdb-server  --remote"),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("punix:/usr/local/var/run/openvswitch/db.sock \\\n                --remote"),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("db:Open_vSwitch,Open_vSwitch,manager_options \\\n                --private-key"),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("db:Open_vSwitch,SSL,private_key \\\n                --certificate"),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("db:Open_vSwitch,SSL,certificate \\\n                --bootstrap-ca-cert"),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("db:Open_vSwitch,SSL,ca_cert \\\n                --pidfile --detach\n$ ovs-vsctl --no-wait init\n$ ovs-vswitchd --pidfile --detach\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("p",[t("code",[this._v("/root/autorun.sh")])])},function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{attrs:{class:"token shebang important"}},[s._v("#!/bin/bash")]),s._v("\novsdb-server --remote"),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("punix:/usr/local/var/run/openvswitch/db.sock --remote"),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("db:Open_vSwitch,Open_vSwitch,manager_options --pidfile --detach\novs-vsctl --no-wait init\novs-vswitchd --pidfile --detach --log-file\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[this._v("$ "),t("span",{attrs:{class:"token function"}},[this._v("chmod")]),this._v(" 777 autorun.sh\n")])]),this._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[this._v("1")]),t("br")])])},function(){var s=this.$createElement,t=this._self._c||s;return t("p",[this._v("将其添加到开机自启列表，把路径添加到 "),t("code",[this._v("/etc/rc.d/rc.local")]),this._v(" 中")])},function(){var s=this.$createElement,t=this._self._c||s;return t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{attrs:{class:"token function"}},[this._v("source")]),this._v(" /root/autorun.sh\n")])]),this._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[this._v("1")]),t("br")])])}],!1,null,null,null);n.options.__file="Link.md";t.default=n.exports}}]);