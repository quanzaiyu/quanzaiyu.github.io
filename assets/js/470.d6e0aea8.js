(window.webpackJsonp=window.webpackJsonp||[]).push([[470],{466:function(s,t,a){"use strict";a.r(t);var n=a(1),e=Object(n.a)({},function(){this.$createElement;this._self._c;return this._m(0)},[function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("div",{staticClass:"content"},[a("h1",{attrs:{id:"mysql-事务详解"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mysql-事务详解","aria-hidden":"true"}},[s._v("#")]),s._v(" MySQL 事务详解")]),s._v(" "),a("p",[s._v("MySQL 事务主要用于处理操作量大，复杂度高的数据。比如说，在人员管理系统中，你删除一个人员，你即需要删除人员的基本资料，也要删除和该人员相关的信息，如信箱，文章等等，这样，这些数据库操作语句就构成一个事务！")]),s._v(" "),a("ul",[a("li",[s._v("在 MySQL 中只有使用了 Innodb 数据库引擎的数据库或表才支持事务。")]),s._v(" "),a("li",[s._v("事务处理可以用来维护数据库的完整性，保证成批的 SQL 语句要么全部执行，要么全部不执行。")]),s._v(" "),a("li",[s._v("事务用来管理 insert,update,delete 语句")])]),s._v(" "),a("h2",{attrs:{id:"事务的特性"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#事务的特性","aria-hidden":"true"}},[s._v("#")]),s._v(" 事务的特性")]),s._v(" "),a("p",[s._v("一般来说，事务是必须满足4个条件（ACID）：原子性（Atomicity，或称不可分割性）、一致性（Consistency）、隔离性（Isolation，又称独立性）、持久性（Durability）。")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("原子性：")]),s._v(" 一个事务（transaction）中的所有操作，要么全部完成，要么全部不完成，不会结束在中间某个环节。事务在执行过程中发生错误，会被回滚（Rollback）到事务开始前的状态，就像这个事务从来没有执行过一样。")]),s._v(" "),a("li",[a("strong",[s._v("一致性：")]),s._v(" 在事务开始之前和事务结束以后，数据库的完整性没有被破坏。这表示写入的资料必须完全符合所有的预设规则，这包含资料的精确度、串联性以及后续数据库可以自发性地完成预定的工作。")]),s._v(" "),a("li",[a("strong",[s._v("隔离性：")]),s._v(" 数据库允许多个并发事务同时对其数据进行读写和修改的能力，隔离性可以防止多个事务并发执行时由于交叉执行而导致数据的不一致。事务隔离分为不同级别，包括读未提交（Read uncommitted）、读提交（read committed）、可重复读（repeatable read）和串行化（Serializable）。")]),s._v(" "),a("li",[a("strong",[s._v("持久性：")]),s._v(" 事务处理结束后，对数据的修改就是永久的，即便系统故障也不会丢失。")])]),s._v(" "),a("blockquote",[a("p",[s._v("在 MySQL 命令行的默认设置下，事务都是自动提交的，即执行 SQL 语句后就会马上执行 COMMIT 操作。因此要显式地开启一个事务务须使用命令 BEGIN 或 START TRANSACTION，或者执行命令 SET AUTOCOMMIT=0，用来禁止使用当前会话的自动提交。")])]),s._v(" "),a("h2",{attrs:{id:"事务控制语句"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#事务控制语句","aria-hidden":"true"}},[s._v("#")]),s._v(" 事务控制语句")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("BEGIN TRANSACTION")]),s._v(" 或 "),a("strong",[s._v("START TRANSACTION")]),s._v("：显式地开启一个事务；")]),s._v(" "),a("li",[a("strong",[s._v("COMMIT")]),s._v("：也可以使用 COMMIT WORK，不过二者是等价的。COMMIT 会提交事务，并使已对数据库进行的所有修改成为永久性的；")]),s._v(" "),a("li",[a("strong",[s._v("ROLLBACK")]),s._v("：有可以使用 ROLLBACK WORK，不过二者是等价的。回滚会结束用户的事务，并撤销正在进行的所有未提交的修改；")]),s._v(" "),a("li",[a("strong",[s._v("SAVEPOINT identifier")]),s._v("：SAVEPOINT 允许在事务中创建一个保存点，一个事务中可以有多个 SAVEPOINT；")]),s._v(" "),a("li",[a("strong",[s._v("RELEASE SAVEPOINT identifier")]),s._v("：删除一个事务的保存点，当没有指定的保存点时，执行该语句会抛出一个异常；")]),s._v(" "),a("li",[a("strong",[s._v("ROLLBACK TO identifier")]),s._v("：把事务回滚到标记点；")]),s._v(" "),a("li",[a("strong",[s._v("SET TRANSACTION")]),s._v("：用来设置事务的隔离级别。InnoDB 存储引擎提供事务的隔离级别有 READ UNCOMMITTED、READ COMMITTED、REPEATABLE READ 和 SERIALIZABLE。")])]),s._v(" "),a("h2",{attrs:{id:"mysql-事务处理主要有两种方法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mysql-事务处理主要有两种方法","aria-hidden":"true"}},[s._v("#")]),s._v(" MYSQL 事务处理主要有两种方法")]),s._v(" "),a("p",[s._v("1、用 BEGIN, ROLLBACK, COMMIT 来实现")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("BEGIN")]),s._v(" 开始一个事务")]),s._v(" "),a("li",[a("strong",[s._v("ROLLBACK")]),s._v(" 事务回滚")]),s._v(" "),a("li",[a("strong",[s._v("COMMIT")]),s._v(" 事务确认")])]),s._v(" "),a("p",[s._v("2、直接用 SET 来改变 MySQL 的自动提交模式")]),s._v(" "),a("ul",[a("li",[a("strong",[s._v("SET AUTOCOMMIT=0")]),s._v(" 禁止自动提交")]),s._v(" "),a("li",[a("strong",[s._v("SET AUTOCOMMIT=1")]),s._v(" 开启自动提交")])]),s._v(" "),a("h2",{attrs:{id:"事务测试"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#事务测试","aria-hidden":"true"}},[s._v("#")]),s._v(" 事务测试")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("mysql"),a("span",{attrs:{class:"token operator"}},[s._v(">")]),s._v(" use RUNOOB"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nDatabase changed\nmysql"),a("span",{attrs:{class:"token operator"}},[s._v(">")]),s._v(" CREATE TABLE runoob_transaction_test"),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v(" "),a("span",{attrs:{class:"token function"}},[s._v("id")]),s._v(" int"),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("5"),a("span",{attrs:{class:"token punctuation"}},[s._v("))")]),s._v(" engine"),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v("innodb"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  "),a("span",{attrs:{class:"token comment"}},[s._v("# 创建数据表")]),s._v("\nQuery OK, 0 rows affected "),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("0.04 sec"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\nmysql"),a("span",{attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("select")]),s._v(" * from runoob_transaction_test"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nEmpty "),a("span",{attrs:{class:"token keyword"}},[s._v("set")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("0.01 sec"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\nmysql"),a("span",{attrs:{class:"token operator"}},[s._v(">")]),s._v(" begin"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  "),a("span",{attrs:{class:"token comment"}},[s._v("# 开始事务")]),s._v("\nQuery OK, 0 rows affected "),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("0.00 sec"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\nmysql"),a("span",{attrs:{class:"token operator"}},[s._v(">")]),s._v(" insert into runoob_transaction_test value"),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("5"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nQuery OK, 1 rows affected "),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("0.01 sec"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\nmysql"),a("span",{attrs:{class:"token operator"}},[s._v(">")]),s._v(" insert into runoob_transaction_test value"),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("6"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nQuery OK, 1 rows affected "),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("0.00 sec"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\nmysql"),a("span",{attrs:{class:"token operator"}},[s._v(">")]),s._v(" commit"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{attrs:{class:"token comment"}},[s._v("# 提交事务")]),s._v("\nQuery OK, 0 rows affected "),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("0.01 sec"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\nmysql"),a("span",{attrs:{class:"token operator"}},[s._v(">")]),s._v("  "),a("span",{attrs:{class:"token keyword"}},[s._v("select")]),s._v(" * from runoob_transaction_test"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n+------+\n"),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{attrs:{class:"token function"}},[s._v("id")]),s._v("   "),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+------+\n"),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" 5    "),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" 6    "),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+------+\n2 rows "),a("span",{attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("set")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("0.01 sec"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\nmysql"),a("span",{attrs:{class:"token operator"}},[s._v(">")]),s._v(" begin"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("    "),a("span",{attrs:{class:"token comment"}},[s._v("# 开始事务")]),s._v("\nQuery OK, 0 rows affected "),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("0.00 sec"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\nmysql"),a("span",{attrs:{class:"token operator"}},[s._v(">")]),s._v("  insert into runoob_transaction_test values"),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("7"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nQuery OK, 1 rows affected "),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("0.00 sec"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\nmysql"),a("span",{attrs:{class:"token operator"}},[s._v(">")]),s._v(" rollback"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("   "),a("span",{attrs:{class:"token comment"}},[s._v("# 回滚")]),s._v("\nQuery OK, 0 rows affected "),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("0.00 sec"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\nmysql"),a("span",{attrs:{class:"token operator"}},[s._v(">")]),s._v("   "),a("span",{attrs:{class:"token keyword"}},[s._v("select")]),s._v(" * from runoob_transaction_test"),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("   "),a("span",{attrs:{class:"token comment"}},[s._v("# 因为回滚所以数据没有插入")]),s._v("\n+------+\n"),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{attrs:{class:"token function"}},[s._v("id")]),s._v("   "),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+------+\n"),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" 5    "),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v(" 6    "),a("span",{attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+------+\n2 rows "),a("span",{attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),a("span",{attrs:{class:"token keyword"}},[s._v("set")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v("0.01 sec"),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\nmysql"),a("span",{attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br")])]),a("h2",{attrs:{id:"php中使用事务实例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#php中使用事务实例","aria-hidden":"true"}},[s._v("#")]),s._v(" PHP中使用事务实例")]),s._v(" "),a("div",{staticClass:"language-php line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-php"}},[a("code",[a("span",{attrs:{class:"token php language-php"}},[a("span",{attrs:{class:"token delimiter important"}},[s._v("<?php")]),s._v("\n"),a("span",{attrs:{class:"token variable"}},[s._v("$dbhost")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{attrs:{class:"token single-quoted-string string"}},[s._v("'localhost:3306'")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  "),a("span",{attrs:{class:"token comment"}},[s._v("// mysql服务器主机地址")]),s._v("\n"),a("span",{attrs:{class:"token variable"}},[s._v("$dbuser")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{attrs:{class:"token single-quoted-string string"}},[s._v("'root'")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("            "),a("span",{attrs:{class:"token comment"}},[s._v("// mysql用户名")]),s._v("\n"),a("span",{attrs:{class:"token variable"}},[s._v("$dbpass")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{attrs:{class:"token single-quoted-string string"}},[s._v("'123456'")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("          "),a("span",{attrs:{class:"token comment"}},[s._v("// mysql用户名密码")]),s._v("\n"),a("span",{attrs:{class:"token variable"}},[s._v("$conn")]),s._v(" "),a("span",{attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{attrs:{class:"token function"}},[s._v("mysqli_connect")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token variable"}},[s._v("$dbhost")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token variable"}},[s._v("$dbuser")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token variable"}},[s._v("$dbpass")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{attrs:{class:"token keyword"}},[s._v("if")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token operator"}},[s._v("!")]),s._v(" "),a("span",{attrs:{class:"token variable"}},[s._v("$conn")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{attrs:{class:"token keyword"}},[s._v("die")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token single-quoted-string string"}},[s._v("'连接失败: '")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v(".")]),s._v(" "),a("span",{attrs:{class:"token function"}},[s._v("mysqli_error")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token variable"}},[s._v("$conn")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{attrs:{class:"token comment"}},[s._v("// 设置编码，防止中文乱码")]),s._v("\n"),a("span",{attrs:{class:"token function"}},[s._v("mysqli_query")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token variable"}},[s._v("$conn")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token double-quoted-string string"}},[s._v('"set names utf8"')]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{attrs:{class:"token function"}},[s._v("mysqli_select_db")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),s._v(" "),a("span",{attrs:{class:"token variable"}},[s._v("$conn")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token single-quoted-string string"}},[s._v("'RUNOOB'")]),s._v(" "),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{attrs:{class:"token function"}},[s._v("mysqli_query")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token variable"}},[s._v("$conn")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token double-quoted-string string"}},[s._v('"SET AUTOCOMMIT=0"')]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{attrs:{class:"token comment"}},[s._v("// 设置为不自动提交，因为MYSQL默认立即执行")]),s._v("\n"),a("span",{attrs:{class:"token function"}},[s._v("mysqli_begin_transaction")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token variable"}},[s._v("$conn")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("            "),a("span",{attrs:{class:"token comment"}},[s._v("// 开始事务定义")]),s._v("\n\n"),a("span",{attrs:{class:"token keyword"}},[s._v("if")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token operator"}},[s._v("!")]),a("span",{attrs:{class:"token function"}},[s._v("mysqli_query")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token variable"}},[s._v("$conn")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token double-quoted-string string"}},[s._v('"insert into runoob_transaction_test (id) values(8)"')]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{attrs:{class:"token function"}},[s._v("mysqli_query")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token variable"}},[s._v("$conn")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token double-quoted-string string"}},[s._v('"ROLLBACK"')]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("     "),a("span",{attrs:{class:"token comment"}},[s._v("// 判断当执行失败时回滚")]),s._v("\n"),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),a("span",{attrs:{class:"token keyword"}},[s._v("if")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token operator"}},[s._v("!")]),a("span",{attrs:{class:"token function"}},[s._v("mysqli_query")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token variable"}},[s._v("$conn")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token double-quoted-string string"}},[s._v('"insert into runoob_transaction_test (id) values(9)"')]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{attrs:{class:"token function"}},[s._v("mysqli_query")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token variable"}},[s._v("$conn")]),a("span",{attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{attrs:{class:"token double-quoted-string string"}},[s._v('"ROLLBACK"')]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("      "),a("span",{attrs:{class:"token comment"}},[s._v("// 判断执行失败时回滚")]),s._v("\n"),a("span",{attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{attrs:{class:"token function"}},[s._v("mysqli_commit")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token variable"}},[s._v("$conn")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("            "),a("span",{attrs:{class:"token comment"}},[s._v("//执行事务")]),s._v("\n"),a("span",{attrs:{class:"token function"}},[s._v("mysqli_close")]),a("span",{attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{attrs:{class:"token variable"}},[s._v("$conn")]),a("span",{attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{attrs:{class:"token delimiter important"}},[s._v("?>")])]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br")])])])}],!1,null,null,null);e.options.__file="Transaction.md";t.default=e.exports}}]);