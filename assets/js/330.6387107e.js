(window.webpackJsonp=window.webpackJsonp||[]).push([[330],{770:function(t,s,n){"use strict";n.r(s);var a=n(0),e=Object(a.a)({},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h1",{attrs:{id:"单分支流水线"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#单分支流水线","aria-hidden":"true"}},[t._v("#")]),t._v(" 单分支流水线")]),t._v(" "),n("h2",{attrs:{id:"克隆-git-仓库"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#克隆-git-仓库","aria-hidden":"true"}},[t._v("#")]),t._v(" 克隆 git 仓库")]),t._v(" "),n("p",[t._v("以一个简单的 react 项目为例, 首先将仓库克隆到本地")]),t._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[t._v("$ "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" clone https://github.com/quanzaiyu/building-a-multibranch-pipeline-project.git\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("pwd")]),t._v("\n/home/data/building-a-multibranch-pipeline-project\n")])])]),n("h2",{attrs:{id:"创建单流水线"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#创建单流水线","aria-hidden":"true"}},[t._v("#")]),t._v(" 创建单流水线")]),t._v(" "),n("p",[t._v("在 Jenkins 中创建一条流水线")]),t._v(" "),n("imgLink",{attrs:{src:"date/20190101/Jenkins/008.png"}}),t._v(" "),n("p",[t._v("找到 "),n("code",[t._v("Pipeline")]),t._v(" 选项, Definition 选择 "),n("code",[t._v("Pipeline script from SCM")]),t._v(", 在 SCM 中选择 "),n("code",[t._v("Git")])]),t._v(" "),n("imgLink",{attrs:{src:"date/20190101/Jenkins/009.png"}}),t._v(" "),n("h2",{attrs:{id:"创建-jenkinsfile"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#创建-jenkinsfile","aria-hidden":"true"}},[t._v("#")]),t._v(" 创建 Jenkinsfile")]),t._v(" "),n("p",[t._v("创建 Jenkinsfile, 输入以下内容")]),t._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[t._v("$ vim Jenkinsfile\npipeline "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    agent "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        docker "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            image "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'node:6-alpine'")]),t._v("\n            args "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'-p 3000:3000'")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    environment "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        CI "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'true'")]),t._v(" \n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    stages "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        stage"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Build'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            steps "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                sh "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'npm config set registry https://registry.npm.taobao.org'")]),t._v("\n                sh "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'npm install'")]),t._v("\n                sh "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'npm run build'")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        stage"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Test'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" \n            steps "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                sh "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./jenkins/scripts/test.sh'")]),t._v(" \n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[t._v("修改 Jenkinsfile 后需要提交修改")]),t._v(" "),n("div",{staticClass:"language-bash extra-class"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[t._v("$ "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" add "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v(".")]),t._v("\n$ "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" commit -m 0\n")])])]),n("h2",{attrs:{id:"运行流水线"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#运行流水线","aria-hidden":"true"}},[t._v("#")]),t._v(" 运行流水线")]),t._v(" "),n("p",[t._v("在浏览器中打开 "),n("code",[t._v("Open Blue Ocean")]),t._v(", 选择运行, 可以看到输出结果:")]),t._v(" "),n("imgLink",{attrs:{src:"date/20190101/Jenkins/010.png"}}),t._v(" "),n("imgLink",{attrs:{src:"date/20190101/Jenkins/011.png"}}),t._v(" "),n("p",[t._v("使用 Jenkins 项目的检出位于 "),n("code",[t._v("/var/jenkins_home/workspace/")])])],1)},[],!1,null,null,null);e.options.__file="pipeline.md";s.default=e.exports}}]);