<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>关于微信公众平台的开发记录 | 小昱个人网站</title>
    <meta name="description" content="小昱个人网站">
    <meta http-equiv="Expires" content="Mon,12 May 2050 00:20:00 GMT">
  <link rel="icon" href="/logo.png">
  <link rel="manifest" href="/manifest.json">
  <link rel="stylesheet" href="//at.alicdn.com/t/font_517060_lom78h954w.css">
  <link rel="stylesheet" href="https://img.xiaoyulive.top/css/animate.css">
    
    <link rel="preload" href="/assets/css/0.styles.24fc6e4b.css" as="style"><link rel="preload" href="/assets/js/app.33f73489.js" as="script"><link rel="preload" href="/assets/js/5.7bea38e3.js" as="script"><link rel="prefetch" href="/assets/js/1.a3dcb58e.js"><link rel="prefetch" href="/assets/js/10.ecd1419a.js"><link rel="prefetch" href="/assets/js/11.a0f7eda4.js"><link rel="prefetch" href="/assets/js/12.a9f191c5.js"><link rel="prefetch" href="/assets/js/13.34f3591b.js"><link rel="prefetch" href="/assets/js/14.d0f490d5.js"><link rel="prefetch" href="/assets/js/15.92eafcb9.js"><link rel="prefetch" href="/assets/js/2.b87d5e0b.js"><link rel="prefetch" href="/assets/js/6.fef674ae.js"><link rel="prefetch" href="/assets/js/7.420ae82d.js"><link rel="prefetch" href="/assets/js/8.ad06e931.js"><link rel="prefetch" href="/assets/js/9.63a23b63.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.3953f9da.js">
    <link rel="stylesheet" href="/assets/css/0.styles.24fc6e4b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-38547c78><header class="navbar" data-v-38547c78><div class="navbar-content"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div><a href="/" class="home-link router-link-active"><img src="/logo.png" class="logo"><span class="site-name can-hide">小昱个人网站</span></a><div class="links"><nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link">开发者博客</a></div><div class="nav-item"><a href="/articles/" class="nav-link">生活漫谈</a></div><div class="nav-item"><a href="/note/" class="nav-link">阅读札记</a></div><div class="nav-item"><a href="/categories/" class="nav-link router-link-active">学无止境</a></div><div class="nav-item"><a href="/share/" class="nav-link">精品分享</a></div><div class="nav-item"><a href="/favorite/" class="nav-link">收藏夹</a></div><!----></nav><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""><!----></div></div></div></header><div class="sidebar-mask" data-v-38547c78></div><div class="sidebar" data-v-38547c78><div class="sidebar-container"><nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link">开发者博客</a></div><div class="nav-item"><a href="/articles/" class="nav-link">生活漫谈</a></div><div class="nav-item"><a href="/note/" class="nav-link">阅读札记</a></div><div class="nav-item"><a href="/categories/" class="nav-link router-link-active">学无止境</a></div><div class="nav-item"><a href="/share/" class="nav-link">精品分享</a></div><div class="nav-item"><a href="/favorite/" class="nav-link">收藏夹</a></div><!----></nav><ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>关于微信公众平台的开发记录</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/categories/cloud/tencent/_pages/Jssdk.html#准备工作" class="sidebar-link">准备工作</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/categories/cloud/tencent/_pages/Jssdk.html#php服务器端配置" class="sidebar-link">PHP服务器端配置</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/categories/cloud/tencent/_pages/Jssdk.html#客户端配置" class="sidebar-link">客户端配置</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/categories/cloud/tencent/_pages/Jssdk.html#常用接口的使用" class="sidebar-link">常用接口的使用</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/categories/cloud/tencent/_pages/Jssdk.html#注意事项" class="sidebar-link">注意事项</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/categories/cloud/tencent/_pages/Jssdk.html#关于ios单页应用分享失败的解决" class="sidebar-link">关于iOS单页应用分享失败的解决</a></li></ul></li><li><a href="/categories/cloud/tencent/_pages/Jssdk.html#参考资料" class="sidebar-link">参考资料</a><ul class="sidebar-sub-headers"></ul></li></ul></div></li></ul></div></div><div class="page" data-v-38547c78><div class="content default"><h1 id="关于微信公众平台的开发记录"><a href="#关于微信公众平台的开发记录" aria-hidden="true" class="header-anchor">#</a> 关于微信公众平台的开发记录</h1> <h2 id="准备工作"><a href="#准备工作" aria-hidden="true" class="header-anchor">#</a> 准备工作</h2> <ol><li>配置微信公众平台域名白名单</li> <li>前端引入JSSDK</li></ol> <h2 id="php服务器端配置"><a href="#php服务器端配置" aria-hidden="true" class="header-anchor">#</a> PHP服务器端配置</h2> <p>使用PHP脚本获取token及签名的代码如下：</p> <div class="language-php extra-class"><pre class="language-php"><code><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token comment">// curl获取数据</span>
<span class="token keyword">function</span> <span class="token function">curl_get_contents</span><span class="token punctuation">(</span><span class="token variable">$url</span><span class="token punctuation">,</span> <span class="token variable">$timeout</span> <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token variable">$curlHandle</span> <span class="token operator">=</span> <span class="token function">curl_init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">curl_setopt</span><span class="token punctuation">(</span><span class="token variable">$curlHandle</span><span class="token punctuation">,</span> <span class="token constant">CURLOPT_URL</span><span class="token punctuation">,</span> <span class="token variable">$url</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">curl_setopt</span><span class="token punctuation">(</span><span class="token variable">$curlHandle</span><span class="token punctuation">,</span> <span class="token constant">CURLOPT_RETURNTRANSFER</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">curl_setopt</span><span class="token punctuation">(</span><span class="token variable">$curlHandle</span><span class="token punctuation">,</span> <span class="token constant">CURLOPT_TIMEOUT</span><span class="token punctuation">,</span> <span class="token variable">$timeout</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$result</span> <span class="token operator">=</span> <span class="token function">curl_exec</span><span class="token punctuation">(</span><span class="token variable">$curlHandle</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">curl_close</span><span class="token punctuation">(</span><span class="token variable">$curlHandle</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token variable">$result</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 获取token</span>
<span class="token keyword">function</span> getToken <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token variable">$appid</span> <span class="token operator">=</span> <span class="token single-quoted-string string">'wx************'</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
  <span class="token variable">$appsecret</span> <span class="token operator">=</span> <span class="token single-quoted-string string">'************'</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token function">curl_get_contents</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'https://api.weixin.qq.com/cgi-bin/token?grant_type=client_credential&amp;appid='</span><span class="token punctuation">.</span><span class="token variable">$appid</span><span class="token punctuation">.</span><span class="token single-quoted-string string">'&amp;secret='</span><span class="token punctuation">.</span><span class="token variable">$appsecret</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token comment">// 获取ticket</span>
<span class="token keyword">function</span> getTicket <span class="token punctuation">(</span><span class="token variable">$token</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">curl_get_contents</span><span class="token punctuation">(</span><span class="token single-quoted-string string">'https://api.weixin.qq.com/cgi-bin/ticket/getticket?access_token='</span><span class="token punctuation">.</span><span class="token variable">$token</span><span class="token punctuation">.</span><span class="token single-quoted-string string">'&amp;type=jsapi'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 生成无序字符串</span>
<span class="token keyword">function</span> genNonceStr <span class="token punctuation">(</span><span class="token variable">$length</span> <span class="token operator">=</span> <span class="token number">16</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token variable">$chars</span> <span class="token operator">=</span> <span class="token double-quoted-string string">&quot;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&quot;</span><span class="token punctuation">;</span>
  <span class="token variable">$str</span> <span class="token operator">=</span> <span class="token double-quoted-string string">&quot;&quot;</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token variable">$length</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token variable">$str</span> <span class="token punctuation">.</span><span class="token operator">=</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$chars</span><span class="token punctuation">,</span> <span class="token function">mt_rand</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$chars</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token variable">$str</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 生成配置</span>
<span class="token keyword">function</span> genConfig <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token comment">// 获取 access_token</span>
  <span class="token variable">$access_token</span> <span class="token operator">=</span> <span class="token function">json_decode</span><span class="token punctuation">(</span><span class="token function">getToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean constant">true</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'access_token'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token comment">// 获取 ticket</span>
  <span class="token variable">$ticket</span> <span class="token operator">=</span> <span class="token function">json_decode</span><span class="token punctuation">(</span><span class="token function">getTicket</span><span class="token punctuation">(</span><span class="token variable">$access_token</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean constant">true</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'ticket'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token comment">// 生成签名</span>
  <span class="token variable">$nonstr</span> <span class="token operator">=</span> <span class="token function">genNonceStr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token variable">$url</span> <span class="token operator">=</span> <span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'HTTP_REFERER'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token single-quoted-string string">'HTTP_REFERER'</span><span class="token punctuation">]</span> <span class="token punctuation">:</span> <span class="token single-quoted-string string">''</span><span class="token punctuation">;</span>
  <span class="token variable">$time</span> <span class="token operator">=</span> <span class="token function">time</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token variable">$query</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token single-quoted-string string">'jsapi_ticket'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$ticket</span><span class="token punctuation">,</span>
    <span class="token single-quoted-string string">'noncestr'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$nonstr</span><span class="token punctuation">,</span>
    <span class="token single-quoted-string string">'timestamp'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$time</span><span class="token punctuation">,</span>
    <span class="token single-quoted-string string">'url'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$url</span>
  <span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token variable">$signStr</span> <span class="token operator">=</span> <span class="token double-quoted-string string">&quot;jsapi_ticket=<span class="token interpolation"><span class="token variable">$ticket</span></span>&amp;noncestr=<span class="token interpolation"><span class="token variable">$nonstr</span></span>&amp;timestamp=<span class="token interpolation"><span class="token variable">$time</span></span>&amp;url=<span class="token interpolation"><span class="token variable">$url</span></span>&quot;</span><span class="token punctuation">;</span>

  <span class="token variable">$signature</span> <span class="token operator">=</span> <span class="token function">sha1</span><span class="token punctuation">(</span><span class="token variable">$signStr</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token variable">$appid</span> <span class="token operator">=</span> <span class="token single-quoted-string string">'wx************'</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
    <span class="token single-quoted-string string">'code'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token single-quoted-string string">'data'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span>
      <span class="token single-quoted-string string">'query'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$query</span><span class="token punctuation">,</span>
      <span class="token single-quoted-string string">'signStr'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$signStr</span><span class="token punctuation">,</span>
      <span class="token single-quoted-string string">'appId'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$appid</span><span class="token punctuation">,</span>
      <span class="token single-quoted-string string">'timestamp'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$time</span><span class="token punctuation">,</span>
      <span class="token single-quoted-string string">'nonceStr'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$nonstr</span><span class="token punctuation">,</span>
      <span class="token single-quoted-string string">'signature'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$signature</span><span class="token punctuation">,</span>
      <span class="token single-quoted-string string">'url'</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token variable">$url</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">echo</span> <span class="token function">genConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></code></pre></div><p>获取签名的方法：先获取ticket，然后使用ticket换取token，最后使用获取到的token计算出签名（signature）。</p> <h2 id="客户端配置"><a href="#客户端配置" aria-hidden="true" class="header-anchor">#</a> 客户端配置</h2> <ol><li>获取服务器端签名</li> <li>配置wx.config参数</li> <li>配置权限列表</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">weixinInit</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token keyword">const</span> time <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
 axiosBase<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`/wechat/genConfig?t=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>time<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">if</span> <span class="token punctuation">(</span>response<span class="token punctuation">.</span>data<span class="token punctuation">.</span>code <span class="token operator">!==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token keyword">return</span>
   <span class="token punctuation">}</span>
   <span class="token keyword">let</span> parm <span class="token operator">=</span> response<span class="token punctuation">.</span>data<span class="token punctuation">.</span>data
   wx<span class="token punctuation">.</span><span class="token function">config</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
     debug<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
     appId<span class="token punctuation">:</span> parm<span class="token punctuation">.</span>appId<span class="token punctuation">,</span>
     timestamp<span class="token punctuation">:</span> parm<span class="token punctuation">.</span>timestamp<span class="token punctuation">,</span>
     nonceStr<span class="token punctuation">:</span> parm<span class="token punctuation">.</span>nonceStr<span class="token punctuation">,</span>
     signature<span class="token punctuation">:</span> parm<span class="token punctuation">.</span>signature<span class="token punctuation">,</span>
     jsApiList<span class="token punctuation">:</span> <span class="token punctuation">[</span>
       <span class="token string">'getLocation'</span><span class="token punctuation">,</span>
       <span class="token string">'checkJsApi'</span><span class="token punctuation">,</span>
       <span class="token string">'chooseWXPay'</span><span class="token punctuation">,</span>
       <span class="token string">'closeWindow'</span><span class="token punctuation">,</span>
       <span class="token string">'openLocation'</span><span class="token punctuation">,</span>
       <span class="token string">'onMenuShareTimeline'</span><span class="token punctuation">,</span>
       <span class="token string">'onMenuShareAppMessage'</span><span class="token punctuation">,</span>
       <span class="token string">'onMenuShareQQ'</span><span class="token punctuation">,</span>
       <span class="token string">'onMenuShareWeibo'</span><span class="token punctuation">,</span>
       <span class="token string">'onMenuShareQZone'</span><span class="token punctuation">,</span>
       <span class="token string">'hideMenuItems'</span><span class="token punctuation">,</span>
       <span class="token string">'scanQRCode'</span>
     <span class="token punctuation">]</span>
   <span class="token punctuation">}</span><span class="token punctuation">)</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// 封装微信各种分享</span>
<span class="token function">weixinShare</span> <span class="token punctuation">(</span><span class="token parameter">title<span class="token punctuation">,</span> link<span class="token punctuation">,</span> imgUrl<span class="token punctuation">,</span> desc</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">weixinInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
 wx<span class="token punctuation">.</span><span class="token function">ready</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
   wx<span class="token punctuation">.</span><span class="token function">hideMenuItems</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
     menuList<span class="token punctuation">:</span> <span class="token punctuation">[</span>
       <span class="token string">'menuItem:copyUrl'</span><span class="token punctuation">,</span>
       <span class="token string">'menuItem:openWithQQBrowser'</span><span class="token punctuation">,</span>
       <span class="token string">'menuItem:openWithSafari'</span><span class="token punctuation">,</span>
       <span class="token string">'menuItem:share:email'</span><span class="token punctuation">,</span>
       <span class="token string">'menuItem:share:brand'</span>
     <span class="token punctuation">]</span>
   <span class="token punctuation">}</span><span class="token punctuation">)</span>
   <span class="token comment">// 分享到朋友圈</span>
   wx<span class="token punctuation">.</span><span class="token function">onMenuShareTimeline</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
     title<span class="token punctuation">:</span> title<span class="token punctuation">,</span> <span class="token comment">// 分享标题</span>
     link<span class="token punctuation">:</span> link<span class="token punctuation">,</span> <span class="token comment">// 分享链接，该链接域名或路径必须与当前页面对应的公众号JS安全域名一致</span>
     imgUrl<span class="token punctuation">:</span> imgUrl<span class="token punctuation">,</span> <span class="token comment">// 分享图标</span>
     <span class="token function-variable function">success</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
     <span class="token function-variable function">cancel</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
   <span class="token punctuation">}</span><span class="token punctuation">)</span>
   <span class="token comment">// 分享给朋友</span>
   wx<span class="token punctuation">.</span><span class="token function">onMenuShareAppMessage</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
     title<span class="token punctuation">:</span> title<span class="token punctuation">,</span> <span class="token comment">// 分享标题</span>
     desc<span class="token punctuation">:</span> desc<span class="token punctuation">,</span> <span class="token comment">// 分享描述</span>
     link<span class="token punctuation">:</span> link<span class="token punctuation">,</span> <span class="token comment">// 分享链接，该链接域名或路径必须与当前页面对应的公众号JS安全域名一致</span>
     imgUrl<span class="token punctuation">:</span> imgUrl<span class="token punctuation">,</span> <span class="token comment">// 分享图标</span>
     type<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token comment">// 分享类型,music、video或link，不填默认为link</span>
     dataUrl<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token comment">// 如果type是music或video，则要提供数据链接，默认为空</span>
     <span class="token function-variable function">success</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
     <span class="token function-variable function">cancel</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
   <span class="token punctuation">}</span><span class="token punctuation">)</span>
   <span class="token comment">// 分享到QQ</span>
   wx<span class="token punctuation">.</span><span class="token function">onMenuShareQQ</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
     title<span class="token punctuation">:</span> title<span class="token punctuation">,</span> <span class="token comment">// 分享标题</span>
     desc<span class="token punctuation">:</span> desc<span class="token punctuation">,</span> <span class="token comment">// 分享描述</span>
     link<span class="token punctuation">:</span> link<span class="token punctuation">,</span> <span class="token comment">// 分享链接</span>
     imgUrl<span class="token punctuation">:</span> imgUrl<span class="token punctuation">,</span> <span class="token comment">// 分享图标</span>
     <span class="token function-variable function">success</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
     <span class="token function-variable function">cancel</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
   <span class="token punctuation">}</span><span class="token punctuation">)</span>
   <span class="token comment">// 分享到腾讯微博</span>
   wx<span class="token punctuation">.</span><span class="token function">onMenuShareWeibo</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
     title<span class="token punctuation">:</span> title<span class="token punctuation">,</span> <span class="token comment">// 分享标题</span>
     desc<span class="token punctuation">:</span> desc<span class="token punctuation">,</span> <span class="token comment">// 分享描述</span>
     link<span class="token punctuation">:</span> link<span class="token punctuation">,</span> <span class="token comment">// 分享链接</span>
     imgUrl<span class="token punctuation">:</span> imgUrl<span class="token punctuation">,</span> <span class="token comment">// 分享图标</span>
     <span class="token function-variable function">success</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
     <span class="token function-variable function">cancel</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
   <span class="token punctuation">}</span><span class="token punctuation">)</span>
   <span class="token comment">// 分享到QQ空间</span>
   wx<span class="token punctuation">.</span><span class="token function">onMenuShareQZone</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
     title<span class="token punctuation">:</span> title<span class="token punctuation">,</span> <span class="token comment">// 分享标题</span>
     desc<span class="token punctuation">:</span> desc<span class="token punctuation">,</span> <span class="token comment">// 分享描述</span>
     link<span class="token punctuation">:</span> link<span class="token punctuation">,</span> <span class="token comment">// 分享链接</span>
     imgUrl<span class="token punctuation">:</span> imgUrl<span class="token punctuation">,</span> <span class="token comment">// 分享图标</span>
     <span class="token function-variable function">success</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
     <span class="token function-variable function">cancel</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
   <span class="token punctuation">}</span><span class="token punctuation">)</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="常用接口的使用"><a href="#常用接口的使用" aria-hidden="true" class="header-anchor">#</a> 常用接口的使用</h2> <p>菜单相关:</p> <ul><li>wx.hideMenuItems 隐藏菜单项</li> <li>wx.showMenuItems 显示菜单项</li></ul> <p>分享相关:</p> <ul><li>wx.onMenuShareTimeline 分享到朋友圈</li> <li>wx.onMenuShareAppMessage 分享给朋友</li> <li>wx.onMenuShareQQ 分享到QQ</li> <li>wx.onMenuShareWeibo 分享到腾讯微博</li> <li>wx.onMenuShareQZone 分享到QQ空间</li></ul> <p>位置相关:</p> <ul><li>wx.openLocation 使用微信内置地图查看位置接口</li> <li>wx.getLocation 获取地理位置接口</li></ul> <p>其他常用:</p> <ul><li>wx.chooseWXPay 支付</li> <li>wx.scanQRCode 扫一扫</li></ul> <h2 id="注意事项"><a href="#注意事项" aria-hidden="true" class="header-anchor">#</a> 注意事项</h2> <h3 id="关于ios单页应用分享失败的解决"><a href="#关于ios单页应用分享失败的解决" aria-hidden="true" class="header-anchor">#</a> 关于iOS单页应用分享失败的解决</h3> <p>在iOS中使用JSSDK的时候，使用单页应用的方式开发，会发现微信只认入口页面的配置，如果路由改变，复制链接，仍然还是入口页面路径，因此导致微信分享等等功能也无效，分享出去的配置仍然还是入口页面配置的分享参数。</p> <p>要解决此问题，必须在每次使用微信接口之前都重新初始化微信JSSDK。</p> <h2 id="参考资料"><a href="#参考资料" aria-hidden="true" class="header-anchor">#</a> 参考资料</h2> <ul><li><a href="https://blog.csdn.net/kormondor/article/details/79001920" target="_blank" rel="noopener noreferrer">IOS端微信分享失效的踩坑及解决方案<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <p>JSSDK</p> <ul><li><a href="http://203.195.235.76/jssdk/" target="_blank" rel="noopener noreferrer">微信JS-SDK Demo<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://mp.weixin.qq.com/wiki?t=resource/res_main&amp;id=mp1421141115" target="_blank" rel="noopener noreferrer">微信公众平台: JS-SDK说明文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="http://wiki.open.qq.com/wiki/website/JS_SDK%E4%BD%BF%E7%94%A8%E8%AF%B4%E6%98%8E" target="_blank" rel="noopener noreferrer">腾讯开放平台: JS_SDK使用说明<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <p>支付</p> <ul><li><a href="https://pay.weixin.qq.com/wiki/doc/api/jsapi.php?chapter=7_7&amp;index=6" target="_blank" rel="noopener noreferrer">微信支付: 微信内H5调起支付<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div><div class="article-info"><div class="article-title">文档信息</div><p class="article-item">版权声明：著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。</p><p class="article-item">文章标题：关于微信公众平台的开发记录</p><p class="article-item">原文链接：<a href="https://www.xiaoyulive.top/categories/cloud/tencent/_pages/Jssdk.html">https://www.xiaoyulive.top/categories/cloud/tencent/_pages/Jssdk.html</a></p><p class="article-item">发表日期：2019-03-05</p></div><!----><!----></div><div class="footers" data-v-38547c78><p data-v-38547c78><span data-v-38547c78>MIT Licensed | Copyright © 2018-present  滇ICP备16006294号</span></p><p data-v-38547c78><span data-v-38547c78>Design by <a href="/">Quanzaiyu</a> | Power by <a href="https://vuepress.vuejs.org/" target="_blank">VuePress</a> | Hosted by <a href="https://pages.coding.me" target="_blank" style="font-weight: bold">Coding Pages</a></span></p></div></div><div class="global-ui"><!----><!----></div></div>
    <script src="/assets/js/app.33f73489.js" defer></script><script src="/assets/js/5.7bea38e3.js" defer></script>
  </body>
</html>
