<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>深入理解 HTML5 - 音视频录制 | 小昱个人网站</title>
    <meta name="description" content="小昱个人网站">
    <meta http-equiv="Expires" content="Mon,12 May 2050 00:20:00 GMT">
  <meta name="keywords" content="小昱,个人网站,Vue,JavaScript,HTML,CSS">
  <link rel="icon" href="/logo.png">
  <link rel="manifest" href="/manifest.json">
  <link rel="stylesheet" href="//at.alicdn.com/t/font_517060_lom78h954w.css">
  <link rel="stylesheet" href="https://img.xiaoyulive.top/css/animate.css">
    
    <link rel="preload" href="/assets/css/0.styles.e2d81a46.css" as="style"><link rel="preload" href="/assets/js/app.bcb96cc1.js" as="script"><link rel="preload" href="/assets/js/5.314447d8.js" as="script"><link rel="preload" href="/assets/js/14.1aec49d6.js" as="script"><link rel="prefetch" href="/assets/js/1.9661ddb3.js"><link rel="prefetch" href="/assets/js/10.730e6669.js"><link rel="prefetch" href="/assets/js/11.03a3b555.js"><link rel="prefetch" href="/assets/js/12.dea4259a.js"><link rel="prefetch" href="/assets/js/13.017d0ddc.js"><link rel="prefetch" href="/assets/js/15.54ee861e.js"><link rel="prefetch" href="/assets/js/2.6b7127f7.js"><link rel="prefetch" href="/assets/js/6.398530e5.js"><link rel="prefetch" href="/assets/js/7.b1fc2793.js"><link rel="prefetch" href="/assets/js/8.46eac014.js"><link rel="prefetch" href="/assets/js/9.c4f01555.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.1d9f8a8b.js">
    <link rel="stylesheet" href="/assets/css/0.styles.e2d81a46.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-38547c78><header class="navbar" data-v-38547c78><div class="navbar-content"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div><a href="/" class="home-link router-link-active"><img src="/logo.png" class="logo"><span class="site-name can-hide">小昱个人网站</span></a><div class="links"><nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link">开发者博客</a></div><div class="nav-item"><a href="/articles/" class="nav-link">生活漫谈</a></div><div class="nav-item"><a href="/note/" class="nav-link">阅读札记</a></div><div class="nav-item"><a href="/categories/" class="nav-link router-link-active">学无止境</a></div><div class="nav-item"><a href="/share/" class="nav-link">精品分享</a></div><div class="nav-item"><a href="/favorite/" class="nav-link">收藏夹</a></div><!----></nav><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""><!----></div></div></div></header><div class="sidebar-mask" data-v-38547c78></div><div class="sidebar" data-v-38547c78><div class="sidebar-container"><nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link">开发者博客</a></div><div class="nav-item"><a href="/articles/" class="nav-link">生活漫谈</a></div><div class="nav-item"><a href="/note/" class="nav-link">阅读札记</a></div><div class="nav-item"><a href="/categories/" class="nav-link router-link-active">学无止境</a></div><div class="nav-item"><a href="/share/" class="nav-link">精品分享</a></div><div class="nav-item"><a href="/favorite/" class="nav-link">收藏夹</a></div><!----></nav><ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>深入理解 HTML5 - 音视频录制</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/categories/front-end/html/_pages/H5_Media.html#准备工作" class="sidebar-link">准备工作</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/categories/front-end/html/_pages/H5_Media.html#获取设备-getusermedia" class="sidebar-link">获取设备 - getUserMedia</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/categories/front-end/html/_pages/H5_Media.html#约束条件-mediastreamconstraints" class="sidebar-link">约束条件 - MediaStreamConstraints</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/categories/front-end/html/_pages/H5_Media.html#mediatrackconstraints" class="sidebar-link">MediaTrackConstraints</a></li><li class="sidebar-sub-header"><a href="/categories/front-end/html/_pages/H5_Media.html#mediadevices-getsupportedconstraints" class="sidebar-link">MediaDevices.getSupportedConstraints</a></li><li class="sidebar-sub-header"><a href="/categories/front-end/html/_pages/H5_Media.html#mediastreamtrack-getsettings" class="sidebar-link">MediaStreamTrack.getSettings</a></li></ul></li><li><a href="/categories/front-end/html/_pages/H5_Media.html#数据流-mediastream" class="sidebar-link">数据流 - MediaStream</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/categories/front-end/html/_pages/H5_Media.html#列出媒体设备-enumeratedevices" class="sidebar-link">列出媒体设备 - enumerateDevices</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/categories/front-end/html/_pages/H5_Media.html#编码类型支持程度" class="sidebar-link">编码类型支持程度</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/categories/front-end/html/_pages/H5_Media.html#音视频录制-mediarecorder" class="sidebar-link">音视频录制 - MediaRecorder</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/categories/front-end/html/_pages/H5_Media.html#实时音视频-webrtc" class="sidebar-link">实时音视频 - WebRTC</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/categories/front-end/html/_pages/H5_Media.html#实例-捕捉摄像头并进行拍照" class="sidebar-link">实例: 捕捉摄像头并进行拍照</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/categories/front-end/html/_pages/H5_Media.html#实例-捕获摄像头并进行录像" class="sidebar-link">实例: 捕获摄像头并进行录像</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/categories/front-end/html/_pages/H5_Media.html#实例-捕获录音设备并进行录音" class="sidebar-link">实例: 捕获录音设备并进行录音</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/categories/front-end/html/_pages/H5_Media.html#参考资料" class="sidebar-link">参考资料</a><ul class="sidebar-sub-headers"></ul></li></ul></div></li></ul></div></div><div class="page" data-v-38547c78><div class="content__default"><h1 id="深入理解-html5-音视频录制"><a href="#深入理解-html5-音视频录制" aria-hidden="true" class="header-anchor">#</a> 深入理解 HTML5 - 音视频录制</h1> <h2 id="准备工作"><a href="#准备工作" aria-hidden="true" class="header-anchor">#</a> 准备工作</h2> <ol><li>必须有摄像头设备</li> <li>必须使用HTTPS协议</li></ol> <p>如果找不到摄像头设备, 会出现以下错误:</p> <div class="imgLink" data-v-16222526><img src="https://img.xiaoyulive.top/img/date/20190416/002.png" data-v-16222526></div> <p>如果不使用 HTTPS, 会出现以下错误:</p> <div class="imgLink" data-v-16222526><img src="https://img.xiaoyulive.top/img/date/20190416/001.png" data-v-16222526></div> <p>提示用户授权:</p> <div class="imgLink" data-v-16222526><img src="https://img.xiaoyulive.top/img/date/20190416/003.png/small" data-v-16222526></div> <h2 id="获取设备-getusermedia"><a href="#获取设备-getusermedia" aria-hidden="true" class="header-anchor">#</a> 获取设备 - getUserMedia</h2> <p>HTML5的 <strong>getUserMedia API</strong> 为用户提供访问硬件设备媒体 (摄像头、视频、音频、地理位置等) 的接口，基于该接口，开发者可以在不依赖任何浏览器插件的条件下访问硬件媒体设备。</p> <p>getUserMedia API 最初是<code>navigator.getUserMedia</code>，目前已被最新Web标准废除，变更为<code>navigator.mediaDevices.getUserMedia（）</code>，但浏览器支持情况不如旧版API普及。</p> <p><code>navigator.mediaDevices.getUserMedia()</code> 方法提示用户允许使用一个视频和/或一个音频输入设备，例如相机或屏幕共享和/或麦克风。如果用户给予许可，就返回一个<code>Promise</code>对象，<code>MediaStream</code>对象作为此<code>Promise</code>对象的<code>Resolved</code>［成功］状态的回调函数参数，相应的，如果用户拒绝了许可，或者没有媒体可用的情况下<code>PermissionDeniedError</code>或者<code>NotFoundError</code>作为此<code>Promise</code>的<code>Rejected</code>［失败］状态的回调函数参数。注意，由于用户不会被要求必须作出允许或者拒绝的选择，所以返回的<code>Promise</code>对象可能既不会触发<code>resolve</code>也不会触发 <code>reject</code>。</p> <p>语法:</p> <div class="language-js extra-class"><pre class="language-js"><code>navigator<span class="token punctuation">.</span>mediaDevices<span class="token punctuation">.</span><span class="token function">getUserMedia</span><span class="token punctuation">(</span>constraints<span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">mediaStream</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>参考:</p> <ul><li><a href="https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices/getUserMedia" target="_blank" rel="noopener noreferrer">getUserMedia - MDN<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://webrtc.org.cn/getusermedia-common-error/" target="_blank" rel="noopener noreferrer">getUserMedia 出现的常见错误<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <h2 id="约束条件-mediastreamconstraints"><a href="#约束条件-mediastreamconstraints" aria-hidden="true" class="header-anchor">#</a> 约束条件 - MediaStreamConstraints</h2> <p><code>getUserMedia()</code> 函数仅接收一个参数, <strong>constraints</strong> 是 <code>MediaStreamConstraints</code> 对象, 指定请求的媒体类型，包含video和audio，必须至少一个类型或者两个同时可以被指定。如果浏览器无法找到指定的媒体类型或者无法满足相对应的参数要求，那么返回的Promise对象就会处于rejected［失败］状态，NotFoundError作为rejected［失败］回调的参数。</p> <p>约束项可以具有下面这两个属性中的一个或两个：</p> <ul><li>video 表示是否需要视频轨道</li> <li>audio 表示是否需要音频轨道</li></ul> <p>同事启用音频和视频：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> constraints <span class="token operator">=</span> <span class="token punctuation">{</span>
  audio<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  video<span class="token punctuation">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span>
</code></pre></div><p>如果对视频或者音频指定了true，则生成的流将被要求拥有特定的媒体轨道，否则对 <code>getUserMedia()</code>的调用将导致 <code>NotFoundError</code> 错误的出现。</p> <p>音频和视频属相可以是下面这两种类型的值：</p> <ul><li>像上面的例子一样是一个布尔值</li> <li>一个MediaTrackConstraints对象，其提供了像宽度和高度这样必须与轨道匹配的特定属性</li></ul> <h3 id="mediatrackconstraints"><a href="#mediatrackconstraints" aria-hidden="true" class="header-anchor">#</a> MediaTrackConstraints</h3> <p><strong>视频约束: 分辨率</strong></p> <p>可以使用宽度和高度属性从网络摄像头请求一定的分辨率。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> constraints <span class="token operator">=</span> <span class="token punctuation">{</span>
  audio<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  video<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    width<span class="token punctuation">:</span> <span class="token number">1280</span><span class="token punctuation">,</span>
    height<span class="token punctuation">:</span> <span class="token number">720</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="warning custom-block"><p class="custom-block-title">注意</p> <p>经测试, 在移动端的width和height与设备的宽高正好相反, width指定的是设备的高, height指定的是设备的宽, PC端没做测试, 由于没有网络摄像头和麦克风</p></div> <p>浏览器会尽可能的保持这个数据，但是也有可能会返回一个分辨率不一样的流。根据我的经验，这常常是因为摄像头不支持请求的分辨率造成的。也可能是由于在Mac上或者Chrome浏览器其他的标签页上有另一个程序的getUserMedia()覆盖了约束。当然也有可能存在其他原因。</p> <p>你可以点击这个链接使用<a href="https://webrtchacks.github.io/WebRTC-Camera-Resolution/" target="_blank" rel="noopener noreferrer">WebRTC摄像头分辨率查询器<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>来看看自己的浏览器和摄像头都支持什么样的分辨率。</p> <p><strong>关键字</strong></p> <p>如果分辨率对于你来说很重要，而且设备和浏览器不能够保证分辨率的时候，你可以用min, max, ideal和exact关键字来帮助你从任何设备中得到最佳的分辨率。这些关键字可以应用到任何MediaTrackConstraint属性中。</p> <ul><li>min 最小尺寸</li> <li>max 最大尺寸</li> <li>ideal 理想尺寸, 若设置会优先寻找此分辨率或最接近此分辨率的设备</li> <li>exact 约束为此尺寸</li></ul> <p>比如:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> constraints <span class="token operator">=</span> <span class="token punctuation">{</span>
  audio<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  video<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    width<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      min<span class="token punctuation">:</span> <span class="token number">1024</span><span class="token punctuation">,</span>
      max<span class="token punctuation">:</span> <span class="token number">1920</span><span class="token punctuation">,</span>
      ideal<span class="token punctuation">:</span> <span class="token number">1280</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    height<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      min<span class="token punctuation">:</span> <span class="token number">776</span><span class="token punctuation">,</span>
      max<span class="token punctuation">:</span> <span class="token number">1080</span><span class="token punctuation">,</span>
      ideal<span class="token punctuation">:</span> <span class="token number">720</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>关键字不仅可以用于分辨率约束, 也适用于其他约束</p> <p><strong>视频约束: 获取移动设备的前置或者后置摄像头</strong></p> <p>我们可以使用视频轨道约束的facingMode属性。可接受的值有：<code>user</code>（前置摄像头），<code>environment</code>（后置摄像头），<code>left</code>和<code>right</code>。</p> <p>优先使用前置摄像头（如果有的话）</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> constraints <span class="token operator">=</span> <span class="token punctuation">{</span>
  audio<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  video<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    facingMode<span class="token punctuation">:</span> <span class="token string">&quot;user&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>强制使用后置摄像头</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> constraints <span class="token operator">=</span> <span class="token punctuation">{</span>
  audio<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  video<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    facingMode<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      exact<span class="token punctuation">:</span> <span class="token string">&quot;environment&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>视频约束: 帧速率</strong></p> <p>因为帧速率(frameRate)不仅对视频质量，还对带宽有着直接影响，所以在某些情况下，比如通过低带宽连接发布视频流的时候，限制帧速率可能是个好主意。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> constraints <span class="token operator">=</span> <span class="token punctuation">{</span>
  audio<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  video<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    width<span class="token punctuation">:</span> <span class="token number">720</span><span class="token punctuation">,</span>
    height<span class="token punctuation">:</span> <span class="token number">1080</span><span class="token punctuation">,</span>
    frameRate<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      ideal<span class="token punctuation">:</span> <span class="token number">60</span><span class="token punctuation">,</span>
      min<span class="token punctuation">:</span> <span class="token number">10</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>使用特定的网络摄像头或者麦克风</strong></p> <p>下面这个约束属性同时适用于音频和视频轨道：<code>deviceId</code>。它指定了被用于捕捉流的设备ID。这个设备ID是唯一的，并且在同一个来源的会话中是相同的。你需要首先使用 <code>MediaDevices.enumerateDevices()</code> 来获取设备id。</p> <p>一旦你知道了deviceId之后，你就可以要求指定的摄像头和麦克风了:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> constraints <span class="token operator">=</span> <span class="token punctuation">{</span>
  audio<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    deviceId<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      extra<span class="token punctuation">:</span> <span class="token string">'xxx'</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  video<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    deviceId<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      extra<span class="token punctuation">:</span> <span class="token string">'xxx'</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>还有一个属性是groupId，这是一个实体设备中所有媒体源共享的ID。举个例子，在同一个耳机上的麦克风和扬声器就会共享同样的groupId。</p> <p><strong>音频约束</strong></p> <ul><li><strong>sampleRate</strong> 指定一个所需的采样率，不确定它应该被用作编码设置还是作为硬件要求，越高越好（比如CD的采样率就是44000 samples/s或44kHz）。</li> <li><strong>sampleSize</strong> 每个采样点大小的位数，越高越好（CD的采样大小为16 bits/sample）</li> <li><strong>volume</strong> 从0（静音）到1（最大音量）取值，被用作每个样本值的乘数</li> <li><strong>echoCancellation</strong> 是否使用回声消除来尝试去除通过麦克风回传到扬声器的音频, 默认值是 on</li> <li><strong>autoGainControl</strong> 是否要修改麦克风的输入音量</li> <li><strong>noiseSuppression</strong> 是否尝试去除音频信号中的背景噪声, 可选 true 或 false</li> <li><strong>latency</strong> 以秒为单位，控制开始处理声音和下一步可以使用数据之间的时间，想不明白你为什么想要设更高的延迟，但是音频编解码器的延时确实有所不同。</li> <li><strong>channelCount</strong> 规定了单声道的时候为1，立体声的时候为2。</li></ul> <p>参考:</p> <ul><li><a href="https://developer.mozilla.org/en-US/docs/Web/API/MediaTrackConstraints" target="_blank" rel="noopener noreferrer">MediaTrackConstraints - MDN<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://webrtc.org.cn/getusermedia-video-constraints/" target="_blank" rel="noopener noreferrer">getUserMedia 视频约束<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://webrtc.org.cn/getusermedia-audio-constraints/" target="_blank" rel="noopener noreferrer">getUserMedia 音频约束<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <h3 id="mediadevices-getsupportedconstraints"><a href="#mediadevices-getsupportedconstraints" aria-hidden="true" class="header-anchor">#</a> MediaDevices.getSupportedConstraints</h3> <p><code>MediaDevices.getSupportedConstraints()</code> 这个函数会返回一个字典，列出用户代理支持的约束。</p> <p><a href="https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices/getSupportedConstraints#Result" target="_blank" rel="noopener noreferrer">点击这里<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>测试你的浏览器支持的所有约束。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> supportedConstraints <span class="token operator">=</span> navigator<span class="token punctuation">.</span>mediaDevices<span class="token punctuation">.</span><span class="token function">getSupportedConstraints</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> constraint <span class="token keyword">in</span> supportedConstraints<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>supportedConstraints<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span>constraint<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>constraint<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="imgLink" data-v-16222526><img src="https://img.xiaoyulive.top/img/date/20190430/001.png" data-v-16222526></div> <h3 id="mediastreamtrack-getsettings"><a href="#mediastreamtrack-getsettings" aria-hidden="true" class="header-anchor">#</a> MediaStreamTrack.getSettings</h3> <p>还可以通过track.getSettings检查有哪些约束是支持的。它会返回一个包括了所有可用约束的对象，包括了那些浏览器虽然支持的，但是默认值没有通过代码改变的。</p> <div class="language-js extra-class"><pre class="language-js"><code>navigator<span class="token punctuation">.</span>mediaDevices<span class="token punctuation">.</span><span class="token function">getUserMedia</span><span class="token punctuation">(</span>constraints<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">stream</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  stream<span class="token punctuation">.</span><span class="token function">getTracks</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">track</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>track<span class="token punctuation">.</span><span class="token function">getSettings</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="数据流-mediastream"><a href="#数据流-mediastream" aria-hidden="true" class="header-anchor">#</a> 数据流 - MediaStream</h2> <p>成功回调函数<code>seccessCallback</code>的参数<strong>stream</strong>是<code>MediaStream</code>的对象，表示媒体内容的数据流，可以通过<code>URL.createObjectURL</code>转换后设置为<code>Video</code>或<code>Audio</code>元素的<code>src</code>属性来使用，部分较新的浏览器也可以直接设置为<code>srcObject</code>属性来使用。</p> <p>失败回调函数<code>errorCallback</code>的参数<strong>error</strong>，可能的异常有：</p> <ul><li><code>AbortError</code>：硬件问题</li> <li><code>NotAllowedError</code>：用户拒绝了当前的浏览器实例的访问请求；或者用户拒绝了当前会话的访问；或者用户在全局范围内拒绝了所有媒体访问请求。</li> <li><code>NotFoundError</code>：找不到满足请求参数的媒体类型。</li> <li><code>NotReadableError</code>：操作系统上某个硬件、浏览器或者网页层面发生的错误导致设备无法被访问。</li> <li><code>OverConstrainedError</code>：指定的要求无法被设备满足。</li> <li><code>SecurityError</code>：安全错误，在<code>getUserMedia()</code> 被调用的 <code>Document</code>
上面，使用设备媒体被禁止。这个机制是否开启或者关闭取决于单个用户的偏好设置。</li> <li><code>TypeError</code>：类型错误，<code>constraints</code>对象未设置［空］，或者都被设置为<code>false</code>。</li></ul> <p>参考:</p> <ul><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Media_Streams_API" target="_blank" rel="noopener noreferrer">Media​Stream API - MDN<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <h2 id="列出媒体设备-enumeratedevices"><a href="#列出媒体设备-enumeratedevices" aria-hidden="true" class="header-anchor">#</a> 列出媒体设备 - enumerateDevices</h2> <p>通过 <code>navigator.mediaDevices.enumerateDevices()</code> 可获取所有媒体设备, 方便进行设备切换, 成功的回调参数为 <code>MediaDeviceInfo</code> 对象列表</p> <p>一个简单的示例:</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token doctype">&lt;!DOCTYPE html&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>utf-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>viewport<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>width=device-width, initial-scale=1<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>enumerateDevices<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>container<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>enumerateDevices<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>select<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>audioSource<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Audio source: <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>audioSource<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>select<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>videoSource<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Video source: <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>videoSource<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>video</span> <span class="token attr-name">muted</span> <span class="token attr-name">autoplay</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>video</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token keyword">let</span> videoElement <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'video'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> audioSelect <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'select#audioSource'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> videoSelect <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'select#videoSource'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    navigator<span class="token punctuation">.</span>mediaDevices<span class="token punctuation">.</span><span class="token function">enumerateDevices</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>gotDevices<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>getStream<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span>handleError<span class="token punctuation">)</span><span class="token punctuation">;</span>

    audioSelect<span class="token punctuation">.</span>onchange <span class="token operator">=</span> getStream<span class="token punctuation">;</span>
    videoSelect<span class="token punctuation">.</span>onchange <span class="token operator">=</span> getStream<span class="token punctuation">;</span>

    <span class="token comment">// 获取设备</span>
    <span class="token keyword">function</span> <span class="token function">gotDevices</span><span class="token punctuation">(</span><span class="token parameter">deviceInfos</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">!==</span> deviceInfos<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> deviceInfo <span class="token operator">=</span> deviceInfos<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>deviceInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> option <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'option'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        option<span class="token punctuation">.</span>value <span class="token operator">=</span> deviceInfo<span class="token punctuation">.</span>deviceId<span class="token punctuation">;</span>
        <span class="token comment">// 音频设备</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>deviceInfo<span class="token punctuation">.</span>kind <span class="token operator">===</span> <span class="token string">'audioinput'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          option<span class="token punctuation">.</span>text <span class="token operator">=</span> deviceInfo<span class="token punctuation">.</span>label <span class="token operator">||</span> <span class="token string">'microphone '</span> <span class="token operator">+</span> <span class="token punctuation">(</span>audioSelect<span class="token punctuation">.</span>length <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          audioSelect<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>option<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 视频设备</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>deviceInfo<span class="token punctuation">.</span>kind <span class="token operator">===</span> <span class="token string">'videoinput'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          option<span class="token punctuation">.</span>text <span class="token operator">=</span> deviceInfo<span class="token punctuation">.</span>label <span class="token operator">||</span> <span class="token string">'camera '</span> <span class="token operator">+</span> <span class="token punctuation">(</span>videoSelect<span class="token punctuation">.</span>length <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          videoSelect<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>option<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Found one other kind of source/device: '</span><span class="token punctuation">,</span> deviceInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">function</span> <span class="token function">getStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>window<span class="token punctuation">.</span>stream<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        window<span class="token punctuation">.</span>stream<span class="token punctuation">.</span><span class="token function">getTracks</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">track</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          track<span class="token punctuation">.</span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">let</span> constraints <span class="token operator">=</span> <span class="token punctuation">{</span>
        audio<span class="token punctuation">:</span> <span class="token punctuation">{</span>
          deviceId<span class="token punctuation">:</span> <span class="token punctuation">{</span>exact<span class="token punctuation">:</span> audioSelect<span class="token punctuation">.</span>value<span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        video<span class="token punctuation">:</span> <span class="token punctuation">{</span>
          deviceId<span class="token punctuation">:</span> <span class="token punctuation">{</span>exact<span class="token punctuation">:</span> videoSelect<span class="token punctuation">.</span>value<span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>

      navigator<span class="token punctuation">.</span>mediaDevices<span class="token punctuation">.</span><span class="token function">getUserMedia</span><span class="token punctuation">(</span>constraints<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>gotStream<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span>handleError<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">function</span> <span class="token function">gotStream</span><span class="token punctuation">(</span><span class="token parameter">stream</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      window<span class="token punctuation">.</span>stream <span class="token operator">=</span> stream<span class="token punctuation">;</span> <span class="token comment">// make stream available to console</span>
      videoElement<span class="token punctuation">.</span>srcObject <span class="token operator">=</span> stream<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">function</span> <span class="token function">handleError</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Error: '</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>注意到上面有两个 then, 第一个 then 为列出设备(mediaDevices.enumerateDevices)成功或的回调, 第二个then为获取设备(mediaDevices.getUserMedia)成功后的回调, 上面通过绑定 deviceId 来完成不同设备的切换</p> <p>效果:</p> <div class="imgLink" data-v-16222526><img src="https://img.xiaoyulive.top/img/date/20190416/005.png/small" data-v-16222526></div> <h2 id="编码类型支持程度"><a href="#编码类型支持程度" aria-hidden="true" class="header-anchor">#</a> 编码类型支持程度</h2> <p><code>MediaRecorder.isTypeSupported()</code> 方法会判断其 MIME 格式能否被客户端记录。</p> <p>使用以下程序可以检测设备的编码类型支持程度</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> types <span class="token operator">=</span> <span class="token punctuation">[</span>
              <span class="token string">&quot;video/webm&quot;</span><span class="token punctuation">,</span>
              <span class="token string">&quot;audio/webm&quot;</span><span class="token punctuation">,</span>
              <span class="token string">&quot;video/webm\;codecs=vp8&quot;</span><span class="token punctuation">,</span>
              <span class="token string">&quot;video/webm\;codecs=daala&quot;</span><span class="token punctuation">,</span>
              <span class="token string">&quot;video/webm\;codecs=h264&quot;</span><span class="token punctuation">,</span>
              <span class="token string">&quot;audio/webm\;codecs=opus&quot;</span><span class="token punctuation">,</span>
              <span class="token string">&quot;video/mpeg&quot;</span>
            <span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token keyword">in</span> types<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span> <span class="token string">&quot;Is &quot;</span> <span class="token operator">+</span> types<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">&quot; supported? &quot;</span> <span class="token operator">+</span> <span class="token punctuation">(</span>MediaRecorder<span class="token punctuation">.</span><span class="token function">isTypeSupported</span><span class="token punctuation">(</span>types<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token string">&quot;Maybe!&quot;</span> <span class="token punctuation">:</span> <span class="token string">&quot;Nope :(&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>参考:</p> <ul><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/MediaRecorder/isTypeSupported" target="_blank" rel="noopener noreferrer">Media​Recorder​.isType​Supported<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="http://www.cuplayer.com/player/PlayerCode/Html5/2017/0919/3162.html" target="_blank" rel="noopener noreferrer">检测video/audio支持的资源格式情况的函数代码<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <h2 id="音视频录制-mediarecorder"><a href="#音视频录制-mediarecorder" aria-hidden="true" class="header-anchor">#</a> 音视频录制 - MediaRecorder</h2> <p>MediaRecorder 用于将音视频流转化为二进制数据, 基本使用为:</p> <div class="language-js extra-class"><pre class="language-js"><code>navigator<span class="token punctuation">.</span>mediaDevices<span class="token punctuation">.</span><span class="token function">getUserMedia</span><span class="token punctuation">(</span>constraints<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">stream</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>recorder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">window<span class="token punctuation">.</span>MediaRecorder</span><span class="token punctuation">(</span>stream<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>mediaOptions<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>recorder<span class="token punctuation">.</span>ondataavailable <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>getRecordingData<span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>recorder<span class="token punctuation">.</span>onstop <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>saveRecordingData<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">alert</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token operator">...</span>

<span class="token comment">// 获取录制数据</span>
<span class="token keyword">function</span> <span class="token function">getRecordingData</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>chunks<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 保存录制数据</span>
<span class="token keyword">function</span> <span class="token function">saveRecordingData</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> blob <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Blob</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>chunks<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string">'type'</span> <span class="token punctuation">:</span> <span class="token string">'video/webm;codecs=h264'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>currVideo <span class="token operator">=</span> <span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">createObjectURL</span><span class="token punctuation">(</span>blob<span class="token punctuation">)</span>
  document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;video&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>srcObject <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>currVideo
  <span class="token keyword">this</span><span class="token punctuation">.</span>chunks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token operator">...</span>

document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;btn1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function-variable function">onClick</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>recorder<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;btn2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function-variable function">onClick</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>recorder<span class="token punctuation">.</span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>构造函数包括两个参数:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">new</span> <span class="token class-name">MediaRecorder</span><span class="token punctuation">(</span>stream<span class="token punctuation">[</span><span class="token punctuation">,</span> options<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>第一个参数 stream 为使用 getUserMedia 获取到的流, 第二个参数为参数选项, 主要包括:</p> <ul><li>mimeType: mime类型, 使用 <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/MediaRecorder/isTypeSupported" target="_blank" rel="noopener noreferrer">MediaRecorder.isTypeSupported<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 可查看支持的类型, 包括:
<ul><li>[&quot;video/webm&quot;, &quot;audio/webm&quot;, &quot;video/webm;codecs=vp8&quot;, &quot;video/webm;codecs=daala&quot;, &quot;video/webm;codecs=h264&quot;, &quot;audio/webm;codecs=opus&quot;, &quot;video/mpeg&quot;]</li></ul></li> <li>audioBitsPerSecond: 音频码率</li> <li>videoBitsPerSecond: 视频码率</li> <li>bitsPerSecond: 比特率, 包括音频和视频码率</li></ul> <p>常用方法有:</p> <ul><li>start 开始录制</li> <li>stop 结束录制, 首先触发 ondataavailable, 然后触发 onstop</li></ul> <p>我们常常会在 ondataavailable 收集录制好的数据, 然后在 onstop 对这些数据进行处理</p> <p>上面的示例, 录制完成后将数据转化为 Blob, 使用 <code>URL.createObjectURL(blob)</code> 将Blob转化为DataURL, 格式为 <code>blob:https://test.xiaoyulive.top/xxxxx</code>, 将之置于 video/audio/img 的 src 属性即可</p> <p>参考:</p> <ul><li><a href="https://developer.mozilla.org/en-US/docs/Web/API/MediaRecorder" target="_blank" rel="noopener noreferrer">MediaRecorder - MDN<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://developer.mozilla.org/en-US/docs/Web/API/MediaStream_Recording_API" target="_blank" rel="noopener noreferrer">Media​Stream Recording API - MDN<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://juejin.im/entry/5b91e8e7f265da0ac55e2cd6" target="_blank" rel="noopener noreferrer">用浏览器轻松录制音频、视频 —— MediaRecorder API<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://codepen.io/_tianxia/pen/JayxoG" target="_blank" rel="noopener noreferrer">录音(_tianxia) - CodePen<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://codepen.io/_tianxia/pen/gdxqao" target="_blank" rel="noopener noreferrer">录像(_tianxia) - CodePen<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <h2 id="实时音视频-webrtc"><a href="#实时音视频-webrtc" aria-hidden="true" class="header-anchor">#</a> 实时音视频 - WebRTC</h2> <h2 id="实例-捕捉摄像头并进行拍照"><a href="#实例-捕捉摄像头并进行拍照" aria-hidden="true" class="header-anchor">#</a> 实例: 捕捉摄像头并进行拍照</h2> <p>一个简单的示例, 演示如何调用摄像头并进行拍照:</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token doctype">&lt;!DOCTYPE html&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>en<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>UTF-8<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>MediaDevices<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>viewport<span class="token punctuation">&quot;</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>width=device-width, initial-scale=1.0, maximum-scale=1.0<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
  <span class="token comment">&lt;!--video用于显示媒体设备的视频流，自动播放--&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>video</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>video<span class="token punctuation">&quot;</span></span> <span class="token attr-name">autoplay</span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">=&quot;</span><span class="token attr-value"><span class="token property">width</span><span class="token punctuation">:</span> 240px<span class="token punctuation">;</span><span class="token property">height</span><span class="token punctuation">:</span> 320px</span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>video</span><span class="token punctuation">&gt;</span></span>
  <span class="token comment">&lt;!--按钮--&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">=&quot;</span><span class="token attr-value"><span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span></span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>capture1<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>拍照<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canvas</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>canvas1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>240<span class="token punctuation">&quot;</span></span> <span class="token attr-name">height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>320<span class="token punctuation">&quot;</span></span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">=&quot;</span><span class="token attr-value"><span class="token property">width</span><span class="token punctuation">:</span> 240px<span class="token punctuation">;</span><span class="token property">height</span><span class="token punctuation">:</span> 320px</span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>canvas</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>capture2<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>摄像<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>canvas</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>canvas2<span class="token punctuation">&quot;</span></span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>240<span class="token punctuation">&quot;</span></span> <span class="token attr-name">height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>320<span class="token punctuation">&quot;</span></span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">=&quot;</span><span class="token attr-value"><span class="token property">width</span><span class="token punctuation">:</span> 240px<span class="token punctuation">;</span><span class="token property">height</span><span class="token punctuation">:</span> 320px</span><span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>canvas</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">download</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>snap.png<span class="token punctuation">'</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>download<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>下载图片<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
    <span class="token keyword">let</span> video <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;video&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> canvas1 <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;canvas1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> context1 <span class="token operator">=</span> canvas1<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">&quot;2d&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> canvas2 <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;canvas2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> context2 <span class="token operator">=</span> canvas2<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">&quot;2d&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//访问用户媒体设备的兼容方法</span>
    <span class="token keyword">let</span> mediaDevices <span class="token operator">=</span> navigator<span class="token punctuation">.</span>mediaDevices <span class="token operator">||</span> navigator<span class="token punctuation">.</span>webkitGetUserMedia<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>mediaDevices<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      mediaDevices<span class="token punctuation">.</span><span class="token function">getUserMedia</span><span class="token punctuation">(</span><span class="token punctuation">{</span> audio<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> video<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">stream</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token comment">//兼容webkit内核浏览器</span>
          <span class="token keyword">let</span> url <span class="token operator">=</span> window<span class="token punctuation">.</span><span class="token constant">URL</span> <span class="token operator">||</span> window<span class="token punctuation">.</span>webkitURL<span class="token punctuation">;</span>
          <span class="token comment">//将视频流设置为video元素的源</span>
          video<span class="token punctuation">.</span>src <span class="token operator">=</span> url<span class="token punctuation">.</span><span class="token function">createObjectURL</span><span class="token punctuation">(</span>stream<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token comment">//播放视频</span>
          video<span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;访问用户媒体设备失败：&quot;</span><span class="token punctuation">,</span>error<span class="token punctuation">.</span>name<span class="token punctuation">,</span>error<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&quot;你的浏览器不支持访问用户媒体设备&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 拍照</span>
    document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;capture1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;click&quot;</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      context1<span class="token punctuation">.</span><span class="token function">drawImage</span><span class="token punctuation">(</span>video<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">240</span><span class="token punctuation">,</span><span class="token number">320</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// 设置下载图片的数据</span>
      document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'download'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>href <span class="token operator">=</span> canvas1<span class="token punctuation">.</span><span class="token function">toDataURL</span><span class="token punctuation">(</span><span class="token string">'image/png'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 摄像模拟 (canvas定时截取)</span>
    document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;capture2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;click&quot;</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        context2<span class="token punctuation">.</span><span class="token function">drawImage</span><span class="token punctuation">(</span>video<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">240</span><span class="token punctuation">,</span><span class="token number">320</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


  </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>一个 Vue 的示例:</p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>pug<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span>
  #CaptureImage
    .video(v-show=&quot;!showImage&quot;): video.capture(
      ref=&quot;video&quot;
      autoplay
      muted
    )
    .capture(v-show=&quot;showImage&quot;): canvas(
      ref=&quot;canvas&quot;
      :width=&quot;media.width&quot; :height=&quot;media.height&quot;
    )
    .controller
      .row
        .btn(@click=&quot;capture&quot; v-show=&quot;!showImage&quot;) 拍摄
        .btn(@click=&quot;reCapture&quot; v-show=&quot;showImage&quot;) 重拍
        .btn(@click=&quot;saveAndExit&quot; v-show=&quot;showImage&quot;) 保存
      .row.camera
        .text 切换摄像头
        mt-switch(v-model=&quot;camera&quot; @change=&quot;switchChange&quot;)
    c-Loading(v-show=&quot;uploading&quot; text=&quot;照片上传中, 请稍等...&quot;)
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">import</span> <span class="token punctuation">{</span>mapState<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vuex&quot;</span>

  <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    name<span class="token punctuation">:</span> <span class="token string">&quot;CaptureImage&quot;</span><span class="token punctuation">,</span>
    <span class="token function">data</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        media<span class="token punctuation">:</span> <span class="token punctuation">{</span>
          width<span class="token punctuation">:</span> <span class="token number">1080</span><span class="token punctuation">,</span>
          height<span class="token punctuation">:</span> <span class="token number">720</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        camera<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 前置后置摄像头切换</span>
        cameras<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 摄像头列表</span>
        currImage<span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token comment">// 当前录制的视频路径</span>
        currBlob<span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token comment">// 当前视频二进制</span>
        stream<span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token comment">// 视频流</span>
        uploading<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 上传中</span>
        showImage<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 显示播放器</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    computed<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      <span class="token operator">...</span><span class="token function">mapState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token function-variable function">chosenChapter</span><span class="token punctuation">:</span> <span class="token parameter">state</span> <span class="token operator">=&gt;</span> state<span class="token punctuation">.</span>chapter<span class="token punctuation">.</span>chosen
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">mounted</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>navigator<span class="token punctuation">.</span>mediaDevices<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'您的浏览器不支持获取用户设备'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>$router<span class="token punctuation">.</span><span class="token function">back</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>video <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>video<span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>canvas <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>canvas<span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>ctx <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">'2d'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getDevices</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      <span class="token comment">// 获取设备</span>
      <span class="token function">getDevices</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        navigator<span class="token punctuation">.</span>mediaDevices<span class="token punctuation">.</span><span class="token function">enumerateDevices</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>gotDevices<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>requestAccess<span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'getDevices error: '</span> <span class="token operator">+</span> error<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>

      <span class="token function">gotDevices</span><span class="token punctuation">(</span><span class="token parameter">deviceInfos</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">!==</span> deviceInfos<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">let</span> deviceInfo <span class="token operator">=</span> deviceInfos<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>deviceInfo<span class="token punctuation">.</span>kind <span class="token operator">===</span> <span class="token string">'videoinput'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>cameras<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
              value<span class="token punctuation">:</span> deviceInfo<span class="token punctuation">.</span>deviceId<span class="token punctuation">,</span>
              kind<span class="token punctuation">:</span> deviceInfo<span class="token punctuation">.</span>kind<span class="token punctuation">,</span>
              label<span class="token punctuation">:</span> deviceInfo<span class="token punctuation">.</span>label <span class="token operator">||</span> <span class="token string">'camera '</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>cameras<span class="token punctuation">.</span>length <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>

      <span class="token function">requestAccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>stream<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>stream<span class="token punctuation">.</span><span class="token function">getTracks</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">track</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            track<span class="token punctuation">.</span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>track<span class="token punctuation">.</span><span class="token function">getSettings</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">let</span> constraints <span class="token operator">=</span> <span class="token punctuation">{</span>
          audio<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
          video<span class="token punctuation">:</span> <span class="token punctuation">{</span>
            <span class="token comment">// 手机屏幕中宽高相反</span>
            width<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>media<span class="token punctuation">.</span>height<span class="token punctuation">,</span>
            height<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>media<span class="token punctuation">.</span>width<span class="token punctuation">,</span>
            frameRate<span class="token punctuation">:</span> <span class="token punctuation">{</span>
              ideal<span class="token punctuation">:</span> <span class="token number">60</span><span class="token punctuation">,</span>
              min<span class="token punctuation">:</span> <span class="token number">10</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            facingMode<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>camera <span class="token operator">?</span> <span class="token string">'environment'</span> <span class="token punctuation">:</span> <span class="token string">'user'</span><span class="token punctuation">,</span>
            deviceId<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>cameras<span class="token punctuation">[</span><span class="token function">Number</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>camera<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">.</span>value
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        navigator<span class="token punctuation">.</span>mediaDevices<span class="token punctuation">.</span><span class="token function">getUserMedia</span><span class="token punctuation">(</span>constraints<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">stream</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>stream <span class="token operator">=</span> stream<span class="token punctuation">;</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>video<span class="token punctuation">.</span>srcObject <span class="token operator">=</span> stream<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token function">alert</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>

      <span class="token comment">// 拍摄</span>
      <span class="token function">capture</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>ctx<span class="token punctuation">.</span><span class="token function">drawImage</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>video<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>media<span class="token punctuation">.</span>width<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>media<span class="token punctuation">.</span>height<span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>canvas<span class="token punctuation">.</span><span class="token function">toBlob</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">blob</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>currBlob <span class="token operator">=</span> blob
          <span class="token keyword">this</span><span class="token punctuation">.</span>currImage <span class="token operator">=</span> <span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">createObjectURL</span><span class="token punctuation">(</span>blob<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">this</span><span class="token punctuation">.</span>showImage <span class="token operator">=</span> <span class="token boolean">true</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>

      <span class="token function">reCapture</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>showImage <span class="token operator">=</span> <span class="token boolean">false</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>

      <span class="token comment">// 上传到OSS</span>
      <span class="token keyword">async</span> <span class="token function">save</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>uploading <span class="token operator">=</span> <span class="token boolean">true</span>
        <span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$utils<span class="token punctuation">.</span><span class="token function">uploadToOss</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>currBlob<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'image'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>ext<span class="token punctuation">:</span> <span class="token string">'.jpg'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>currImage <span class="token operator">=</span> res<span class="token punctuation">.</span>url
        <span class="token keyword">this</span><span class="token punctuation">.</span>uploading <span class="token operator">=</span> <span class="token boolean">false</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>

      <span class="token comment">// 保存并退出</span>
      <span class="token keyword">async</span> <span class="token function">saveAndExit</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$postData</span><span class="token punctuation">(</span><span class="token string">'addRes'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
          resPath<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>currImage <span class="token comment">// 资源路径</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>$router<span class="token punctuation">.</span><span class="token function">back</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>

      <span class="token comment">// 切换摄像头</span>
      <span class="token function">switchChange</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">requestAccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>

    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name">scoped</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>stylus<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
  .video<span class="token punctuation">,</span> .capture
    video<span class="token punctuation">,</span> canvas
      <span class="token property">width</span><span class="token punctuation">:</span> 9rem
      <span class="token property">height</span><span class="token punctuation">:</span> 6rem
      margin 0 auto
      <span class="token property">display</span><span class="token punctuation">:</span> block
      <span class="token property">border</span><span class="token punctuation">:</span> 1px solid #000
  .controller
    <span class="token property">margin-top</span><span class="token punctuation">:</span> 1em
    .row
      <span class="token property">display</span><span class="token punctuation">:</span> flex
      justify-content space-around
      <span class="token property">margin-top</span><span class="token punctuation">:</span> .2rem
      &amp;.camera
        <span class="token property">display</span><span class="token punctuation">:</span> flex
        <span class="token property">justify-content</span><span class="token punctuation">:</span> flex-start
        <span class="token property">align-items</span><span class="token punctuation">:</span> center
        .text
          <span class="token property">margin-right</span><span class="token punctuation">:</span> 1em
          <span class="token property">font-size</span><span class="token punctuation">:</span> 1.2em
      .btn
        <span class="token property">width</span><span class="token punctuation">:</span> 2rem
        <span class="token property">height</span><span class="token punctuation">:</span> 2rem
        <span class="token property">display</span><span class="token punctuation">:</span> flex
        <span class="token property">justify-content</span><span class="token punctuation">:</span> center
        <span class="token property">align-items</span><span class="token punctuation">:</span> center
        <span class="token property">background-color</span><span class="token punctuation">:</span> <span class="token function">rgba</span><span class="token punctuation">(</span>35<span class="token punctuation">,</span>184<span class="token punctuation">,</span>255<span class="token punctuation">,</span>1<span class="token punctuation">)</span>
        <span class="token property">color</span><span class="token punctuation">:</span> #fff
        <span class="token property">border-radius</span><span class="token punctuation">:</span> 50%
        <span class="token property">font-size</span><span class="token punctuation">:</span> .6rem
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>在采集的过程中, 直接将视频流传入 video 的 src 即可, 建议设置为 <code>autoplay</code>, 否则需要手动调用 <code>video.play()</code>, 一定要设置 <code>muted</code>, 否则将会出现麦克风回声。</p> <p>拍照的逻辑是借用 canvas 完成的, 直接将当前 video 的画面截取即可。</p> <p>以上示例部分API没放出, <code>utils.uploadToOss</code> 及 <code>postData</code> 为我自己封装的上传到 OSS 及数据请求的方法, 自行补全或脑补</p> <p>除此之外, 还有直接使用 input 采集图像视频的方法:</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token comment">&lt;!--调用手机的拍照功能和直接打开系统文件目录。--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>file<span class="token punctuation">&quot;</span></span> <span class="token attr-name">accept</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>image/*<span class="token punctuation">&quot;</span></span> <span class="token attr-name">capture</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>camera<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!--调用手机的录像功能和直接打开系统文件目录。--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>file<span class="token punctuation">&quot;</span></span> <span class="token attr-name">accept</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>video/*<span class="token punctuation">&quot;</span></span> <span class="token attr-name">capture</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>camcorder<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!--调用手机的录像功能和直接打开系统文件目录。苹果手机调出来的是拍照和录像安卓手机调出来的录音功能--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>file<span class="token punctuation">&quot;</span></span> <span class="token attr-name">accept</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>audio/*<span class="token punctuation">&quot;</span></span> <span class="token attr-name">capture</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>microphone<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>参考:</p> <ul><li><a href="https://segmentfault.com/a/1190000011793960" target="_blank" rel="noopener noreferrer">getUserMedia API及HTML5 调用手机摄像头拍照<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://www.cnblogs.com/libin-1/p/6142910.html" target="_blank" rel="noopener noreferrer">H5 调用摄像头<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://blog.csdn.net/qq_16024861/article/details/81387389" target="_blank" rel="noopener noreferrer">H5 录制视频<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://segmentfault.com/a/1190000008418998" target="_blank" rel="noopener noreferrer">H5 中调用系统拍照，录像，录音功能<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <h2 id="实例-捕获摄像头并进行录像"><a href="#实例-捕获摄像头并进行录像" aria-hidden="true" class="header-anchor">#</a> 实例: 捕获摄像头并进行录像</h2> <p>一个简单的示例, 演示如何调用摄像头并进行录像:</p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>pug<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span>
#CaptureVideo
  .video: video.capture(
    v-show='!showVideo'
    ref=&quot;video&quot;
    autoplay
    muted
  )
  .video: video(
    v-show=&quot;showVideo&quot;
    :src=&quot;currVideo&quot;
    controls
  )
  .controller
    .row
      .btn(@click=&quot;record&quot; v-if='!showVideo &amp;&amp; !recording') 录制
      .btn(@click=&quot;stop&quot; v-if=&quot;recording&quot;) 停止
      .btn(@click=&quot;recordAgain&quot; v-if='showVideo') 重录
      .btn(@click=&quot;saveAndExit&quot; v-if='showVideo') 保存
    .row.camera(v-if=&quot;!showVideo &amp;&amp; !recording&quot;)
      .text 切换摄像头
      mt-switch(v-model=&quot;camera&quot; @change=&quot;switchChange&quot;)
    .row(v-if='recording')
      div 剩余录制时间 {{Math.floor(remainTime/60)}}:{{Math.floor(remainTime%60)}}
  c-Loading(v-show=&quot;uploading&quot; text=&quot;视频上传中, 请稍等...&quot;)
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
<span class="token keyword">import</span> <span class="token punctuation">{</span>mapState<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vuex&quot;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token string">&quot;CaptureVideo&quot;</span><span class="token punctuation">,</span>
  <span class="token function">data</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      media<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        width<span class="token punctuation">:</span> <span class="token number">1080</span><span class="token punctuation">,</span>
        height<span class="token punctuation">:</span> <span class="token number">720</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      camera<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 前置后置摄像头切换</span>
      cameras<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 摄像头列表</span>
      mediaOptions<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        audioBitsPerSecond <span class="token punctuation">:</span> <span class="token number">128000</span><span class="token punctuation">,</span> <span class="token comment">// 音频码率</span>
        videoBitsPerSecond <span class="token punctuation">:</span> <span class="token number">2500000</span><span class="token punctuation">,</span> <span class="token comment">// 视频码率</span>
        mimeType <span class="token punctuation">:</span> <span class="token string">'video/webm;codecs=h264'</span>  <span class="token comment">// 编码格式</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// MediaRecorder 选项</span>
      chunks<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      recording<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      currVideo<span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token comment">// 当前录制的视频路径</span>
      currBlob<span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token comment">// 当前视频二进制</span>
      recorder<span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token comment">// MediaRecorder</span>
      stream<span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token comment">// 视频流</span>
      uploading<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 上传中</span>
      showVideo<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 显示播放器</span>
      interval<span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token comment">// 计时器</span>
      totalTime<span class="token punctuation">:</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token comment">// 剩余总时间</span>
      remainTime<span class="token punctuation">:</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token comment">// 剩余录制时间</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  computed<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span><span class="token function">mapState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token function-variable function">chosenChapter</span><span class="token punctuation">:</span> <span class="token parameter">state</span> <span class="token operator">=&gt;</span> state<span class="token punctuation">.</span>chapter<span class="token punctuation">.</span>chosen
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">mounted</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>navigator<span class="token punctuation">.</span>mediaDevices<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'您的浏览器不支持获取用户设备'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>$router<span class="token punctuation">.</span><span class="token function">back</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>window<span class="token punctuation">.</span>MediaRecorder<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'您的浏览器不支持录音'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>$router<span class="token punctuation">.</span><span class="token function">back</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>video <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>video<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getDevices</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 获取设备</span>
    <span class="token function">getDevices</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      navigator<span class="token punctuation">.</span>mediaDevices<span class="token punctuation">.</span><span class="token function">enumerateDevices</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>gotDevices<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>requestAccess<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'getDevices error: '</span> <span class="token operator">+</span> error<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>

    <span class="token function">gotDevices</span><span class="token punctuation">(</span><span class="token parameter">deviceInfos</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">!==</span> deviceInfos<span class="token punctuation">.</span>length<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> deviceInfo <span class="token operator">=</span> deviceInfos<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>deviceInfo<span class="token punctuation">.</span>kind <span class="token operator">===</span> <span class="token string">'videoinput'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>cameras<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            value<span class="token punctuation">:</span> deviceInfo<span class="token punctuation">.</span>deviceId<span class="token punctuation">,</span>
            kind<span class="token punctuation">:</span> deviceInfo<span class="token punctuation">.</span>kind<span class="token punctuation">,</span>
            label<span class="token punctuation">:</span> deviceInfo<span class="token punctuation">.</span>label <span class="token operator">||</span> <span class="token string">'camera '</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>cameras<span class="token punctuation">.</span>length <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>

    <span class="token function">requestAccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>stream<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>stream<span class="token punctuation">.</span><span class="token function">getTracks</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">track</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          track<span class="token punctuation">.</span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token keyword">let</span> constraints <span class="token operator">=</span> <span class="token punctuation">{</span>
        audio<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        video<span class="token punctuation">:</span> <span class="token punctuation">{</span>
          <span class="token comment">// 手机屏幕中宽高相反</span>
          width<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>media<span class="token punctuation">.</span>height<span class="token punctuation">,</span>
          height<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>media<span class="token punctuation">.</span>width<span class="token punctuation">,</span>
          frameRate<span class="token punctuation">:</span> <span class="token punctuation">{</span>
            ideal<span class="token punctuation">:</span> <span class="token number">60</span><span class="token punctuation">,</span>
            min<span class="token punctuation">:</span> <span class="token number">10</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          facingMode<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>camera <span class="token operator">?</span> <span class="token string">'environment'</span> <span class="token punctuation">:</span> <span class="token string">'user'</span><span class="token punctuation">,</span>
          <span class="token comment">// deviceId: this.cameras[Number(this.camera)].value</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>

      navigator<span class="token punctuation">.</span>mediaDevices<span class="token punctuation">.</span><span class="token function">getUserMedia</span><span class="token punctuation">(</span>constraints<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">stream</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>recorder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">window<span class="token punctuation">.</span>MediaRecorder</span><span class="token punctuation">(</span>stream<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>mediaOptions<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>stream <span class="token operator">=</span> stream<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>video<span class="token punctuation">.</span>srcObject <span class="token operator">=</span> stream<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>recorder<span class="token punctuation">.</span>ondataavailable <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>getRecordingData<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>recorder<span class="token punctuation">.</span>onstop <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>saveRecordingData<span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">alert</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>

    <span class="token comment">// 获取录制数据</span>
    <span class="token function">getRecordingData</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>chunks<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>

    <span class="token comment">// 保存录制数据</span>
    <span class="token keyword">async</span> <span class="token function">saveRecordingData</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>recording <span class="token operator">=</span> <span class="token boolean">false</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>showVideo<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> blob <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Blob</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>chunks<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string">'type'</span> <span class="token punctuation">:</span> <span class="token string">'video/webm;codecs=h264'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>currBlob <span class="token operator">=</span> blob
        <span class="token keyword">this</span><span class="token punctuation">.</span>currVideo <span class="token operator">=</span> <span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">createObjectURL</span><span class="token punctuation">(</span>blob<span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>chunks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>

    <span class="token comment">// 录制</span>
    <span class="token function">record</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>recording <span class="token operator">=</span> <span class="token boolean">true</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>recorder<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>interval <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token operator">--</span> <span class="token keyword">this</span><span class="token punctuation">.</span>remainTime
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>remainTime <span class="token operator">&lt;=</span> <span class="token number">0</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">clearInterval</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>interval<span class="token punctuation">)</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>remainTime <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>totalTime
          <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>

    <span class="token comment">// 重录</span>
    <span class="token function">recordAgain</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>showVideo <span class="token operator">=</span> <span class="token boolean">false</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>currVideo <span class="token operator">=</span> <span class="token keyword">null</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">record</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>

    <span class="token comment">// 停止</span>
    <span class="token keyword">async</span> <span class="token function">stop</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">clearInterval</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>interval<span class="token punctuation">)</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>remainTime <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>totalTime
      <span class="token keyword">this</span><span class="token punctuation">.</span>showVideo <span class="token operator">=</span> <span class="token boolean">true</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>recorder<span class="token punctuation">.</span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>

    <span class="token comment">// 上传到OSS</span>
    <span class="token keyword">async</span> <span class="token function">save</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>uploading <span class="token operator">=</span> <span class="token boolean">true</span>
      <span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$utils<span class="token punctuation">.</span><span class="token function">uploadToOss</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>currBlob<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'video'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>ext<span class="token punctuation">:</span> <span class="token string">'.mp4'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>currVideo <span class="token operator">=</span> res<span class="token punctuation">.</span>url
      <span class="token keyword">this</span><span class="token punctuation">.</span>uploading <span class="token operator">=</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>

    <span class="token comment">// 保存并退出</span>
    <span class="token keyword">async</span> <span class="token function">saveAndExit</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$postData</span><span class="token punctuation">(</span><span class="token string">'addRes'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        resPath<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>currVideo<span class="token punctuation">,</span> <span class="token comment">// 资源路径</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>$router<span class="token punctuation">.</span><span class="token function">back</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>

    <span class="token comment">// 切换摄像头</span>
    <span class="token function">switchChange</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>recording<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>showVideo <span class="token operator">=</span> <span class="token boolean">false</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>recorder<span class="token punctuation">.</span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>currVideo <span class="token operator">=</span> <span class="token keyword">null</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">requestAccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name">scoped</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>stylus<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
.video
  video<span class="token punctuation">,</span> img
    <span class="token property">width</span><span class="token punctuation">:</span> 9rem
    <span class="token property">height</span><span class="token punctuation">:</span> 6rem
    margin 0 auto
    <span class="token property">display</span><span class="token punctuation">:</span> block
    <span class="token property">border</span><span class="token punctuation">:</span> 1px solid #000
.controller
  <span class="token property">margin-top</span><span class="token punctuation">:</span> 1em
  .row
    <span class="token property">display</span><span class="token punctuation">:</span> flex
    justify-content space-around
    <span class="token property">margin-top</span><span class="token punctuation">:</span> .2rem
    &amp;.camera
      <span class="token property">display</span><span class="token punctuation">:</span> flex
      <span class="token property">justify-content</span><span class="token punctuation">:</span> flex-start
      <span class="token property">align-items</span><span class="token punctuation">:</span> center
      .text
        <span class="token property">margin-right</span><span class="token punctuation">:</span> 1em
        <span class="token property">font-size</span><span class="token punctuation">:</span> 1.2em
    .btn
      <span class="token property">width</span><span class="token punctuation">:</span> 2rem
      <span class="token property">height</span><span class="token punctuation">:</span> 2rem
      <span class="token property">display</span><span class="token punctuation">:</span> flex
      <span class="token property">justify-content</span><span class="token punctuation">:</span> center
      <span class="token property">align-items</span><span class="token punctuation">:</span> center
      <span class="token property">background-color</span><span class="token punctuation">:</span> <span class="token function">rgba</span><span class="token punctuation">(</span>35<span class="token punctuation">,</span>184<span class="token punctuation">,</span>255<span class="token punctuation">,</span>1<span class="token punctuation">)</span>
      <span class="token property">color</span><span class="token punctuation">:</span> #fff
      <span class="token property">border-radius</span><span class="token punctuation">:</span> 50%
      <span class="token property">font-size</span><span class="token punctuation">:</span> .6rem
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>以上示例, 通过 MediaRecorder 采集音视频流, 最后将采集的 Blob 上传到 OSS</p> <p>参考:</p> <ul><li><a href="https://www.toobug.net/article/capture_video_on_web.html" target="_blank" rel="noopener noreferrer">如何使用web录制视频<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://zhuanlan.zhihu.com/p/25162723" target="_blank" rel="noopener noreferrer">JS录制短语音和短视频(无插件，原生js实现)<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://blog.csdn.net/qingzhizhenhun/article/details/84565494" target="_blank" rel="noopener noreferrer">前端js调用摄像头进行录像并传到后端<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://www.jb51.net/article/145300.htm" target="_blank" rel="noopener noreferrer">详解js的视频和音频采集<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://www.jb51.net/article/144573.htm" target="_blank" rel="noopener noreferrer">vue 录制视频并压缩视频文件的方法<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <h2 id="实例-捕获录音设备并进行录音"><a href="#实例-捕获录音设备并进行录音" aria-hidden="true" class="header-anchor">#</a> 实例: 捕获录音设备并进行录音</h2> <p>一个简单的示例, 演示如何调用麦克风并进行录音, 其实也就是getUserMedia的约束少了一个video:</p> <div class="language-vue extra-class"><pre class="language-vue"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>pug<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span>
  #CaptureAudio
    .audio: audio(
      :src=&quot;currAudio&quot;
      controls
      v-if=&quot;showAudio&quot;
    )
    .controller
      .row
        .btn(@click=&quot;record&quot; v-if='!showAudio &amp;&amp; !recording') 录音
        .btn(@click=&quot;stop&quot; v-if=&quot;recording&quot;) 停止
        .btn(@click=&quot;recordAgain&quot; v-if='showAudio') 重录
        .btn(@click=&quot;saveAndExit&quot; v-if='showAudio') 保存
      .row(v-if='recording')
        div 剩余录制时间 {{Math.floor(remainTime/60)}}:{{Math.floor(remainTime%60)}}
    canvas(ref=&quot;canvas&quot; v-show=&quot;false&quot;)
    c-Loading(v-show=&quot;uploading&quot; text=&quot;音频上传中, 请稍等...&quot;)
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">import</span> <span class="token punctuation">{</span>mapState<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vuex&quot;</span>

  <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    name<span class="token punctuation">:</span> <span class="token string">&quot;CaptureAudio&quot;</span><span class="token punctuation">,</span>
    <span class="token function">data</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        chunks<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        recording<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        currAudio<span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token comment">// 当前录制的视频路径</span>
        currBlob<span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token comment">// 当前视频二进制</span>
        recorder<span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token comment">// MediaRecorder</span>
        uploading<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 上传中</span>
        showAudio<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 显示播放器</span>
        interval<span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token comment">// 计时器</span>
        totalTime<span class="token punctuation">:</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token comment">// 剩余总时间</span>
        remainTime<span class="token punctuation">:</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token comment">// 剩余录制时间</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    computed<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      <span class="token operator">...</span><span class="token function">mapState</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token function-variable function">chosenChapter</span><span class="token punctuation">:</span> <span class="token parameter">state</span> <span class="token operator">=&gt;</span> state<span class="token punctuation">.</span>chapter<span class="token punctuation">.</span>chosen
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">mounted</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>navigator<span class="token punctuation">.</span>mediaDevices<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'您的浏览器不支持获取用户设备'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>$router<span class="token punctuation">.</span><span class="token function">back</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>window<span class="token punctuation">.</span>MediaRecorder<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'您的浏览器不支持录音'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>$router<span class="token punctuation">.</span><span class="token function">back</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">requestAccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      <span class="token comment">// 获取设备权限</span>
      <span class="token function">requestAccess</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">let</span> constraints <span class="token operator">=</span> <span class="token punctuation">{</span>
          audio<span class="token punctuation">:</span> <span class="token punctuation">{</span>
            sampleRate<span class="token punctuation">:</span> <span class="token number">48000</span><span class="token punctuation">,</span>
            channelCount<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">// 0 捕获所有支持的声道 1 单声道 2 立体声</span>
            volume<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">// 0~1</span>
            noiseSuppression<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 抑制背景噪音</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          video<span class="token punctuation">:</span> <span class="token boolean">false</span>
        <span class="token punctuation">}</span>
        navigator<span class="token punctuation">.</span>mediaDevices<span class="token punctuation">.</span><span class="token function">getUserMedia</span><span class="token punctuation">(</span>constraints<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">stream</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>recorder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">window<span class="token punctuation">.</span>MediaRecorder</span><span class="token punctuation">(</span>stream<span class="token punctuation">)</span><span class="token punctuation">;</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;recorder&quot;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>recorder<span class="token punctuation">)</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>recorder<span class="token punctuation">.</span>ondataavailable <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>getRecordingData<span class="token punctuation">;</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>recorder<span class="token punctuation">.</span>onstop <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>saveRecordingData<span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token function">alert</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>

      <span class="token comment">// 获取录制数据</span>
      <span class="token function">getRecordingData</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;getRecordingData&quot;</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>chunks<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>

      <span class="token keyword">async</span> <span class="token function">saveRecordingData</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">clearInterval</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>interval<span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>remainTime <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>totalTime
        <span class="token keyword">this</span><span class="token punctuation">.</span>showAudio <span class="token operator">=</span> <span class="token boolean">true</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>recording <span class="token operator">=</span> <span class="token boolean">false</span>
        <span class="token keyword">let</span> blob <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Blob</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>chunks<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token string">'type'</span> <span class="token punctuation">:</span> <span class="token string">'audio/ogg; codecs=opus'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>currBlob <span class="token operator">=</span> blob
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;blob&quot;</span><span class="token punctuation">,</span> blob<span class="token punctuation">)</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;blob.size&quot;</span><span class="token punctuation">,</span> blob<span class="token punctuation">.</span>size<span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>currAudio <span class="token operator">=</span> <span class="token constant">URL</span><span class="token punctuation">.</span><span class="token function">createObjectURL</span><span class="token punctuation">(</span>blob<span class="token punctuation">)</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>currAudio<span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>chunks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>

      <span class="token comment">// 录制</span>
      <span class="token function">record</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>recording <span class="token operator">=</span> <span class="token boolean">true</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>recorder<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>interval <span class="token operator">=</span> <span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token operator">--</span> <span class="token keyword">this</span><span class="token punctuation">.</span>remainTime
          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>remainTime <span class="token operator">&lt;=</span> <span class="token number">0</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">clearInterval</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>interval<span class="token punctuation">)</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>remainTime <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>totalTime
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>

      <span class="token comment">// 重录</span>
      <span class="token function">recordAgain</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>showAudio <span class="token operator">=</span> <span class="token boolean">false</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>currAudio <span class="token operator">=</span> <span class="token keyword">null</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">record</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>

      <span class="token comment">// 停止</span>
      <span class="token keyword">async</span> <span class="token function">stop</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>recorder<span class="token punctuation">.</span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>

      <span class="token comment">// 上传到OSS</span>
      <span class="token keyword">async</span> <span class="token function">save</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>uploading <span class="token operator">=</span> <span class="token boolean">true</span>
        <span class="token keyword">let</span> res <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$utils<span class="token punctuation">.</span><span class="token function">uploadToOss</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>currBlob<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'audio'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>ext<span class="token punctuation">:</span> <span class="token string">'.mp3'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>currAudio <span class="token operator">=</span> res<span class="token punctuation">.</span>url
        <span class="token keyword">this</span><span class="token punctuation">.</span>uploading <span class="token operator">=</span> <span class="token boolean">false</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>

      <span class="token comment">// 保存并退出</span>
      <span class="token keyword">async</span> <span class="token function">saveAndExit</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$postData</span><span class="token punctuation">(</span><span class="token string">'addRes'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
          resPath<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>currAudio<span class="token punctuation">,</span> <span class="token comment">// 资源路径</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>$router<span class="token punctuation">.</span><span class="token function">back</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>

    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name">scoped</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>stylus<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
  .audio
    audio
      <span class="token property">width</span><span class="token punctuation">:</span> 100%
  .controller
    <span class="token property">margin-top</span><span class="token punctuation">:</span> 1em
    .row
      <span class="token property">display</span><span class="token punctuation">:</span> flex
      justify-content space-around
      <span class="token property">margin-top</span><span class="token punctuation">:</span> .2rem
      &amp;.camera
        <span class="token property">display</span><span class="token punctuation">:</span> flex
        <span class="token property">justify-content</span><span class="token punctuation">:</span> flex-start
        <span class="token property">align-items</span><span class="token punctuation">:</span> center
        .text
          <span class="token property">margin-right</span><span class="token punctuation">:</span> 1em
          <span class="token property">font-size</span><span class="token punctuation">:</span> 1.2em
      .btn
        <span class="token property">width</span><span class="token punctuation">:</span> 2rem
        <span class="token property">height</span><span class="token punctuation">:</span> 2rem
        <span class="token property">display</span><span class="token punctuation">:</span> flex
        <span class="token property">justify-content</span><span class="token punctuation">:</span> center
        <span class="token property">align-items</span><span class="token punctuation">:</span> center
        <span class="token property">background-color</span><span class="token punctuation">:</span> <span class="token function">rgba</span><span class="token punctuation">(</span>35<span class="token punctuation">,</span>184<span class="token punctuation">,</span>255<span class="token punctuation">,</span>1<span class="token punctuation">)</span>
        <span class="token property">color</span><span class="token punctuation">:</span> #fff
        <span class="token property">border-radius</span><span class="token punctuation">:</span> 50%
        <span class="token property">font-size</span><span class="token punctuation">:</span> .6rem
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>以上示例, 通过 MediaRecorder 采集音频流, 最后将采集的 Blob 上传到 OSS</p> <p>参考:</p> <ul><li><a href="https://www.cnblogs.com/stoneniqiu/p/7341181.html" target="_blank" rel="noopener noreferrer">H5 录音<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://www.cnblogs.com/blqw/p/3782420.html" target="_blank" rel="noopener noreferrer">HTML5 网页录音和压缩,边猜边做..(附源码)<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <h2 id="参考资料"><a href="#参考资料" aria-hidden="true" class="header-anchor">#</a> 参考资料</h2> <ul><li><a href="https://webrtc.org.cn/%E5%9C%A8html5%E8%A7%86%E9%A2%91%E5%BD%95%E5%88%B6%E6%96%B9%E9%9D%A2%EF%BC%8C%E6%88%91%E4%BB%AC%E4%B8%BA%E4%BB%80%E4%B9%88%E9%80%89webrtc%E8%80%8C%E4%B8%8D%E9%80%89media-recorder-api/" target="_blank" rel="noopener noreferrer">在HTML5视频录制方面，我们为什么选WebRTC而不选Media Recorder API<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://blog.csdn.net/sinat_39088557/article/details/80712634" target="_blank" rel="noopener noreferrer">安卓手机当做电脑摄像头使用，Android 8.0 + Win10亲测可用<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://adtuu.com/article/43.html" target="_blank" rel="noopener noreferrer">利用 javascript MediaSource 将 HTML video标签的src转成加载blob<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <p>MDN</p> <ul><li><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Basics_of_HTTP/MIME_types/Complete_list_of_MIME_types" target="_blank" rel="noopener noreferrer">Incomplete list of MIME types<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <p>相关项目</p> <ul><li><a href="https://www.webrtc-experiment.com/RecordRTC/Canvas-Recording/" target="_blank" rel="noopener noreferrer">Recording Canvas2D Animations using RecordRTC!<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>、<a href="https://github.com/muaz-khan/RecordRTC" target="_blank" rel="noopener noreferrer">GitHub<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://mgechev.github.io/jscapture/" target="_blank" rel="noopener noreferrer">JSCapture<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>、<a href="https://github.com/mgechev/jscapture" target="_blank" rel="noopener noreferrer">GitHub<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://simpl.info/getusermedia/sources/" target="_blank" rel="noopener noreferrer">simpl.info MediaStreamTrack.getSources<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://www.webrtc-experiment.com/RecordRTC/" target="_blank" rel="noopener noreferrer">Audio+Video+Screen Recording using RecordRTC<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>、<a href="https://github.com/muaz-khan/RecordRTC" target="_blank" rel="noopener noreferrer">GitHub<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://html5media.info/" target="_blank" rel="noopener noreferrer">HTML5 video was meant to be this easy<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://surmon-china.github.io/vue-video-player/" target="_blank" rel="noopener noreferrer">vue-video-player<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>、<a href="https://github.com/surmon-china/vue-video-player" target="_blank" rel="noopener noreferrer">GitHub<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://postbird.gitee.io/postbirdmp4toblob/" target="_blank" rel="noopener noreferrer">Postbird Mp4 to Blob<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>、<a href="https://github.com/postbird/PostbirdMp4ToBlob" target="_blank" rel="noopener noreferrer">GitHub<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://www.cnblogs.com/shihuc/p/7603600.html" target="_blank" rel="noopener noreferrer">基于H5的摄像头视频数据流采集<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>、<a href="https://github.com/shihuc/VideoConverter" target="_blank" rel="noopener noreferrer">GitHub<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <p>其他</p> <ul><li><a href="https://www.w3cplus.com/html5/node-webkit-for-photograph.html" target="_blank" rel="noopener noreferrer">Node-Webkit配合HTML5实现拍照功能<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://blog.csdn.net/u010020921/article/details/47109777" target="_blank" rel="noopener noreferrer">H5 学习之调用手机底层硬件----加速度传感器和震动<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://blog.csdn.net/qq_36538012/article/details/79805673" target="_blank" rel="noopener noreferrer">H5 调用底层接口的一些知识<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="http://www.cnblogs.com/polk6/p/5051935.html" target="_blank" rel="noopener noreferrer">HTML 获取屏幕、浏览器、页面的高度宽度<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div><div class="article-info"><div class="article-title">文档信息</div><p class="article-item">版权声明：著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。</p><p class="article-item">文章标题：深入理解 HTML5 - 音视频录制</p><p class="article-item">原文链接：<a href="https://www.xiaoyulive.top/categories/front-end/html/_pages/H5_Media.html">https://www.xiaoyulive.top/categories/front-end/html/_pages/H5_Media.html</a></p><p class="article-item">发表日期：2019-04-16</p></div><!----><!----></div><div class="footers" data-v-38547c78><p data-v-38547c78><span data-v-38547c78>MIT Licensed | Copyright © 2018-present  滇ICP备16006294号</span></p><p data-v-38547c78><span data-v-38547c78>Design by <a href="/">Quanzaiyu</a> | Power by <a href="https://vuepress.vuejs.org/" target="_blank">VuePress</a> | Hosted by <a href="https://pages.coding.me" target="_blank" style="font-weight: bold">Coding Pages</a></span></p></div></div><div class="global-ui"><!----><!----></div></div>
    <script src="/assets/js/app.bcb96cc1.js" defer></script><script src="/assets/js/5.314447d8.js" defer></script><script src="/assets/js/14.1aec49d6.js" defer></script>
  </body>
</html>
