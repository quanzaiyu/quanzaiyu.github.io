<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>数据库连接库 Sequelize | 小昱个人网站</title>
    <meta name="description" content="小昱个人网站">
    <meta http-equiv="Expires" content="Mon,12 May 2050 00:20:00 GMT">
  <link rel="icon" href="/logo.png">
  <link rel="manifest" href="/manifest.json">
  <link rel="stylesheet" href="//at.alicdn.com/t/font_517060_lom78h954w.css">
  <link rel="stylesheet" href="https://img.xiaoyulive.top/css/animate.css">
    
    <link rel="preload" href="/assets/css/0.styles.348d0f22.css" as="style"><link rel="preload" href="/assets/js/app.45415eeb.js" as="script"><link rel="preload" href="/assets/js/5.3d48ac25.js" as="script"><link rel="preload" href="/assets/js/14.35307f94.js" as="script"><link rel="prefetch" href="/assets/js/1.5696bc34.js"><link rel="prefetch" href="/assets/js/10.148f1025.js"><link rel="prefetch" href="/assets/js/11.b37ea789.js"><link rel="prefetch" href="/assets/js/12.a9bb58b1.js"><link rel="prefetch" href="/assets/js/13.328c17d4.js"><link rel="prefetch" href="/assets/js/15.15634fb0.js"><link rel="prefetch" href="/assets/js/2.18f6eb9d.js"><link rel="prefetch" href="/assets/js/6.8ac9f7c0.js"><link rel="prefetch" href="/assets/js/7.980960a5.js"><link rel="prefetch" href="/assets/js/8.84264161.js"><link rel="prefetch" href="/assets/js/9.0e8c0cba.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.382d340f.js">
    <link rel="stylesheet" href="/assets/css/0.styles.348d0f22.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-38547c78><header class="navbar" data-v-38547c78><div class="navbar-content"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div><a href="/" class="home-link router-link-active"><img src="/logo.png" class="logo"><span class="site-name can-hide">小昱个人网站</span></a><div class="links"><nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link">开发者博客</a></div><div class="nav-item"><a href="/articles/" class="nav-link">生活漫谈</a></div><div class="nav-item"><a href="/note/" class="nav-link">阅读札记</a></div><div class="nav-item"><a href="/categories/" class="nav-link router-link-active">学无止境</a></div><div class="nav-item"><a href="/share/" class="nav-link">精品分享</a></div><div class="nav-item"><a href="/favorite/" class="nav-link">收藏夹</a></div><!----></nav><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""><!----></div></div></div></header><div class="sidebar-mask" data-v-38547c78></div><div class="sidebar" data-v-38547c78><div class="sidebar-container"><nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link">开发者博客</a></div><div class="nav-item"><a href="/articles/" class="nav-link">生活漫谈</a></div><div class="nav-item"><a href="/note/" class="nav-link">阅读札记</a></div><div class="nav-item"><a href="/categories/" class="nav-link router-link-active">学无止境</a></div><div class="nav-item"><a href="/share/" class="nav-link">精品分享</a></div><div class="nav-item"><a href="/favorite/" class="nav-link">收藏夹</a></div><!----></nav><ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>数据库连接库 Sequelize</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/categories/nodejs/_pages/Sequelize.html#安装" class="sidebar-link">安装</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/categories/nodejs/_pages/Sequelize.html#建立连接" class="sidebar-link">建立连接</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/categories/nodejs/_pages/Sequelize.html#定义模型" class="sidebar-link">定义模型</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/categories/nodejs/_pages/Sequelize.html#通过-init-定义" class="sidebar-link">通过 init 定义</a></li><li class="sidebar-sub-header"><a href="/categories/nodejs/_pages/Sequelize.html#通过-sequelize-define-定义" class="sidebar-link">通过 sequelize.define 定义</a></li><li class="sidebar-sub-header"><a href="/categories/nodejs/_pages/Sequelize.html#通过模型导入的方式" class="sidebar-link">通过模型导入的方式</a></li></ul></li><li><a href="/categories/nodejs/_pages/Sequelize.html#模型选项" class="sidebar-link">模型选项</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/categories/nodejs/_pages/Sequelize.html#字段数据类型" class="sidebar-link">字段数据类型</a></li></ul></li><li><a href="/categories/nodejs/_pages/Sequelize.html#sequelize类" class="sidebar-link">Sequelize类</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/categories/nodejs/_pages/Sequelize.html#同步模型到数据库" class="sidebar-link">同步模型到数据库</a></li><li class="sidebar-sub-header"><a href="/categories/nodejs/_pages/Sequelize.html#执行原始sql查询" class="sidebar-link">执行原始SQL查询</a></li></ul></li><li><a href="/categories/nodejs/_pages/Sequelize.html#model类" class="sidebar-link">Model类</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/categories/nodejs/_pages/Sequelize.html#表操作" class="sidebar-link">表操作</a></li><li class="sidebar-sub-header"><a href="/categories/nodejs/_pages/Sequelize.html#模型类方法查询" class="sidebar-link">模型类方法查询</a></li><li class="sidebar-sub-header"><a href="/categories/nodejs/_pages/Sequelize.html#where" class="sidebar-link">where</a></li><li class="sidebar-sub-header"><a href="/categories/nodejs/_pages/Sequelize.html#order" class="sidebar-link">order</a></li><li class="sidebar-sub-header"><a href="/categories/nodejs/_pages/Sequelize.html#offset-和-limit" class="sidebar-link">offset 和 limit</a></li></ul></li><li><a href="/categories/nodejs/_pages/Sequelize.html#参考资料" class="sidebar-link">参考资料</a><ul class="sidebar-sub-headers"></ul></li></ul></div></li></ul></div></div><div class="page" data-v-38547c78><div class="content default"><h1 id="数据库连接库-sequelize"><a href="#数据库连接库-sequelize" aria-hidden="true" class="header-anchor">#</a> 数据库连接库 Sequelize</h1> <ul><li><a href="http://docs.sequelizejs.com/manual/getting-started.html" target="_blank" rel="noopener noreferrer">Sequelize Manual<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="http://www.nodeclass.com/api/sequelize.html" target="_blank" rel="noopener noreferrer">Sequelize API<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <p>通过 Sequelize 可以连接 Postgres, MySQl, MariaDB, SQLite</p> <div class="imgLink" data-v-16222526><img src="https://img.xiaoyulive.top/img/logo/sequelize.png" data-v-16222526></div> <p>本文编写时版本为 <code>5.8.6</code></p> <h2 id="安装"><a href="#安装" aria-hidden="true" class="header-anchor">#</a> 安装</h2> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">yarn</span> <span class="token function">add</span> sequelize

<span class="token comment"># 还需要安装以下之一：</span>
$ <span class="token function">yarn</span> <span class="token function">add</span> pg pg-hstore  // postgreSql
$ <span class="token function">yarn</span> <span class="token function">add</span> mysql // mysql 或 mariadb
$ <span class="token function">yarn</span> <span class="token function">add</span> sqlite3 // sqlite
$ <span class="token function">yarn</span> <span class="token function">add</span> tedious // MSSQL
</code></pre></div><h2 id="建立连接"><a href="#建立连接" aria-hidden="true" class="header-anchor">#</a> 建立连接</h2> <p>格式:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">new</span> <span class="token class-name">Sequelize</span><span class="token punctuation">(</span>database<span class="token punctuation">,</span> <span class="token punctuation">[</span>username<span class="token operator">=</span><span class="token keyword">null</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>password<span class="token operator">=</span><span class="token keyword">null</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>options<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">new</span> <span class="token class-name">Sequelize</span><span class="token punctuation">(</span>uri<span class="token punctuation">,</span> <span class="token punctuation">[</span>options<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div><p>实例化参数</p> <table><thead><tr><th style="text-align:left;">名称</th> <th style="text-align:left;">类型</th> <th style="text-align:left;">说明</th></tr></thead> <tbody><tr><td style="text-align:left;">database</td> <td style="text-align:left;">String</td> <td style="text-align:left;">数据库名</td></tr> <tr><td style="text-align:left;">[username=null]</td> <td style="text-align:left;">String</td> <td style="text-align:left;">数据库用户名</td></tr> <tr><td style="text-align:left;">[password=null]</td> <td style="text-align:left;">String</td> <td style="text-align:left;">数据库密码</td></tr> <tr><td style="text-align:left;">[options={}]</td> <td style="text-align:left;">Object</td> <td style="text-align:left;">参数对象</td></tr></tbody></table> <p>options参数对象:</p> <p>| 名称                               | 类型     | 说明                                                         |
| [dialect='mysql']                  | String   | 要连接的数据库类型。可选值有：mysql、postgres、sqlite、mariadb、mssql |
| [dialectModulePath=null]           | String   | 指定后，将通过此路径模块加载数据库                           |
| [dialectOptions]                   | Object   | 路径模块所使用的扩展选项                                     |
| [storage]                          | String   | 仅用于sqlite， 默认为':memory:'                              |
| [host='localhost']                 | String   | 连接数据库的主机                                             |
| [port=]                            | String   | 连接数据库的端口                                             |
| [protocol='tcp']                   | String   | 连接数据库使用的协议                                         |
| [define={}]                        | Object   | 定义模型的选项，默认为<a href="https://itbilu.com/nodejs/npm/VkYIaRPz-.html#api-instance-define" target="_blank" rel="noopener noreferrer">'sequelize.define'选项<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> |
| [query={}]                         | Object   | 'sequelize.query'的默认选项                                  |
| [set={}]                           | Object   | 'sequelize.set'的默认选项                                    |
| [sync={}]                          | Object   | 'sequelize.sync'的默认选项                                   |
| [timezone='+00:00']                | String   | 时间转换时从数据库得到的JavaScript时间。这个时区将应用于连接服务器的 NOW、CURRENT_TIMESTAMP或其它日期函数 |
| [logging=console.log]              | Function | 用于Sequelize日志打印的函数                                  |
| [omitNull=false]                   | Boolean  | null值是否通过SQL查询                                        |
| [native=false]                     | Boolean  | 是否使用本地库，仅用于 postgres                              |
| [replication=false]                | Boolean  | 是否使用读/写复制(读写分离)。要启用读/写复制，需要传递一个对象，这个对象有<code>read</code>、<code>write</code>两个属性。<code>write</code>是一个单一的对象(由单台服务器处理写入)，而<code>read</code>是一个包含对象的数组(由多台服务器处理读取)。每台<code>read</code>、<code>write</code>服务器都可以包含以下属性：<code>host</code>、<code>port</code>、<code>username</code>、<code>password</code>、<code>database</code>。  读写分离的使用请参考：<a href="http://itbilu.com/nodejs/npm/VydcPndib.html" target="_blank" rel="noopener noreferrer">Sequelize 实现数据库读写分离<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> |
| [pool={}]                          | Object   | 使用连接池连接，默认为<code>true</code>                                 |
| [pool.maxConnections]              | Integer  |                                                              |
| [pool.minConnections]              | Integer  |                                                              |
| [pool.maxIdleTime]                 | Integer  | 连接最大空置时间（毫秒），超时后将释放连接                   |
| [pool.validateConnection]          | Function | 连接验证函数                                                 |
| [quoteIdentifiers=true]            | Boolean  | 设置为<code>false</code>时Postgres中会使表名和属性大小写不敏感，并跳过双引号 |
| [transactionType='DEFERRED']       | String   | 设置事务类型，详见<a href="http://itbilu.com/nodejs/npm/EJO6CcCM-.html#usage" target="_blank" rel="noopener noreferrer"><code>Sequelize.Transaction.TYPES</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。仅Sqlite适用 |
| [isolationLevel='REPEATABLE_READ'] | String   | 设置事件的隔离级别，详见<a href="http://itbilu.com/nodejs/npm/EJO6CcCM-.html#usage-isolations" target="_blank" rel="noopener noreferrer"><code>Sequelize.Transaction.ISOLATION_LEVELS</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> |
| [retry]                            | Object   | 设置自动查询时的重试标志                                     |
| [retry.match]                      | Array    | 匹配到指定的错误字符串之一后重试查询                         |
| [retry.max]                        | Integer  | 设置重试次数                                                 |
| [typeValidation=false]             | Boolean  | 在插入、更新等操作时执行类型验证                             |
| [benchmark=false]                  | Boolean  | 在打印执行的SQL日志时输出执行时间（毫秒）                    |</p> <p>Sequelize会在初始化时设置一个连接池，这样你应该为每个数据库创建一个实例：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> Sequelize <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'sequelize'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> sequelize <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Sequelize</span><span class="token punctuation">(</span><span class="token string">'database'</span><span class="token punctuation">,</span> <span class="token string">'username'</span><span class="token punctuation">,</span> <span class="token string">'password'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  host<span class="token punctuation">:</span> <span class="token string">'localhost'</span><span class="token punctuation">,</span>
  dialect<span class="token punctuation">:</span> <span class="token string">'mysql'</span><span class="token operator">|</span><span class="token string">'mariadb'</span><span class="token operator">|</span><span class="token string">'sqlite'</span><span class="token operator">|</span><span class="token string">'postgres'</span><span class="token operator">|</span><span class="token string">'mssql'</span><span class="token punctuation">,</span>

  operatorsAliases<span class="token punctuation">:</span><span class="token boolean">false</span><span class="token punctuation">,</span>
  dialectOptions<span class="token punctuation">:</span><span class="token punctuation">{</span>
      charset<span class="token punctuation">:</span> <span class="token string">'utf8mb4'</span><span class="token punctuation">,</span>
      supportBigNumbers<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      bigNumberStrings<span class="token punctuation">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  pool<span class="token punctuation">:</span><span class="token punctuation">{</span>
      max<span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
      min<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
      acquire<span class="token punctuation">:</span> <span class="token number">30000</span><span class="token punctuation">,</span>
      idle<span class="token punctuation">:</span> <span class="token number">10000</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  timezone<span class="token punctuation">:</span> <span class="token string">'+08:00'</span>  <span class="token comment">// 东八时区</span>

  <span class="token comment">// 仅 SQLite 适用</span>
  storage<span class="token punctuation">:</span> <span class="token string">'path/to/database.sqlite'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 或者可以简单的使用一个连接 uri</span>
<span class="token keyword">const</span> sequelize <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Sequelize</span><span class="token punctuation">(</span><span class="token string">'postgres://user:pass@localhost:5432/dbname'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// postgres</span>
<span class="token keyword">const</span> sequelize <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Sequelize</span><span class="token punctuation">(</span><span class="token string">'mysql://user:pass@localhost:3306/dbname'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// mysql</span>
</code></pre></div><p>通过构造函数实例化后，就可以通过其返回的sequelize实例定义Model、执行query查询、执行transaction等。</p> <h2 id="定义模型"><a href="#定义模型" aria-hidden="true" class="header-anchor">#</a> 定义模型</h2> <h3 id="通过-init-定义"><a href="#通过-init-定义" aria-hidden="true" class="header-anchor">#</a> 通过 init 定义</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> Sequelize <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'sequelize'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> sequelize <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Sequelize</span><span class="token punctuation">(</span><span class="token string">'mysql://root:root@localhost:3306/test'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Article</span> <span class="token keyword">extends</span> <span class="token class-name">Sequelize<span class="token punctuation">.</span>Model</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
Article<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  id<span class="token punctuation">:</span><span class="token punctuation">{</span>
    type<span class="token punctuation">:</span> Sequelize<span class="token punctuation">.</span><span class="token constant">INTEGER</span><span class="token punctuation">,</span>
    primaryKey<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    allowNull<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    autoIncrement<span class="token punctuation">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  title<span class="token punctuation">:</span> Sequelize<span class="token punctuation">.</span><span class="token constant">STRING</span><span class="token punctuation">,</span>
  author<span class="token punctuation">:</span> Sequelize<span class="token punctuation">.</span><span class="token constant">STRING</span><span class="token punctuation">,</span>
  content<span class="token punctuation">:</span> Sequelize<span class="token punctuation">.</span><span class="token constant">STRING</span><span class="token punctuation">,</span>
  category<span class="token punctuation">:</span> Sequelize<span class="token punctuation">.</span><span class="token constant">STRING</span><span class="token punctuation">,</span>
  createdAt<span class="token punctuation">:</span> Sequelize<span class="token punctuation">.</span><span class="token constant">DATE</span><span class="token punctuation">,</span>
  updatedAt<span class="token punctuation">:</span> Sequelize<span class="token punctuation">.</span><span class="token constant">DATE</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  sequelize<span class="token punctuation">,</span>
  freezeTableName<span class="token punctuation">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

sequelize<span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">{</span>force<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// 自动创建表</span>

<span class="token keyword">class</span> <span class="token class-name">ArticleModel</span> <span class="token keyword">extends</span> <span class="token class-name">Article</span> <span class="token punctuation">{</span> <span class="token comment">// 继承以使用模型方法</span>
  <span class="token keyword">static</span> <span class="token keyword">async</span> <span class="token function">createArticle</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">await</span> Article<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      title<span class="token punctuation">:</span> data<span class="token punctuation">.</span>title<span class="token punctuation">,</span>
      author<span class="token punctuation">:</span> data<span class="token punctuation">.</span>author<span class="token punctuation">,</span>
      content<span class="token punctuation">:</span> data<span class="token punctuation">.</span>content<span class="token punctuation">,</span>
      category<span class="token punctuation">:</span> data<span class="token punctuation">.</span>category
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">static</span> <span class="token keyword">async</span> <span class="token function">getArticleDetail</span><span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">await</span> Article<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      where<span class="token punctuation">:</span><span class="token punctuation">{</span>
        id
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> ArticleModel<span class="token punctuation">;</span>
</code></pre></div><h3 id="通过-sequelize-define-定义"><a href="#通过-sequelize-define-定义" aria-hidden="true" class="header-anchor">#</a> 通过 sequelize.define 定义</h3> <p>格式:</p> <div class="language-ts extra-class"><pre class="language-ts"><code>sequelize<span class="token punctuation">.</span><span class="token function">define</span><span class="token punctuation">(</span>modelName<span class="token punctuation">,</span> attributes<span class="token punctuation">,</span> <span class="token punctuation">[</span>options<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> Model
</code></pre></div><p>这个实例方法用于定义一个新Model（模型）。Model相当于数据库中的表，可以通过 <code>sequelize.define()</code> 或 <code>sequelize.import()</code> 方法创建。</p> <p>表中的字段通过第二个参数对象attributes来定义，对象中的一个属性相当于表中的一个字段。</p> <p>如，可以像下面这样定义一个表：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> Sequelize <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'sequelize'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> sequelize <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Sequelize</span><span class="token punctuation">(</span><span class="token string">'mysql://root:root@localhost:3306/test'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> Article <span class="token operator">=</span> sequelize<span class="token punctuation">.</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token string">'article'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  id<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    type<span class="token punctuation">:</span> Sequelize<span class="token punctuation">.</span><span class="token constant">INTEGER</span><span class="token punctuation">,</span>
    primaryKey<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    allowNull<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    autoIncrement<span class="token punctuation">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  title<span class="token punctuation">:</span> Sequelize<span class="token punctuation">.</span><span class="token constant">STRING</span><span class="token punctuation">,</span>
  author<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    type<span class="token punctuation">:</span> Sequelize<span class="token punctuation">.</span><span class="token constant">STRING</span><span class="token punctuation">,</span>
    validate<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      is<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;[a-z]&quot;</span><span class="token punctuation">,</span><span class="token string">'i'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token comment">// will only allow letters</span>
      max<span class="token punctuation">:</span> <span class="token number">23</span><span class="token punctuation">,</span>                  <span class="token comment">// only allow values &lt;= 23</span>
      isIn<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        args<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'en'</span><span class="token punctuation">,</span> <span class="token string">'zh'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        msg<span class="token punctuation">:</span> <span class="token string">&quot;Must be English or Chinese&quot;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    field<span class="token punctuation">:</span> <span class="token string">'author'</span>
    <span class="token comment">// Other attributes here</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  content<span class="token punctuation">:</span> Sequelize<span class="token punctuation">.</span><span class="token constant">STRING</span><span class="token punctuation">,</span>
  category<span class="token punctuation">:</span> Sequelize<span class="token punctuation">.</span><span class="token constant">STRING</span><span class="token punctuation">,</span>
  createdAt<span class="token punctuation">:</span> Sequelize<span class="token punctuation">.</span><span class="token constant">DATE</span><span class="token punctuation">,</span>
  updatedAt<span class="token punctuation">:</span> Sequelize<span class="token punctuation">.</span><span class="token constant">DATE</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  freezeTableName<span class="token punctuation">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

sequelize<span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">{</span>force<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// 自动创建表</span>

<span class="token keyword">class</span> <span class="token class-name">ArticleModel</span> <span class="token keyword">extends</span> <span class="token class-name">Article</span> <span class="token punctuation">{</span> <span class="token comment">// 继承以使用模型方法</span>
  <span class="token keyword">static</span> <span class="token keyword">async</span> <span class="token function">createArticle</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">await</span> Article<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      title<span class="token punctuation">:</span> data<span class="token punctuation">.</span>title<span class="token punctuation">,</span>
      author<span class="token punctuation">:</span> data<span class="token punctuation">.</span>author<span class="token punctuation">,</span>
      content<span class="token punctuation">:</span> data<span class="token punctuation">.</span>content<span class="token punctuation">,</span>
      category<span class="token punctuation">:</span> data<span class="token punctuation">.</span>category
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">static</span> <span class="token keyword">async</span> <span class="token function">getArticleDetail</span><span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">await</span> Article<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      where<span class="token punctuation">:</span><span class="token punctuation">{</span>
        id
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> ArticleModel<span class="token punctuation">;</span>
</code></pre></div><h3 id="通过模型导入的方式"><a href="#通过模型导入的方式" aria-hidden="true" class="header-anchor">#</a> 通过模型导入的方式</h3> <p>格式:</p> <div class="language-ts extra-class"><pre class="language-ts"><code>sequelize<span class="token punctuation">.</span><span class="token keyword">import</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> Model
</code></pre></div><p><code>schema/article.js</code></p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">sequelize<span class="token punctuation">,</span> DataTypes</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">return</span> sequelize<span class="token punctuation">.</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token string">'article'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    id<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      type<span class="token punctuation">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">INTEGER</span><span class="token punctuation">,</span>
      primaryKey<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      allowNull<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      autoIncrement<span class="token punctuation">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    title<span class="token punctuation">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">STRING</span><span class="token punctuation">,</span>
    author<span class="token punctuation">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">STRING</span><span class="token punctuation">,</span>
    content<span class="token punctuation">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">STRING</span><span class="token punctuation">,</span>
    category<span class="token punctuation">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">STRING</span><span class="token punctuation">,</span>
    createdAt<span class="token punctuation">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">DATE</span><span class="token punctuation">,</span>
    updatedAt<span class="token punctuation">:</span> DataTypes<span class="token punctuation">.</span><span class="token constant">DATE</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    freezeTableName<span class="token punctuation">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>model/article.js</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> sequelize <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Sequelize</span><span class="token punctuation">(</span><span class="token string">'mysql://root:root@localhost:3306/test'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 引入数据表模型</span>
<span class="token keyword">const</span> Article <span class="token operator">=</span> sequelize<span class="token punctuation">.</span><span class="token function">import</span><span class="token punctuation">(</span><span class="token string">'../schema/article'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Article<span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">{</span>force<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 自动创建表</span>

<span class="token keyword">class</span> <span class="token class-name">ArticleModel</span> <span class="token keyword">extends</span> <span class="token class-name">Article</span> <span class="token punctuation">{</span> <span class="token comment">// 继承以使用模型方法</span>
  <span class="token keyword">static</span> <span class="token keyword">async</span> <span class="token function">createArticle</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">await</span> Article<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      title<span class="token punctuation">:</span> data<span class="token punctuation">.</span>title<span class="token punctuation">,</span>
      author<span class="token punctuation">:</span> data<span class="token punctuation">.</span>author
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">static</span> <span class="token keyword">async</span> <span class="token function">getArticleDetail</span><span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">await</span> Article<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      where<span class="token punctuation">:</span><span class="token punctuation">{</span>
        id
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> ArticleModel<span class="token punctuation">;</span>
</code></pre></div><h2 id="模型选项"><a href="#模型选项" aria-hidden="true" class="header-anchor">#</a> 模型选项</h2> <h3 id="字段数据类型"><a href="#字段数据类型" aria-hidden="true" class="header-anchor">#</a> 字段数据类型</h3> <p>在定义模型时，我们会指定其属性（type 字段）的数据类型，下面是Sequelize中支持数据类型及其与数据库中字段类型的对应关系：</p> <div class="language- extra-class"><pre class="language-text"><code>Sequelize.STRING                      // VARCHAR(255)
Sequelize.STRING(1234)                // VARCHAR(1234)
Sequelize.STRING.BINARY               // VARCHAR BINARY
Sequelize.TEXT                        // TEXT
Sequelize.TEXT('tiny')                // TINYTEXT

Sequelize.INTEGER                     // INTEGER
Sequelize.BIGINT                      // BIGINT
Sequelize.BIGINT(11)                  // BIGINT(11)

Sequelize.FLOAT                       // FLOAT
Sequelize.FLOAT(11)                   // FLOAT(11)
Sequelize.FLOAT(11, 12)               // FLOAT(11,12)

Sequelize.REAL                        // REAL        PostgreSQL only.
Sequelize.REAL(11)                    // REAL(11)    PostgreSQL only.
Sequelize.REAL(11, 12)                // REAL(11,12) PostgreSQL only.

Sequelize.DOUBLE                      // DOUBLE
Sequelize.DOUBLE(11)                  // DOUBLE(11)
Sequelize.DOUBLE(11, 12)              // DOUBLE(11,12)

Sequelize.DECIMAL                     // DECIMAL
Sequelize.DECIMAL(10, 2)              // DECIMAL(10,2)

Sequelize.DATE                        // DATETIME for mysql / sqlite, TIMESTAMP WITH TIME ZONE for postgres
Sequelize.DATE(6)                     // DATETIME(6) for mysql 5.6.4+. Fractional seconds support with up to 6 digits of precision
Sequelize.DATEONLY                    // DATE without time.
Sequelize.BOOLEAN                     // TINYINT(1)

Sequelize.ENUM('value 1', 'value 2')  // An ENUM with allowed values 'value 1' and 'value 2'
Sequelize.ARRAY(Sequelize.TEXT)       // Defines an array. PostgreSQL only.

Sequelize.JSON                        // JSON column. PostgreSQL only.
Sequelize.JSONB                       // JSONB column. PostgreSQL only.

Sequelize.BLOB                        // BLOB (bytea for PostgreSQL)
Sequelize.BLOB('tiny')                // TINYBLOB (bytea for PostgreSQL. Other options are medium and long)

Sequelize.UUID                        //   PostgreSQL 和 SQLite 中为 UUID, MySQL 中为CHAR(36) BINARY (使用 defaultValue: Sequelize.UUIDV1 或 Sequelize.UUIDV4 生成默认值)

Sequelize.RANGE(Sequelize.INTEGER)    // Defines int4range range. PostgreSQL only.
Sequelize.RANGE(Sequelize.BIGINT)     // Defined int8range range. PostgreSQL only.
Sequelize.RANGE(Sequelize.DATE)       // Defines tstzrange range. PostgreSQL only.
Sequelize.RANGE(Sequelize.DATEONLY)   // Defines daterange range. PostgreSQL only.
Sequelize.RANGE(Sequelize.DECIMAL)    // Defines numrange range. PostgreSQL only.

Sequelize.ARRAY(Sequelize.RANGE(Sequelize.DATE)) // Defines array of tstzrange ranges. PostgreSQL only.

Sequelize.GEOMETRY                    // Spatial column.  PostgreSQL (with PostGIS) or MySQL only.
Sequelize.GEOMETRY('POINT')           // Spatial column with geomerty type.  PostgreSQL (with PostGIS) or MySQL only.
Sequelize.GEOMETRY('POINT', 4326)     // Spatial column with geomerty type and SRID.  PostgreSQL (with PostGIS) o
</code></pre></div><h2 id="sequelize类"><a href="#sequelize类" aria-hidden="true" class="header-anchor">#</a> Sequelize类</h2> <h3 id="同步模型到数据库"><a href="#同步模型到数据库" aria-hidden="true" class="header-anchor">#</a> 同步模型到数据库</h3> <p>通过 <code>sequelize.sync</code> 同步所有已定义的模型到数据库中</p> <p>格式:</p> <div class="language-js extra-class"><pre class="language-js"><code>sequelize<span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">[</span>options<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> Promise
</code></pre></div><p>参数</p> <table><thead><tr><th style="text-align:left;">名称</th> <th style="text-align:left;">类型</th> <th style="text-align:left;">说明</th></tr></thead> <tbody><tr><td style="text-align:left;">[options={}]</td> <td style="text-align:left;">Object</td> <td style="text-align:left;"></td></tr> <tr><td style="text-align:left;">[options.force=false]</td> <td style="text-align:left;">Boolean</td> <td style="text-align:left;">设置为 true，会在创建表前先删除原表，即：DROP TABLE IF EXISTS ...</td></tr> <tr><td style="text-align:left;">[options.match]</td> <td style="text-align:left;">RegEx</td> <td style="text-align:left;">添加匹配规则，只重建匹配的表，在<code>force: true</code>时非常有用</td></tr> <tr><td style="text-align:left;">[options.logging=console.log]</td> <td style="text-align:left;">Boolean | function</td> <td style="text-align:left;">执行SQL的日志打印函数</td></tr> <tr><td style="text-align:left;">[options.schema='public']</td> <td style="text-align:left;">String</td> <td style="text-align:left;">创建表的 schema 。这一选项可以每个表的 <code>sequelize.define</code>中重写</td></tr> <tr><td style="text-align:left;">[options.searchPath=DEFAULT]</td> <td style="text-align:left;">String</td> <td style="text-align:left;">一个用于指定 schema 的 search_path 的可选项(仅 Postgres 适用)</td></tr> <tr><td style="text-align:left;">[options.hooks=true]</td> <td style="text-align:left;">Boolean</td> <td style="text-align:left;">设置为<code>true</code>时，会调用同步相关的钩子函数：beforeSync、afterSync、beforBulkSync、afterBulkSync</td></tr></tbody></table> <p><code>.sync({ force: true })</code> 会删除并重建表，这时我们可以添加match选项，只重建正则表达式匹配的表：</p> <div class="language-js extra-class"><pre class="language-js"><code>sequelize<span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">{</span> force<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> match<span class="token punctuation">:</span> <span class="token regex">/_test$/</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="执行原始sql查询"><a href="#执行原始sql查询" aria-hidden="true" class="header-anchor">#</a> 执行原始SQL查询</h3> <p>格式:</p> <div class="language-js extra-class"><pre class="language-js"><code>sequelize<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>sql<span class="token punctuation">,</span> <span class="token punctuation">[</span>options<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> Promise
</code></pre></div><p>执行 原始SQL 语句进行查询</p> <p>第二个可选参数中传一个type参数，并指定查询的类型。设置后，sequelize会对结果进行格式化：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token keyword">await</span> sequelize<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">'SELECT * from article'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  type<span class="token punctuation">:</span> sequelize<span class="token punctuation">.</span>QueryTypes<span class="token punctuation">.</span><span class="token constant">SELECT</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// 返回一个 Array</span>
</code></pre></div><table><thead><tr><th style="text-align:left;">名称</th> <th style="text-align:left;">类型</th> <th style="text-align:left;">说明</th></tr></thead> <tbody><tr><td style="text-align:left;">sql</td> <td style="text-align:left;">String</td> <td style="text-align:left;"></td></tr> <tr><td style="text-align:left;">[options={}]</td> <td style="text-align:left;">Object</td> <td style="text-align:left;">查询选项</td></tr> <tr><td style="text-align:left;">[options.raw]</td> <td style="text-align:left;">Boolean</td> <td style="text-align:left;">设置为<code>true</code>时，sequelize 不会查询结果进行格式化，或不会根据结果构建实例</td></tr> <tr><td style="text-align:left;">[options.transaction=null]</td> <td style="text-align:left;">Transaction</td> <td style="text-align:left;">为查询指定事务</td></tr> <tr><td style="text-align:left;">[options.type='RAW']</td> <td style="text-align:left;">String</td> <td style="text-align:left;">执行的查询类型，sequelize会根据这个类型对返回结果格式化。可以设置为一个字符串，或是通过<a href="https://itbilu.com/nodejs/npm/VkYIaRPz-.html#api-QueryTypes" target="_blank" rel="noopener noreferrer"><code>Sequelize.QueryTypes</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>来设置</td></tr> <tr><td style="text-align:left;">[options.nest=false]</td> <td style="text-align:left;">Boolean</td> <td style="text-align:left;">设置为<code>true</code>，会使用<a href="https://github.com/mickhansen/dottie.js" target="_blank" rel="noopener noreferrer">dottie.js<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>库，转换通过<code>.</code>设置的对象层级关系。如：<code>{ 'user.username': 'john' }</code> 会被转换为 <code>{ user: { username: 'john' }}</code>。设置<code>true</code>后，查询类型如未明确指定，则使用<code>'SELECT'</code></td></tr> <tr><td style="text-align:left;">[options.plain=false]</td> <td style="text-align:left;">Boolean</td> <td style="text-align:left;">设置查询类型为 <code>SELECT</code> 并返回单行结果</td></tr> <tr><td style="text-align:left;">[options.replacements]</td> <td style="text-align:left;">Object | Array</td> <td style="text-align:left;">替换<code>:param</code>格式的查询参数对象，或用于替换SQL中<code>?</code>符号的参数数组</td></tr> <tr><td style="text-align:left;">[options.bind]</td> <td style="text-align:left;">Object | Array</td> <td style="text-align:left;"><code>$param</code>格式绑定参数的对象，或未命令绑定参数数组，会替换SQL中的<code>$1, $2, ...</code></td></tr> <tr><td style="text-align:left;">[options.useMaster=false]</td> <td style="text-align:left;">Boolean</td> <td style="text-align:left;">强制查询使用写池，而不管查询类型</td></tr> <tr><td style="text-align:left;">[options.logging=false]</td> <td style="text-align:left;">Function</td> <td style="text-align:left;">一个用打印执行的SQL语句的函数</td></tr> <tr><td style="text-align:left;">[options.instance]</td> <td style="text-align:left;">Instance</td> <td style="text-align:left;">用于sequelize 实例，用于从查询结果中构建实例</td></tr> <tr><td style="text-align:left;">[options.model]</td> <td style="text-align:left;">Model</td> <td style="text-align:left;">用于sequelize 模型，用于从查询结果中构建实例</td></tr> <tr><td style="text-align:left;">[options.retry]</td> <td style="text-align:left;">Object</td> <td style="text-align:left;">设置自动重试的控制标识对象</td></tr> <tr><td style="text-align:left;">[options.retry.match]</td> <td style="text-align:left;">Array</td> <td style="text-align:left;">发生错误时，匹配到数组中的标识后自动重试</td></tr> <tr><td style="text-align:left;">[options.retry.max]</td> <td style="text-align:left;">Integer</td> <td style="text-align:left;">设置最大重试次数</td></tr> <tr><td style="text-align:left;">[options.searchPath=DEFAULT]</td> <td style="text-align:left;">String</td> <td style="text-align:left;">一个用于指定 schema 的 search_path 的可选项(仅 Postgres 适用)</td></tr> <tr><td style="text-align:left;">[options.supportsSearchPath]</td> <td style="text-align:left;">Boolean</td> <td style="text-align:left;">是否使用 searchPath (仅 Postgres 适用)</td></tr> <tr><td style="text-align:left;">[options.mapToModel=false]</td> <td style="text-align:left;">Object</td> <td style="text-align:left;">字段到模型的映射关系，当提供<code>options.model</code> 或 <code>options.instance</code>时。映射会在建立模型实例之前进行</td></tr> <tr><td style="text-align:left;">[options.fieldMap]</td> <td style="text-align:left;">Object</td> <td style="text-align:left;">当为 <code>SELECT</code>查询时，映射字段与属性名</td></tr></tbody></table> <h2 id="model类"><a href="#model类" aria-hidden="true" class="header-anchor">#</a> Model类</h2> <h3 id="表操作"><a href="#表操作" aria-hidden="true" class="header-anchor">#</a> 表操作</h3> <h3 id="模型类方法查询"><a href="#模型类方法查询" aria-hidden="true" class="header-anchor">#</a> 模型类方法查询</h3> <h4 id="查询单条数据"><a href="#查询单条数据" aria-hidden="true" class="header-anchor">#</a> 查询单条数据</h4> <ul><li>findByPk</li> <li>findOne</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 根据主键查询</span>
<span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token keyword">await</span> ArticleModel<span class="token punctuation">.</span><span class="token function">findByPk</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

<span class="token comment">// 根据条件查询单条数据</span>
<span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token keyword">await</span> ArticleModel<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  where<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    id<span class="token punctuation">:</span> <span class="token number">1</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="查询全部数据"><a href="#查询全部数据" aria-hidden="true" class="header-anchor">#</a> 查询全部数据</h4> <ul><li>findAll</li> <li>findAndCountAll</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 查询全部数据</span>
<span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token keyword">await</span> ArticleModel<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// 查询并统计数据, 返回格式 { count: 1, rows: [{...}] }</span>
<span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token keyword">await</span> ArticleModel<span class="token punctuation">.</span><span class="token function">findAndCountAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// 查询id为1的数据, 但是仍然返回一个 Array</span>
<span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token keyword">await</span> ArticleModel<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  where<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    id<span class="token punctuation">:</span> <span class="token number">1</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="使用自定义方法查询"><a href="#使用自定义方法查询" aria-hidden="true" class="header-anchor">#</a> 使用自定义方法查询</h4> <p>就用之前定义的模型 article 举例, 里面包括 createArticle 和 getArticleDetail 两个方法, 使用起来非常简单:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> ArticleModel <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;../model/article&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token keyword">await</span> ArticleModel<span class="token punctuation">.</span><span class="token function">getArticleDetail</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>以上, 将查询 article 表中 id 为 1 的一条数据</p> <h3 id="where"><a href="#where" aria-hidden="true" class="header-anchor">#</a> where</h3> <p>查询条件: 需要先引入Op</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token punctuation">{</span> Op <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;sequelize&quot;</span><span class="token punctuation">)</span>
</code></pre></div><p><strong>比较符</strong></p> <ul><li>Op.gt 大于</li> <li>Op.gte 大于等于</li> <li>Op.lt 小于</li> <li>Op.lte 小于等于</li> <li>Op.ne 不等于</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token keyword">await</span> ArticleModel<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  where<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    id<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      <span class="token punctuation">[</span>Op<span class="token punctuation">.</span>gt<span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token number">2</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p><strong>关系符</strong></p> <ul><li>Op.and 与</li> <li>Op.or 或</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>Project<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  where<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    name<span class="token punctuation">:</span> <span class="token string">'a project'</span><span class="token punctuation">,</span>
    <span class="token punctuation">[</span>Op<span class="token punctuation">.</span>or<span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span> id<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span> id<span class="token punctuation">:</span> <span class="token punctuation">{</span> <span class="token punctuation">[</span>Op<span class="token punctuation">.</span>gt<span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token number">10</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

Project<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  where<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    name<span class="token punctuation">:</span> <span class="token string">'a project'</span><span class="token punctuation">,</span>
    id<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      <span class="token punctuation">[</span>Op<span class="token punctuation">.</span>or<span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> <span class="token punctuation">[</span>Op<span class="token punctuation">.</span>gt<span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token number">10</span> <span class="token punctuation">}</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>以上两种查询均解释为:</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token operator">*</span>
<span class="token keyword">FROM</span> <span class="token punctuation">`</span>Projects<span class="token punctuation">`</span>
<span class="token keyword">WHERE</span> <span class="token punctuation">(</span>
  <span class="token punctuation">`</span>Projects<span class="token punctuation">`</span><span class="token punctuation">.</span><span class="token punctuation">`</span>name<span class="token punctuation">`</span> <span class="token operator">=</span> <span class="token string">'a project'</span>
   <span class="token operator">AND</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>Projects<span class="token punctuation">`</span><span class="token punctuation">.</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span> <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">OR</span> <span class="token punctuation">`</span>Projects<span class="token punctuation">`</span><span class="token punctuation">.</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span> <span class="token operator">&gt;</span> <span class="token number">10</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>
<span class="token keyword">LIMIT</span> <span class="token number">1</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>相似</strong></p> <ul><li>Op.between</li> <li>Op.notBetween</li></ul> <h3 id="order"><a href="#order" aria-hidden="true" class="header-anchor">#</a> order</h3> <p>排序</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token keyword">await</span> ArticleModel<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  order<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">,</span> <span class="token string">'DESC'</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="offset-和-limit"><a href="#offset-和-limit" aria-hidden="true" class="header-anchor">#</a> offset 和 limit</h3> <p>适用于分页的情况</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token keyword">await</span> ArticleModel<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  offset<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> limit<span class="token punctuation">:</span> <span class="token number">2</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="参考资料"><a href="#参考资料" aria-hidden="true" class="header-anchor">#</a> 参考资料</h2> <ul><li><a href="https://itbilu.com/nodejs/npm/VkYIaRPz-.html#api-instance-query" target="_blank" rel="noopener noreferrer">Sequelize 中文API文档－1. 快速入门、Sequelize类<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://itbilu.com/nodejs/npm/V1PExztfb.html" target="_blank" rel="noopener noreferrer">Sequelize 中文API文档－2. Model 的定义、使用与Model类的API<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://itbilu.com/nodejs/npm/41qaV3czb.html" target="_blank" rel="noopener noreferrer">Sequelize 中文API文档－3. 模型（表）之间的关系/关联<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://itbilu.com/nodejs/npm/VJIR1CjMb.html" target="_blank" rel="noopener noreferrer">Sequelize 中文API文档－4. 查询与原始查询<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://itbilu.com/nodejs/npm/N1sdaHTzb.html" target="_blank" rel="noopener noreferrer">Sequelize 中文API文档－5. 实例的使用、Instance类介绍<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div><div class="article-info"><div class="article-title">文档信息</div><p class="article-item">版权声明：著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。</p><p class="article-item">文章标题：数据库连接库 Sequelize</p><p class="article-item">原文链接：<a href="https://www.xiaoyulive.top/categories/nodejs/_pages/Sequelize.html">https://www.xiaoyulive.top/categories/nodejs/_pages/Sequelize.html</a></p><p class="article-item">发表日期：2019-05-23</p></div><!----><!----></div><div class="footers" data-v-38547c78><p data-v-38547c78><span data-v-38547c78>MIT Licensed | Copyright © 2018-present  滇ICP备16006294号</span></p><p data-v-38547c78><span data-v-38547c78>Design by <a href="/">Quanzaiyu</a> | Power by <a href="https://vuepress.vuejs.org/" target="_blank">VuePress</a> | Hosted by <a href="https://pages.coding.me" target="_blank" style="font-weight: bold">Coding Pages</a></span></p></div></div><div class="global-ui"><!----><!----></div></div>
    <script src="/assets/js/app.45415eeb.js" defer></script><script src="/assets/js/5.3d48ac25.js" defer></script><script src="/assets/js/14.35307f94.js" defer></script>
  </body>
</html>
