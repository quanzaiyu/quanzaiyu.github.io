<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Sequelize类 | 小昱个人网站</title>
    <meta name="description" content="小昱个人网站">
    <meta http-equiv="Expires" content="Mon,12 May 2050 00:20:00 GMT">
  <link rel="icon" href="/logo.png">
  <link rel="manifest" href="/manifest.json">
  <link rel="stylesheet" href="//at.alicdn.com/t/font_517060_lom78h954w.css">
  <link rel="stylesheet" href="https://img.xiaoyulive.top/css/animate.css">
    
    <link rel="preload" href="/assets/css/0.styles.b4f00dfd.css" as="style"><link rel="preload" href="/assets/js/app.b9757165.js" as="script"><link rel="preload" href="/assets/js/5.51d0abde.js" as="script"><link rel="prefetch" href="/assets/js/1.eff2f4d0.js"><link rel="prefetch" href="/assets/js/10.b6ee5adc.js"><link rel="prefetch" href="/assets/js/11.a0f7eda4.js"><link rel="prefetch" href="/assets/js/12.efd21c05.js"><link rel="prefetch" href="/assets/js/13.8bd03a91.js"><link rel="prefetch" href="/assets/js/14.62c8879e.js"><link rel="prefetch" href="/assets/js/15.eb1ac8aa.js"><link rel="prefetch" href="/assets/js/2.7201b0da.js"><link rel="prefetch" href="/assets/js/6.3e769c98.js"><link rel="prefetch" href="/assets/js/7.0ad930a0.js"><link rel="prefetch" href="/assets/js/8.658548d3.js"><link rel="prefetch" href="/assets/js/9.1a59cf9a.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.6123628a.js">
    <link rel="stylesheet" href="/assets/css/0.styles.b4f00dfd.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-38547c78><header class="navbar" data-v-38547c78><div class="navbar-content"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div><a href="/" class="home-link router-link-active"><img src="/logo.png" class="logo"><span class="site-name can-hide">小昱个人网站</span></a><div class="links"><nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link">开发者博客</a></div><div class="nav-item"><a href="/articles/" class="nav-link">生活漫谈</a></div><div class="nav-item"><a href="/note/" class="nav-link">阅读札记</a></div><div class="nav-item"><a href="/categories/" class="nav-link router-link-active">学无止境</a></div><div class="nav-item"><a href="/share/" class="nav-link">精品分享</a></div><div class="nav-item"><a href="/favorite/" class="nav-link">收藏夹</a></div><!----></nav><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""><!----></div></div></div></header><div class="sidebar-mask" data-v-38547c78></div><div class="sidebar" data-v-38547c78><div class="sidebar-container"><nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link">开发者博客</a></div><div class="nav-item"><a href="/articles/" class="nav-link">生活漫谈</a></div><div class="nav-item"><a href="/note/" class="nav-link">阅读札记</a></div><div class="nav-item"><a href="/categories/" class="nav-link router-link-active">学无止境</a></div><div class="nav-item"><a href="/share/" class="nav-link">精品分享</a></div><div class="nav-item"><a href="/favorite/" class="nav-link">收藏夹</a></div><!----></nav><ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading"><span>Sequelize</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/categories/nodejs/_books/sequelize/" class="sidebar-link">Sequelize</a></li><li><a href="/categories/nodejs/_books/sequelize/Intro.html" class="sidebar-link">简介</a></li><li><a href="/categories/nodejs/_books/sequelize/Install.html" class="sidebar-link">安装</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading open"><span>基础</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/categories/nodejs/_books/sequelize/Connection.html" class="sidebar-link">建立连接</a></li><li><a href="/categories/nodejs/_books/sequelize/Model.html" class="sidebar-link">定义模型</a></li><li><a href="/categories/nodejs/_books/sequelize/Model_Options.html" class="sidebar-link">模型选项</a></li><li><a href="/categories/nodejs/_books/sequelize/Class_Sequelize.html" class="active sidebar-link">Sequelize类</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/categories/nodejs/_books/sequelize/Class_Sequelize.html#同步模型到数据库" class="sidebar-link">同步模型到数据库</a></li><li class="sidebar-sub-header"><a href="/categories/nodejs/_books/sequelize/Class_Sequelize.html#执行原始sql查询" class="sidebar-link">执行原始SQL查询</a></li></ul></li><li><a href="/categories/nodejs/_books/sequelize/Class_Model.html" class="sidebar-link">Model类</a></li><li><a href="/categories/nodejs/_books/sequelize/Query.html" class="sidebar-link">查询条件</a></li></ul></div></li></ul></div></div><div class="page" data-v-38547c78><div class="content default"><h1 id="sequelize类"><a href="#sequelize类" aria-hidden="true" class="header-anchor">#</a> Sequelize类</h1> <h2 id="同步模型到数据库"><a href="#同步模型到数据库" aria-hidden="true" class="header-anchor">#</a> 同步模型到数据库</h2> <p>通过 <code>sequelize.sync</code> 同步所有已定义的模型到数据库中</p> <p>格式:</p> <div class="language-js extra-class"><pre class="language-js"><code>sequelize<span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">[</span>options<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> Promise
</code></pre></div><p>参数</p> <table><thead><tr><th style="text-align:left;">名称</th> <th style="text-align:left;">类型</th> <th style="text-align:left;">说明</th></tr></thead> <tbody><tr><td style="text-align:left;">[options={}]</td> <td style="text-align:left;">Object</td> <td style="text-align:left;"></td></tr> <tr><td style="text-align:left;">[options.force=false]</td> <td style="text-align:left;">Boolean</td> <td style="text-align:left;">设置为 true，会在创建表前先删除原表，即：DROP TABLE IF EXISTS ...</td></tr> <tr><td style="text-align:left;">[options.match]</td> <td style="text-align:left;">RegEx</td> <td style="text-align:left;">添加匹配规则，只重建匹配的表，在<code>force: true</code>时非常有用</td></tr> <tr><td style="text-align:left;">[options.logging=console.log]</td> <td style="text-align:left;">Boolean | function</td> <td style="text-align:left;">执行SQL的日志打印函数</td></tr> <tr><td style="text-align:left;">[options.schema='public']</td> <td style="text-align:left;">String</td> <td style="text-align:left;">创建表的 schema 。这一选项可以每个表的 <code>sequelize.define</code>中重写</td></tr> <tr><td style="text-align:left;">[options.searchPath=DEFAULT]</td> <td style="text-align:left;">String</td> <td style="text-align:left;">一个用于指定 schema 的 search_path 的可选项(仅 Postgres 适用)</td></tr> <tr><td style="text-align:left;">[options.hooks=true]</td> <td style="text-align:left;">Boolean</td> <td style="text-align:left;">设置为<code>true</code>时，会调用同步相关的钩子函数：beforeSync、afterSync、beforBulkSync、afterBulkSync</td></tr></tbody></table> <p><code>.sync({ force: true })</code> 会删除并重建表，这时我们可以添加match选项，只重建正则表达式匹配的表：</p> <div class="language-js extra-class"><pre class="language-js"><code>sequelize<span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">{</span> force<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> match<span class="token punctuation">:</span> <span class="token regex">/_test$/</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="执行原始sql查询"><a href="#执行原始sql查询" aria-hidden="true" class="header-anchor">#</a> 执行原始SQL查询</h2> <p>格式:</p> <div class="language-js extra-class"><pre class="language-js"><code>sequelize<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>sql<span class="token punctuation">,</span> <span class="token punctuation">[</span>options<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> Promise
</code></pre></div><p>执行 原始SQL 语句进行查询</p> <p>第二个可选参数中传一个type参数，并指定查询的类型。设置后，sequelize会对结果进行格式化：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> data <span class="token operator">=</span> <span class="token keyword">await</span> sequelize<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">'SELECT * from article'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  type<span class="token punctuation">:</span> sequelize<span class="token punctuation">.</span>QueryTypes<span class="token punctuation">.</span><span class="token constant">SELECT</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// 返回一个 Array</span>
</code></pre></div><table><thead><tr><th style="text-align:left;">名称</th> <th style="text-align:left;">类型</th> <th style="text-align:left;">说明</th></tr></thead> <tbody><tr><td style="text-align:left;">sql</td> <td style="text-align:left;">String</td> <td style="text-align:left;"></td></tr> <tr><td style="text-align:left;">[options={}]</td> <td style="text-align:left;">Object</td> <td style="text-align:left;">查询选项</td></tr> <tr><td style="text-align:left;">[options.raw]</td> <td style="text-align:left;">Boolean</td> <td style="text-align:left;">设置为<code>true</code>时，sequelize 不会查询结果进行格式化，或不会根据结果构建实例</td></tr> <tr><td style="text-align:left;">[options.transaction=null]</td> <td style="text-align:left;">Transaction</td> <td style="text-align:left;">为查询指定事务</td></tr> <tr><td style="text-align:left;">[options.type='RAW']</td> <td style="text-align:left;">String</td> <td style="text-align:left;">执行的查询类型，sequelize会根据这个类型对返回结果格式化。可以设置为一个字符串，或是通过<a href="https://itbilu.com/nodejs/npm/VkYIaRPz-.html#api-QueryTypes" target="_blank" rel="noopener noreferrer"><code>Sequelize.QueryTypes</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>来设置</td></tr> <tr><td style="text-align:left;">[options.nest=false]</td> <td style="text-align:left;">Boolean</td> <td style="text-align:left;">设置为<code>true</code>，会使用<a href="https://github.com/mickhansen/dottie.js" target="_blank" rel="noopener noreferrer">dottie.js<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>库，转换通过<code>.</code>设置的对象层级关系。如：<code>{ 'user.username': 'john' }</code> 会被转换为 <code>{ user: { username: 'john' }}</code>。设置<code>true</code>后，查询类型如未明确指定，则使用<code>'SELECT'</code></td></tr> <tr><td style="text-align:left;">[options.plain=false]</td> <td style="text-align:left;">Boolean</td> <td style="text-align:left;">设置查询类型为 <code>SELECT</code> 并返回单行结果</td></tr> <tr><td style="text-align:left;">[options.replacements]</td> <td style="text-align:left;">Object | Array</td> <td style="text-align:left;">替换<code>:param</code>格式的查询参数对象，或用于替换SQL中<code>?</code>符号的参数数组</td></tr> <tr><td style="text-align:left;">[options.bind]</td> <td style="text-align:left;">Object | Array</td> <td style="text-align:left;"><code>$param</code>格式绑定参数的对象，或未命令绑定参数数组，会替换SQL中的<code>$1, $2, ...</code></td></tr> <tr><td style="text-align:left;">[options.useMaster=false]</td> <td style="text-align:left;">Boolean</td> <td style="text-align:left;">强制查询使用写池，而不管查询类型</td></tr> <tr><td style="text-align:left;">[options.logging=false]</td> <td style="text-align:left;">Function</td> <td style="text-align:left;">一个用打印执行的SQL语句的函数</td></tr> <tr><td style="text-align:left;">[options.instance]</td> <td style="text-align:left;">Instance</td> <td style="text-align:left;">用于sequelize 实例，用于从查询结果中构建实例</td></tr> <tr><td style="text-align:left;">[options.model]</td> <td style="text-align:left;">Model</td> <td style="text-align:left;">用于sequelize 模型，用于从查询结果中构建实例</td></tr> <tr><td style="text-align:left;">[options.retry]</td> <td style="text-align:left;">Object</td> <td style="text-align:left;">设置自动重试的控制标识对象</td></tr> <tr><td style="text-align:left;">[options.retry.match]</td> <td style="text-align:left;">Array</td> <td style="text-align:left;">发生错误时，匹配到数组中的标识后自动重试</td></tr> <tr><td style="text-align:left;">[options.retry.max]</td> <td style="text-align:left;">Integer</td> <td style="text-align:left;">设置最大重试次数</td></tr> <tr><td style="text-align:left;">[options.searchPath=DEFAULT]</td> <td style="text-align:left;">String</td> <td style="text-align:left;">一个用于指定 schema 的 search_path 的可选项(仅 Postgres 适用)</td></tr> <tr><td style="text-align:left;">[options.supportsSearchPath]</td> <td style="text-align:left;">Boolean</td> <td style="text-align:left;">是否使用 searchPath (仅 Postgres 适用)</td></tr> <tr><td style="text-align:left;">[options.mapToModel=false]</td> <td style="text-align:left;">Object</td> <td style="text-align:left;">字段到模型的映射关系，当提供<code>options.model</code> 或 <code>options.instance</code>时。映射会在建立模型实例之前进行</td></tr> <tr><td style="text-align:left;">[options.fieldMap]</td> <td style="text-align:left;">Object</td> <td style="text-align:left;">当为 <code>SELECT</code>查询时，映射字段与属性名</td></tr></tbody></table></div><div class="article-info"><div class="article-title">文档信息</div><p class="article-item">版权声明：著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。</p><p class="article-item">文章标题：Sequelize类</p><p class="article-item">原文链接：<a href="https://www.xiaoyulive.top/categories/nodejs/_books/sequelize/Class_Sequelize.html">https://www.xiaoyulive.top/categories/nodejs/_books/sequelize/Class_Sequelize.html</a></p><!----></div><!----><div class="content page-nav"><p class="inner"><span class="prev">← <a href="/categories/nodejs/_books/sequelize/Model_Options.html">模型选项</a></span><span class="next"><a href="/categories/nodejs/_books/sequelize/Class_Model.html">Model类</a>  →</span></p></div></div><div class="footers" data-v-38547c78><p data-v-38547c78><span data-v-38547c78>MIT Licensed | Copyright © 2018-present  滇ICP备16006294号</span></p><p data-v-38547c78><span data-v-38547c78>Design by <a href="/">Quanzaiyu</a> | Power by <a href="https://vuepress.vuejs.org/" target="_blank">VuePress</a> | Hosted by <a href="https://pages.coding.me" target="_blank" style="font-weight: bold">Coding Pages</a></span></p></div></div><div class="global-ui"><!----><!----></div></div>
    <script src="/assets/js/app.b9757165.js" defer></script><script src="/assets/js/5.51d0abde.js" defer></script>
  </body>
</html>
