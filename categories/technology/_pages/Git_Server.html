<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>搭建 Git 服务器 (GitLab 和 Gogs) | 小昱个人网站</title>
    <meta name="description" content="小昱个人网站">
    <meta http-equiv="Expires" content="Mon,12 May 2050 00:20:00 GMT">
  <link rel="icon" href="/logo.png">
  <link rel="manifest" href="/manifest.json">
  <link rel="stylesheet" href="//at.alicdn.com/t/font_517060_lom78h954w.css">
  <link rel="stylesheet" href="https://img.xiaoyulive.top/css/animate.css">
    
    <link rel="preload" href="/assets/css/0.styles.24fc6e4b.css" as="style"><link rel="preload" href="/assets/js/app.3431a3f9.js" as="script"><link rel="preload" href="/assets/js/5.7bea38e3.js" as="script"><link rel="preload" href="/assets/js/14.d0f490d5.js" as="script"><link rel="prefetch" href="/assets/js/1.a3dcb58e.js"><link rel="prefetch" href="/assets/js/10.ecd1419a.js"><link rel="prefetch" href="/assets/js/11.a0f7eda4.js"><link rel="prefetch" href="/assets/js/12.a9f191c5.js"><link rel="prefetch" href="/assets/js/13.34f3591b.js"><link rel="prefetch" href="/assets/js/15.92eafcb9.js"><link rel="prefetch" href="/assets/js/2.b87d5e0b.js"><link rel="prefetch" href="/assets/js/6.fef674ae.js"><link rel="prefetch" href="/assets/js/7.420ae82d.js"><link rel="prefetch" href="/assets/js/8.ad06e931.js"><link rel="prefetch" href="/assets/js/9.63a23b63.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.3953f9da.js">
    <link rel="stylesheet" href="/assets/css/0.styles.24fc6e4b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-38547c78><header class="navbar" data-v-38547c78><div class="navbar-content"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div><a href="/" class="home-link router-link-active"><img src="/logo.png" class="logo"><span class="site-name can-hide">小昱个人网站</span></a><div class="links"><nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link">开发者博客</a></div><div class="nav-item"><a href="/articles/" class="nav-link">生活漫谈</a></div><div class="nav-item"><a href="/note/" class="nav-link">阅读札记</a></div><div class="nav-item"><a href="/categories/" class="nav-link router-link-active">学无止境</a></div><div class="nav-item"><a href="/share/" class="nav-link">精品分享</a></div><div class="nav-item"><a href="/favorite/" class="nav-link">收藏夹</a></div><!----></nav><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""><!----></div></div></div></header><div class="sidebar-mask" data-v-38547c78></div><div class="sidebar" data-v-38547c78><div class="sidebar-container"><nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link">开发者博客</a></div><div class="nav-item"><a href="/articles/" class="nav-link">生活漫谈</a></div><div class="nav-item"><a href="/note/" class="nav-link">阅读札记</a></div><div class="nav-item"><a href="/categories/" class="nav-link router-link-active">学无止境</a></div><div class="nav-item"><a href="/share/" class="nav-link">精品分享</a></div><div class="nav-item"><a href="/favorite/" class="nav-link">收藏夹</a></div><!----></nav><ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>搭建 Git 服务器 (GitLab 和 Gogs)</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/categories/technology/_pages/Git_Server.html#直接安装-git" class="sidebar-link">直接安装 Git</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/categories/technology/_pages/Git_Server.html#服务器端" class="sidebar-link">服务器端</a></li><li class="sidebar-sub-header"><a href="/categories/technology/_pages/Git_Server.html#客户端" class="sidebar-link">客户端</a></li></ul></li><li><a href="/categories/technology/_pages/Git_Server.html#搭建-gitlab-服务器" class="sidebar-link">搭建 GitLab 服务器</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/categories/technology/_pages/Git_Server.html#安装" class="sidebar-link">安装</a></li><li class="sidebar-sub-header"><a href="/categories/technology/_pages/Git_Server.html#常用命令" class="sidebar-link">常用命令</a></li><li class="sidebar-sub-header"><a href="/categories/technology/_pages/Git_Server.html#端口修改" class="sidebar-link">端口修改</a></li><li class="sidebar-sub-header"><a href="/categories/technology/_pages/Git_Server.html#登录" class="sidebar-link">登录</a></li></ul></li><li><a href="/categories/technology/_pages/Git_Server.html#搭建-gogs-服务器" class="sidebar-link">搭建 Gogs 服务器</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/categories/technology/_pages/Git_Server.html#安装-mysql" class="sidebar-link">安装 mysql</a></li><li class="sidebar-sub-header"><a href="/categories/technology/_pages/Git_Server.html#安装-gogs" class="sidebar-link">安装 gogs</a></li></ul></li><li><a href="/categories/technology/_pages/Git_Server.html#参考资料" class="sidebar-link">参考资料</a><ul class="sidebar-sub-headers"></ul></li></ul></div></li></ul></div></div><div class="page" data-v-38547c78><div class="content default"><h1 id="搭建-git-服务器-gitlab-和-gogs"><a href="#搭建-git-服务器-gitlab-和-gogs" aria-hidden="true" class="header-anchor">#</a> 搭建 Git 服务器 (GitLab 和 Gogs)</h1> <h2 id="直接安装-git"><a href="#直接安装-git" aria-hidden="true" class="header-anchor">#</a> 直接安装 Git</h2> <h3 id="服务器端"><a href="#服务器端" aria-hidden="true" class="header-anchor">#</a> 服务器端</h3> <div class="language-bash extra-class"><pre class="language-bash"><code>$ yum –y <span class="token function">install</span> <span class="token function">git</span> <span class="token comment"># 安装 git</span>
$ <span class="token function">useradd</span> <span class="token function">git</span> <span class="token operator">&amp;&amp;</span> <span class="token function">passwd</span> <span class="token function">git</span> <span class="token comment"># 创建一个 git 用户并赋予密码</span>
$ <span class="token function">cd</span> /home/git <span class="token operator">&amp;&amp;</span> <span class="token function">mkdir</span> git-server <span class="token operator">&amp;&amp;</span> <span class="token function">cd</span> git-server <span class="token comment"># 创建仓库路径</span>
$ <span class="token function">git</span> init --bare learngit.git <span class="token comment"># 创建一个裸仓库</span>
$ <span class="token function">chown</span> -R git:git learngit.git <span class="token comment"># 赋予 git 用户权限</span>
$ <span class="token function">vim</span> /etc/passwd <span class="token comment"># 禁用 git 用户 shell 登录（一定要禁用）</span>

<span class="token comment"># 将</span>
git:x:1001:1001:,,,:/home/git:/bin/bash
<span class="token comment"># 改为</span>
git:x:1000:1000:,,,:/home/git:/usr/bin/git-shell
</code></pre></div><p>至此, 服务端配置完成。</p> <h3 id="客户端"><a href="#客户端" aria-hidden="true" class="header-anchor">#</a> 客户端</h3> <p>使用 clone 命令克隆仓库，格式如下</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">git</span> clone git@172.23.29.183:/home/git/git-server/learngit.git
</code></pre></div><p>可以将客户端公钥保存到服务器，以便下次操作不需输入密码。</p> <h2 id="搭建-gitlab-服务器"><a href="#搭建-gitlab-服务器" aria-hidden="true" class="header-anchor">#</a> 搭建 GitLab 服务器</h2> <p>GitLab是利用 Ruby on Rails 一个开源的版本管理系统，实现一个自托管的Git项目仓库，可通过Web界面进行访问公开的或者私人项目。它拥有与Github类似的功能，能够浏览源代码，管理缺陷和注释。可以管理团队对仓库的访问，它非常易于浏览提交过的版本并提供一个文件历史库。团队成员可以利用内置的简单聊天程序(Wall)进行交流。它还提供一个代码片段收集功能可以轻松实现代码复用，便于日后有需要的时候进行查找。</p> <h3 id="安装"><a href="#安装" aria-hidden="true" class="header-anchor">#</a> 安装</h3> <p><strong>apt-get方式</strong></p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">curl</span> -s https://packages.gitlab.com/install/repositories/gitlab/gitlab-ce/script.deb.sh <span class="token operator">|</span> <span class="token function">sudo</span> <span class="token function">bash</span>
$ <span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> gitlab-ce
$ <span class="token function">sudo</span> gitlab-ctl reconfigure
</code></pre></div><div class="imgLink" data-v-16222526><img src="https://img.xiaoyulive.top/img/articles/017.jpg" data-v-16222526></div> <p><strong>deb包方式</strong></p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">wget</span> https://packages.gitlab.com/gitlab/gitlab-ce/Ubuntu/pool/trusty/main/g/gitlab-ce/gitlab-ce_8.3.4-ce.0_amd64.deb
$ dpkg -i gitlab-ce_8.3.4-ce.0_amd64.deb
$ <span class="token function">sudo</span> gitlab-ctl reconfigure
</code></pre></div><div class="imgLink" data-v-16222526><img src="https://img.xiaoyulive.top/img/articles/018.jpg" data-v-16222526></div> <h3 id="常用命令"><a href="#常用命令" aria-hidden="true" class="header-anchor">#</a> 常用命令</h3> <p>gitlab 常用命令</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ gitlab-ctl start
$ gitlab-ctl stop
$ gitlab-ctl status
$ gitlab-ctl restart
</code></pre></div><p>重新应用配置</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ gitlab-ctl reconfigure
</code></pre></div><p>Gitlab 默认的日志文件存放在 <code>/var/log/gitlab</code> 目录下:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ gitlab-ctl <span class="token function">tail</span> <span class="token comment"># 查看所有日志</span>
$ gitlab-ctl <span class="token function">tail</span> nginx/gitlab_access.log <span class="token comment"># 查看nginx访问日志</span>
</code></pre></div><h3 id="端口修改"><a href="#端口修改" aria-hidden="true" class="header-anchor">#</a> 端口修改</h3> <p>配置文件位于 <code>/var/opt/gitlab/nginx/conf/gitlab-http.conf</code></p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">vim</span> /var/opt/gitlab/nginx/conf/gitlab-http.conf

upstream gitlab-workhorse <span class="token punctuation">{</span>
  server unix:/var/opt/gitlab/gitlab-workhorse/socket<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

server <span class="token punctuation">{</span>
  listen *:8090<span class="token punctuation">;</span> <span class="token comment"># 修改端口</span>

  server_name localhost<span class="token punctuation">;</span>
  server_tokens off<span class="token punctuation">;</span> <span class="token comment"># Don't show the nginx version number, a security best practice</span>

  <span class="token punctuation">..</span>.
</code></pre></div><p>将默认的 80 端口修改为自定义端口即可</p> <p>如果访问时出现 502 错误，则需要修改 unicorn 端口</p> <div class="imgLink" data-v-16222526><img src="https://img.xiaoyulive.top/img/articles/019.jpg" data-v-16222526></div> <p>配置文件位于 <code>/etc/gitlab/gitlab.rb</code></p> <div class="language- extra-class"><pre class="language-text"><code>unicorn['listen'] = '127.0.0.1'
unicorn['port'] = 8091
</code></pre></div><p>将默认的 8080 端口改为自定义端口即可</p> <p>重启服务 <code>gitlab-ctl restart</code></p> <p>此时，访问正常</p> <div class="imgLink" data-v-16222526><img src="https://img.xiaoyulive.top/img/articles/020.jpg" data-v-16222526></div> <h3 id="登录"><a href="#登录" aria-hidden="true" class="header-anchor">#</a> 登录</h3> <p>首次访问，会提示设置密码，默认用户名为 root，设置后即可正常登录</p> <div class="imgLink" data-v-16222526><img src="https://img.xiaoyulive.top/img/articles/021.jpg" data-v-16222526></div> <h2 id="搭建-gogs-服务器"><a href="#搭建-gogs-服务器" aria-hidden="true" class="header-anchor">#</a> 搭建 Gogs 服务器</h2> <p>Gogs 是一款极易搭建的自助 Git 服务。</p> <p>Gogs 的目标是打造一个最简单、最快速和最轻松的方式搭建自助 Git 服务。使用 Go 语言开发使得 Gogs 能够通过独立的二进制分发，并且支持 Go 语言支持的 所有平台，包括 Linux、Mac OS X、Windows 以及 ARM 平台。</p> <p>本文讲述的是通过 docker 安装 gogs 环境。</p> <h3 id="安装-mysql"><a href="#安装-mysql" aria-hidden="true" class="header-anchor">#</a> 安装 mysql</h3> <div class="language-bash extra-class"><pre class="language-bash"><code>$ docker pull mysql
$ docker run -d -p 13306:3306  --name<span class="token operator">=</span>mysql -v /opt/mydata/:/var/lib/mysql -e MYSQL_ROOT_PASSWORD<span class="token operator">=</span>123456 mysql:latest
$ firewall-cmd --add-port<span class="token operator">=</span>13306/tcp
</code></pre></div><p>上面的命令, 通过 docker 拉取了 mysql 镜像, 并开启了宿主机的 13306, 将容器的的 3306 端口映射到宿主机的 13306, 然后将 13306 端口放行, 以便管理。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ docker <span class="token function">exec</span> -it mysql /bin/bash

<span class="token comment"># 此时进入容器</span>
root@c2e0d973b6ad:/<span class="token comment"># mysql --version</span>
mysql  Ver 8.0.13 <span class="token keyword">for</span> Linux on x86_64 <span class="token punctuation">(</span>MySQL Community Server - GPL<span class="token punctuation">)</span>
root@c2e0d973b6ad:/<span class="token comment"># mysql -uroot -p123456</span>
mysql: <span class="token punctuation">[</span>Warning<span class="token punctuation">]</span> Using a password on the <span class="token function">command</span> line interface can be insecure.
Welcome to the MySQL monitor.  Commands end with <span class="token punctuation">;</span> or \g.
Your MySQL connection <span class="token function">id</span> is 3768
Server version: 8.0.13 MySQL Community Server - GPL

Copyright <span class="token punctuation">(</span>c<span class="token punctuation">)</span> 2000, 2018, Oracle and/or its affiliates. All rights reserved.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Type <span class="token string">'help;'</span> or <span class="token string">'\h'</span> <span class="token keyword">for</span> help. Type <span class="token string">'\c'</span> to <span class="token function">clear</span> the current input statement.

mysql<span class="token operator">&gt;</span>
</code></pre></div><p>以上命令, 进入容器进行操作, 再进入 mysql 的命令行执行环境。</p> <p>创建一个叫 gogs 的数据库, 用于存放相关数据。</p> <div class="language- extra-class"><pre class="language-text"><code>mysql&gt; create database gogs;
Query OK, 1 row affected (0.03 sec)
mysql&gt; show databases;
+--------------------+
| Database           |
+--------------------+
| gogs               |
| information_schema |
| mysql              |
| performance_schema |
| sys                |
+--------------------+
6 rows in set (0.00 sec)
</code></pre></div><p>ok, 准备工作完毕, 准备安装 gogs 环境。</p> <h3 id="安装-gogs"><a href="#安装-gogs" aria-hidden="true" class="header-anchor">#</a> 安装 gogs</h3> <div class="language-bash extra-class"><pre class="language-bash"><code>$ docker pull gogs/gogs
$ docker run --name<span class="token operator">=</span>gogs -p 10022:22 -p 10080:3000 -v /var/gogs:/data gogs/gogs
$ firewall-cmd --add-port<span class="token operator">=</span>10080/tcp
</code></pre></div><p>同样地, 拉取 gogs 镜像, 运行容器, 并开启防火墙指定端口。</p> <p>此时, 就可愉快地用浏览器打开页面了:</p> <div class="imgLink" data-v-16222526><img src="https://img.xiaoyulive.top/img/date/20181128/010_gogs.png" data-v-16222526></div> <p>这里注意几处, mysql 地址填写 mysql 容器开启的端口, 用户名为 root, 密码为填写的 MYSQL_ROOT_PASSWORD, IP 填写宿主机的 IP, SSH 可以置空, 毕竟自己用嘛, 如果要填就填 10022, 这样得从防火墙里面将此端口放行。</p> <h2 id="参考资料"><a href="#参考资料" aria-hidden="true" class="header-anchor">#</a> 参考资料</h2> <p>Gitlab</p> <ul><li><a href="https://www.cnblogs.com/laobaozi/p/6638334.html" target="_blank" rel="noopener noreferrer">Linux系统下安装Gitlab<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://www.linuxidc.com/Linux/2016-07/133044.htm" target="_blank" rel="noopener noreferrer">Linux下GitLab安装部署笔记<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://blog.csdn.net/arybd/article/details/54635295" target="_blank" rel="noopener noreferrer">gitlab修改默认端口<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="https://blog.csdn.net/wizard_rp/article/details/73147129" target="_blank" rel="noopener noreferrer">更改gitlab默认端口<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <p>Gogs</p> <ul><li><a href="https://blog.csdn.net/meibo69631310/article/details/79767810" target="_blank" rel="noopener noreferrer">docker安装gogs - CSDN<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div><div class="article-info"><div class="article-title">文档信息</div><p class="article-item">版权声明：著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。</p><p class="article-item">文章标题：搭建 Git 服务器 (GitLab 和 Gogs)</p><p class="article-item">原文链接：<a href="https://www.xiaoyulive.top/categories/technology/_pages/Git_Server.html">https://www.xiaoyulive.top/categories/technology/_pages/Git_Server.html</a></p><p class="article-item">发表日期：2018-10-06</p></div><!----><!----></div><div class="footers" data-v-38547c78><p data-v-38547c78><span data-v-38547c78>MIT Licensed | Copyright © 2018-present  滇ICP备16006294号</span></p><p data-v-38547c78><span data-v-38547c78>Design by <a href="/">Quanzaiyu</a> | Power by <a href="https://vuepress.vuejs.org/" target="_blank">VuePress</a> | Hosted by <a href="https://pages.coding.me" target="_blank" style="font-weight: bold">Coding Pages</a></span></p></div></div><div class="global-ui"><!----><!----></div></div>
    <script src="/assets/js/app.3431a3f9.js" defer></script><script src="/assets/js/5.7bea38e3.js" defer></script><script src="/assets/js/14.d0f490d5.js" defer></script>
  </body>
</html>
