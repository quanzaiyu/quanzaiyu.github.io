<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>IO操作 | 小昱个人网站</title>
    <meta name="description" content="小昱个人网站">
    <meta http-equiv="Expires" content="Mon,12 May 2050 00:20:00 GMT">
  <meta name="keywords" content="小昱,个人网站,Vue,JavaScript,HTML,CSS">
  <link rel="icon" href="/logo.png">
  <link rel="manifest" href="/manifest.json">
  <link rel="stylesheet" href="//at.alicdn.com/t/font_517060_lom78h954w.css">
  <link rel="stylesheet" href="https://img.xiaoyulive.top/css/animate.css">
    
    <link rel="preload" href="/assets/css/0.styles.e2d81a46.css" as="style"><link rel="preload" href="/assets/js/app.795b447f.js" as="script"><link rel="preload" href="/assets/js/5.02c6f39a.js" as="script"><link rel="prefetch" href="/assets/js/1.afaaabe7.js"><link rel="prefetch" href="/assets/js/10.aa82e34b.js"><link rel="prefetch" href="/assets/js/11.8ecfdfba.js"><link rel="prefetch" href="/assets/js/12.e029831b.js"><link rel="prefetch" href="/assets/js/13.63420ebd.js"><link rel="prefetch" href="/assets/js/14.06787ef0.js"><link rel="prefetch" href="/assets/js/15.77a51247.js"><link rel="prefetch" href="/assets/js/2.09c78e88.js"><link rel="prefetch" href="/assets/js/6.48d6b923.js"><link rel="prefetch" href="/assets/js/7.341d3c18.js"><link rel="prefetch" href="/assets/js/8.3dd7f6da.js"><link rel="prefetch" href="/assets/js/9.35682099.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.333a44c7.js">
    <link rel="stylesheet" href="/assets/css/0.styles.e2d81a46.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-38547c78><header class="navbar" data-v-38547c78><div class="navbar-content"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div><a href="/" class="home-link router-link-active"><img src="/logo.png" class="logo"><span class="site-name can-hide">小昱个人网站</span></a><div class="links"><nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link">开发者博客</a></div><div class="nav-item"><a href="/articles/" class="nav-link">生活漫谈</a></div><div class="nav-item"><a href="/note/" class="nav-link">阅读札记</a></div><div class="nav-item"><a href="/categories/" class="nav-link router-link-active">学无止境</a></div><div class="nav-item"><a href="/share/" class="nav-link">精品分享</a></div><div class="nav-item"><a href="/favorite/" class="nav-link">收藏夹</a></div><!----></nav><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""><!----></div></div></div></header><div class="sidebar-mask" data-v-38547c78></div><div class="sidebar" data-v-38547c78><div class="sidebar-container"><nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link">开发者博客</a></div><div class="nav-item"><a href="/articles/" class="nav-link">生活漫谈</a></div><div class="nav-item"><a href="/note/" class="nav-link">阅读札记</a></div><div class="nav-item"><a href="/categories/" class="nav-link router-link-active">学无止境</a></div><div class="nav-item"><a href="/share/" class="nav-link">精品分享</a></div><div class="nav-item"><a href="/favorite/" class="nav-link">收藏夹</a></div><!----></nav><ul class="sidebar-links"><li><div class="sidebar-group first collapsable"><p class="sidebar-heading"><span>Python3 学习指南</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>基础</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>数据类型</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>函数</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>进阶</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>面向对象</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading open"><span>模块</span> <span class="arrow down"></span></p> <ul class="sidebar-group-items"><li><a href="/categories/python/_books/python/module/" class="sidebar-link">模块</a></li><li><a href="/categories/python/_books/python/module/Package.html" class="sidebar-link">包</a></li><li><a href="/categories/python/_books/python/module/System.html" class="sidebar-link">系统相关</a></li><li><a href="/categories/python/_books/python/module/Time.html" class="sidebar-link">时间相关</a></li><li><a href="/categories/python/_books/python/module/Regex.html" class="sidebar-link">正则表达式</a></li><li><a href="/categories/python/_books/python/module/IO.html" class="active sidebar-link">IO操作</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/categories/python/_books/python/module/IO.html#文件操作" class="sidebar-link">文件操作</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/categories/python/_books/python/module/IO.html#读文件" class="sidebar-link">读文件</a></li><li class="sidebar-sub-header"><a href="/categories/python/_books/python/module/IO.html#写文件" class="sidebar-link">写文件</a></li><li class="sidebar-sub-header"><a href="/categories/python/_books/python/module/IO.html#读写模式" class="sidebar-link">读写模式</a></li><li class="sidebar-sub-header"><a href="/categories/python/_books/python/module/IO.html#filenotfounderror" class="sidebar-link">FileNotFoundError</a></li><li class="sidebar-sub-header"><a href="/categories/python/_books/python/module/IO.html#with-as" class="sidebar-link">with...as</a></li><li class="sidebar-sub-header"><a href="/categories/python/_books/python/module/IO.html#file-like-object" class="sidebar-link">file-like Object</a></li><li class="sidebar-sub-header"><a href="/categories/python/_books/python/module/IO.html#二进制文件" class="sidebar-link">二进制文件</a></li><li class="sidebar-sub-header"><a href="/categories/python/_books/python/module/IO.html#编码" class="sidebar-link">编码</a></li></ul></li><li class="sidebar-sub-header"><a href="/categories/python/_books/python/module/IO.html#json" class="sidebar-link">JSON</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/categories/python/_books/python/module/IO.html#序列化" class="sidebar-link">序列化</a></li><li class="sidebar-sub-header"><a href="/categories/python/_books/python/module/IO.html#保存到文件" class="sidebar-link">保存到文件</a></li><li class="sidebar-sub-header"><a href="/categories/python/_books/python/module/IO.html#将一个对象转化为json" class="sidebar-link">将一个对象转化为json</a></li><li class="sidebar-sub-header"><a href="/categories/python/_books/python/module/IO.html#反序列化" class="sidebar-link">反序列化</a></li><li class="sidebar-sub-header"><a href="/categories/python/_books/python/module/IO.html#读取json文件" class="sidebar-link">读取json文件</a></li></ul></li><li class="sidebar-sub-header"><a href="/categories/python/_books/python/module/IO.html#内存操作" class="sidebar-link">内存操作</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/categories/python/_books/python/module/IO.html#stringio" class="sidebar-link">StringIO</a></li><li class="sidebar-sub-header"><a href="/categories/python/_books/python/module/IO.html#bytesio" class="sidebar-link">BytesIO</a></li></ul></li><li class="sidebar-sub-header"><a href="/categories/python/_books/python/module/IO.html#pickle-序列化" class="sidebar-link">pickle 序列化</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/categories/python/_books/python/module/IO.html#序列化-2" class="sidebar-link">序列化</a></li><li class="sidebar-sub-header"><a href="/categories/python/_books/python/module/IO.html#存入文件" class="sidebar-link">存入文件</a></li><li class="sidebar-sub-header"><a href="/categories/python/_books/python/module/IO.html#反序列化-2" class="sidebar-link">反序列化</a></li></ul></li></ul></li><li><a href="/categories/python/_books/python/module/Socket.html" class="sidebar-link">网络套接字</a></li><li><a href="/categories/python/_books/python/module/MySQL.html" class="sidebar-link">数据库操作之MySQL</a></li><li><a href="/categories/python/_books/python/module/Other.html" class="sidebar-link">其他</a></li></ul></div></li></ul></div></div><div class="page" data-v-38547c78><div class="content__default"><h1 id="io操作"><a href="#io操作" aria-hidden="true" class="header-anchor">#</a> IO操作</h1> <h2 id="文件操作"><a href="#文件操作" aria-hidden="true" class="header-anchor">#</a> 文件操作</h2> <h3 id="读文件"><a href="#读文件" aria-hidden="true" class="header-anchor">#</a> 读文件</h3> <div class="language-python extra-class"><pre class="language-python"><code>f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'./info.log'</span><span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">)</span> <span class="token comment"># 以只读的方式打开一个文件</span>
t <span class="token operator">=</span> f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 读取文件内容，保存到一个str对象</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span> <span class="token comment"># 如果文件打开成功，将打印文件内容</span>
f<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 关闭文件</span>
</code></pre></div><ul><li><code>open()</code> 传入文件名和标示符，可以打开一个文件对象。</li> <li><code>read()</code> 可以一次读取文件的全部内容，Python把内容读到内存，用一个<code>str</code>对象表示。</li> <li><code>close()</code> 关闭文件，文件使用完毕后必须关闭，因为文件对象会占用操作系统的资源，并且操作系统同一时间能打开的文件数量也是有限的。</li></ul> <h3 id="写文件"><a href="#写文件" aria-hidden="true" class="header-anchor">#</a> 写文件</h3> <p>写文件和读文件是一样的，唯一区别是调用<code>open()</code>函数时，传入标识符<code>'w'</code>或者<code>'wb'</code>表示写文本文件或写二进制文件：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'./info.log'</span><span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    f<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">)</span>
</code></pre></div><p>你可以反复调用<code>write()</code>来写入文件，但是务必要调用<code>f.close()</code>来关闭文件。当我们写文件时，操作系统往往不会立刻把数据写入磁盘，而是放到内存缓存起来，空闲的时候再慢慢写入。只有调用<code>close()</code>方法时，操作系统才保证把没有写入的数据全部写入磁盘。忘记调用<code>close()</code>的后果是数据可能只写了一部分到磁盘，剩下的丢失了。所以，还是用<code>with</code>语句来得保险。</p> <p>要写入特定编码的文本文件，请给<code>open()</code>函数传入<code>encoding</code>参数，将字符串自动转换成指定编码。</p> <h3 id="读写模式"><a href="#读写模式" aria-hidden="true" class="header-anchor">#</a> 读写模式</h3> <p>读写模式的类型有：</p> <div class="language- extra-class"><pre class="language-text"><code>rU或Ua 以读方式打开, 同时提供通用换行符支持 (PEP 278)
w      以写方式打开，
a      以追加模式打开 (从 EOF 开始, 必要时创建新文件)
r+     以读写模式打开
w+     以读写模式打开 (参见 w )
a+     以读写模式打开 (参见 a )
rb     以二进制读模式打开
wb     以二进制写模式打开 (参见 w )
ab     以二进制追加模式打开 (参见 a )
rb+    以二进制读写模式打开 (参见 r+ )
wb+    以二进制读写模式打开 (参见 w+ )
ab+    以二进制读写模式打开 (参见 a+ )
</code></pre></div><h3 id="filenotfounderror"><a href="#filenotfounderror" aria-hidden="true" class="header-anchor">#</a> FileNotFoundError</h3> <p>如果文件不存在，将抛出以下错误信息:</p> <div class="language-python extra-class"><pre class="language-python"><code>FileNotFoundError<span class="token punctuation">:</span> <span class="token punctuation">[</span>Errno <span class="token number">2</span><span class="token punctuation">]</span> No such <span class="token builtin">file</span> <span class="token keyword">or</span> directory<span class="token punctuation">:</span> <span class="token string">'/Users/info.log'</span>
</code></pre></div><p>由于文件读写时都有可能产生<code>IOError</code>，一旦出错，后面的<code>f.close()</code>就不会调用。所以，为了保证无论是否出错都能正确地关闭文件，我们可以使用<code>try ... finally</code>来实现：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">try</span><span class="token punctuation">:</span>
    f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'./info.log'</span><span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">finally</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> f<span class="token punctuation">:</span>
        f<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="with-as"><a href="#with-as" aria-hidden="true" class="header-anchor">#</a> with...as</h3> <p>但是如果每次都这么写实在太繁琐，所以，Python引入了<code>with</code>语句来自动帮我们调用<code>close()</code>方法：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'./info.log'</span><span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p>这和前面的<code>try ... finally</code>是一样的，但是代码更佳简洁，并且不必调用<code>f.close()</code>方法。</p> <p>调用<code>read()</code>会一次性读取文件的全部内容，如果文件有10G，内存就爆了，所以，要保险起见，可以反复调用<code>read(size)</code>方法，每次最多读取size个字节的内容。另外，调用<code>readline()</code>可以每次读取一行内容，调用<code>readlines()</code>一次读取所有内容并按行返回<code>list</code>。因此，要根据需要决定怎么调用。</p> <p>如果文件很小，<code>read()</code>一次性读取最方便；如果不能确定文件大小，反复调用<code>read(size)</code>比较保险；如果是配置文件，调用<code>readlines()</code>最方便：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">for</span> line <span class="token keyword">in</span> f<span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>line<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># 把末尾的'\n'删掉</span>
</code></pre></div><ul><li><code>read(size)</code> 方法，不带<code>size</code>读取整个文件内容，带<code>size</code>读取指定字节的内容。</li> <li><code>readlines()</code> 方法，一次性读取文件所有内容并按照行号返回为<code>list</code>。</li></ul> <h3 id="file-like-object"><a href="#file-like-object" aria-hidden="true" class="header-anchor">#</a> file-like Object</h3> <p>像<code>open()</code>函数返回的这种有个<code>read()</code>方法的对象，在Python中统称为file-like Object。除了file外，还可以是内存的字节流，网络流，自定义流等等。file-like Object不要求从特定类继承，只要写个<code>read()</code>方法就行。</p> <ul><li><code>StringIO</code>就是在内存中创建的file-like Object，常用作临时缓冲。</li></ul> <h3 id="二进制文件"><a href="#二进制文件" aria-hidden="true" class="header-anchor">#</a> 二进制文件</h3> <p>前面默认都是读取文本文件，并且是UTF-8编码的文本文件。要读取二进制文件，比如图片、视频等等，用<code>'rb'</code>模式打开文件即可：</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'./100.jpg'</span><span class="token punctuation">,</span> <span class="token string">'rb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p>其中<code>b</code>表示以二进制文件形式打开，将输出类似以下的十六进制表示的字节内容:</p> <div class="language- extra-class"><pre class="language-text"><code>b'\xff\xd8\xff\xe0\x00\x10JFIF\x00\x01\x01\x01\x00`\x00`\x00\x00\xff\xe1\x00\x08Exif\x00\x00\xff\xdb\x00C\x00\x08\x06\x06\x07\x06\x05\x08\x07\x07\x07\t\t\x08\n\x0c\x14\r\x0c\x0b\x0b\x0c\x19\x12\x13\x0f\x14\x1d\x1a\x1f\x1e\x1d\x1a\x1c\x1c $.\' &quot;,#\x1c\x1c(7),
</code></pre></div><h3 id="编码"><a href="#编码" aria-hidden="true" class="header-anchor">#</a> 编码</h3> <p>只需要在第三个参数加上<code>encoding='xxx'</code> 即可</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'./info.log'</span><span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'gbk'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p>遇到有些编码不规范的文件，你可能会遇到<code>UnicodeDecodeError</code>，因为在文本文件中可能夹杂了一些非法编码的字符。遇到这种情况，<code>open()</code>函数还接收一个<code>errors</code>参数，表示如果遇到编码错误后如何处理。最简单的方式是直接忽略：</p> <div class="language-python extra-class"><pre class="language-python"><code>f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'/Users/michael/gbk.txt'</span><span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'gbk'</span><span class="token punctuation">,</span> errors<span class="token operator">=</span><span class="token string">'ignore'</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="json"><a href="#json" aria-hidden="true" class="header-anchor">#</a> JSON</h2> <p>JSON表示的对象就是标准的JavaScript语言的对象，JSON和Python内置的数据类型对应如下：</p> <table><thead><tr><th>示例</th> <th>Python类型</th> <th>JSON类型</th></tr></thead> <tbody><tr><td>{}</td> <td>dict</td> <td>object</td></tr> <tr><td>[]</td> <td>list</td> <td>array</td></tr> <tr><td>()</td> <td>tuple</td> <td>array</td></tr> <tr><td>&quot;string&quot;</td> <td>str</td> <td>string</td></tr> <tr><td>1234.56</td> <td>int或float</td> <td>number</td></tr> <tr><td>true/false</td> <td>True/False</td> <td>true/false</td></tr> <tr><td>null</td> <td>None</td> <td>null</td></tr></tbody></table> <p>Python对json进行操作可以使用<code>json</code>模块</p> <h3 id="序列化"><a href="#序列化" aria-hidden="true" class="header-anchor">#</a> 序列化</h3> <p><code>json.dumps()</code>方法返回一个<code>str</code>，内容就是标准的JSON。</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">import</span> json
d <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'Bob'</span><span class="token punctuation">,</span> age<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">,</span> score<span class="token operator">=</span><span class="token number">88</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span> <span class="token comment"># {'name': 'Bob', 'age': 20, 'score': 88}</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">repr</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># {'name': 'Bob', 'age': 20, 'score': 88}</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># {&quot;name&quot;: &quot;Bob&quot;, &quot;age&quot;: 20, &quot;score&quot;: 88}</span>
</code></pre></div><h3 id="保存到文件"><a href="#保存到文件" aria-hidden="true" class="header-anchor">#</a> 保存到文件</h3> <p><code>json.dump()</code>方法可以直接把JSON写入一个<code>file-like Object</code>。</p> <div class="language-python extra-class"><pre class="language-python"><code>f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'./test.txt'</span><span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span>
json<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>d<span class="token punctuation">,</span> f<span class="token punctuation">)</span>
f<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="将一个对象转化为json"><a href="#将一个对象转化为json" aria-hidden="true" class="header-anchor">#</a> 将一个对象转化为json</h3> <p>可选参数<code>default</code>就是把任意一个对象变成一个可序列为JSON的对象</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">import</span> json
<span class="token keyword">class</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token builtin">object</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> name<span class="token punctuation">,</span> age<span class="token punctuation">,</span> score<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>name <span class="token operator">=</span> name
        self<span class="token punctuation">.</span>age <span class="token operator">=</span> age
        self<span class="token punctuation">.</span>score <span class="token operator">=</span> score

s <span class="token operator">=</span> Student<span class="token punctuation">(</span><span class="token string">'Bob'</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">88</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>s<span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token keyword">lambda</span> obj<span class="token punctuation">:</span> obj<span class="token punctuation">.</span>__dict__<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p>通常<code>class</code>的实例都有一个<code>__dict__</code>属性，它就是一个<code>dict</code>，用来存储实例变量。也有少数例外，比如定义了<code>__slots__</code>的class。</p> <h3 id="反序列化"><a href="#反序列化" aria-hidden="true" class="header-anchor">#</a> 反序列化</h3> <p><code>json.loads()</code>方法返回一个<code>dict</code>，将JSON转化为字典。</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">import</span> json

d <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'Bob'</span><span class="token punctuation">,</span> age<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">,</span> score<span class="token operator">=</span><span class="token number">88</span><span class="token punctuation">)</span>
json_str <span class="token operator">=</span> json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>d<span class="token punctuation">)</span>
data <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>json_str<span class="token punctuation">)</span>

<span class="token keyword">print</span> <span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token comment"># {'name': 'Bob', 'age': 20, 'score': 88}</span>
<span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">&quot;data2['name']: &quot;</span><span class="token punctuation">,</span> data<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment"># data2['name']:  Bob</span>
</code></pre></div><h3 id="读取json文件"><a href="#读取json文件" aria-hidden="true" class="header-anchor">#</a> 读取json文件</h3> <p><code>json.loads()</code>方法可以直接把JSON文件读出，输出dict。</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">import</span> json

<span class="token comment"># 读取数据并反序列化</span>
<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'data.json'</span><span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    data <span class="token operator">=</span> json<span class="token punctuation">.</span>load<span class="token punctuation">(</span>f<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token comment"># {'name': 'Bob', 'age': 20, 'score': 88}</span>
</code></pre></div><p>data.json</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span><span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Bob&quot;</span><span class="token punctuation">,</span> <span class="token property">&quot;age&quot;</span><span class="token operator">:</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token property">&quot;score&quot;</span><span class="token operator">:</span> <span class="token number">88</span><span class="token punctuation">}</span>
</code></pre></div><p>如果读入一个普通文本文件，也能正常解析出一个str</p> <p>如果读入一个二进制文件，会报错</p> <div class="danger custom-block"><p class="custom-block-title">UnicodeDecodeError</p> <p>'gbk' codec can't decode byte 0x80 in position 0: illegal multibyte sequence</p></div> <h2 id="内存操作"><a href="#内存操作" aria-hidden="true" class="header-anchor">#</a> 内存操作</h2> <p>StringIO和BytesIO是在内存中操作str和bytes的方法，使得和读写文件具有一致的接口。</p> <h3 id="stringio"><a href="#stringio" aria-hidden="true" class="header-anchor">#</a> StringIO</h3> <p>StringIO就是在内存中读写str。</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> io <span class="token keyword">import</span> StringIO
f <span class="token operator">=</span> StringIO<span class="token punctuation">(</span><span class="token punctuation">)</span>
f<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">)</span>
f<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span>
f<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">'world!'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token punctuation">.</span>getvalue<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># hello world!</span>
</code></pre></div><p><code>getvalue()</code>方法用于获得写入后的str。</p> <p>创建的时候初始化StringIO，然后可以像文件一样进行操作 :</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> io <span class="token keyword">import</span> StringIO
f <span class="token operator">=</span> StringIO<span class="token punctuation">(</span><span class="token string">'Hello!\nHi!\nGoodbye!'</span><span class="token punctuation">)</span>
<span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
    s <span class="token operator">=</span> f<span class="token punctuation">.</span>readline<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> s <span class="token operator">==</span> <span class="token string">''</span><span class="token punctuation">:</span>
        <span class="token keyword">break</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="bytesio"><a href="#bytesio" aria-hidden="true" class="header-anchor">#</a> BytesIO</h3> <p>BytesIO就是在内存中读写二进制数据。</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> io <span class="token keyword">import</span> BytesIO
f <span class="token operator">=</span> BytesIO<span class="token punctuation">(</span><span class="token punctuation">)</span>
f<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">'中文'</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token punctuation">.</span>getvalue<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p>输出: <code>b'\xe4\xb8\xad\xe6\x96\x87'</code></p> <h2 id="pickle-序列化"><a href="#pickle-序列化" aria-hidden="true" class="header-anchor">#</a> pickle 序列化</h2> <p>我们把变量从内存中变成可存储或传输的过程称之为序列化，在Python中叫pickling，在其他语言中也被称之为serialization，marshalling，flattening等等，都是一个意思。</p> <p>序列化之后，就可以把序列化后的内容写入磁盘，或者通过网络传输到别的机器上。</p> <p>反过来，把变量内容从序列化的对象重新读到内存里称之为反序列化，即unpickling。</p> <h3 id="序列化-2"><a href="#序列化-2" aria-hidden="true" class="header-anchor">#</a> 序列化</h3> <p><code>pickle.dumps()</code>方法把任意对象序列化成一个<code>bytes</code>，然后，就可以把这个<code>bytes</code>写入文件了。</p> <p>格式：<code>pickle.dumps(obj, protocol=None)</code></p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">import</span> pickle
d <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'Bob'</span><span class="token punctuation">,</span> age<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">,</span> score<span class="token operator">=</span><span class="token number">88</span><span class="token punctuation">)</span>
p <span class="token operator">=</span> pickle<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>d<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span>
</code></pre></div><h3 id="存入文件"><a href="#存入文件" aria-hidden="true" class="header-anchor">#</a> 存入文件</h3> <p><code>pickle.dump()</code>方法可以直接把对象序列化后写入一个file-like Object。</p> <p>格式: <code>pickle.dump(obj, file, protocol=None)</code></p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">import</span> pickle
d <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'Bob'</span><span class="token punctuation">,</span> age<span class="token operator">=</span><span class="token number">20</span><span class="token punctuation">,</span> score<span class="token operator">=</span><span class="token number">88</span><span class="token punctuation">)</span>
f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'dump.txt'</span><span class="token punctuation">,</span> <span class="token string">'wb'</span><span class="token punctuation">)</span>
pickle<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>d<span class="token punctuation">,</span> f<span class="token punctuation">)</span>
f<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'./dump.txt'</span><span class="token punctuation">,</span> <span class="token string">'rb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># b'\x80\x03}q\x00(X\x04\x00\x00\x00nameq\x01X\x03\x00\x00\x00Bobq\x02X\x03\x00\x00\x00ageq\x03K\x14X\x05\x00\x00\x00scoreq\x04KXu.'</span>
</code></pre></div><h3 id="反序列化-2"><a href="#反序列化-2" aria-hidden="true" class="header-anchor">#</a> 反序列化</h3> <p><code>pickle.load()</code>方法反序列化出对象，也可以直接用<code>pickle.load()</code>方法从一个<code>bytes-like Object</code>中直接反序列化出对象。</p> <p>格式：<code>pickle.load(file)</code></p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'./dump.txt'</span><span class="token punctuation">,</span> <span class="token string">'rb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    d <span class="token operator">=</span> pickle<span class="token punctuation">.</span>load<span class="token punctuation">(</span>f<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span>
<span class="token comment"># {'name': 'Bob', 'age': 20, 'score': 88}</span>
</code></pre></div><p>如果打开的文件不是 <code>bytes-like Object</code> 则会报错</p> <div class="danger custom-block"><p class="custom-block-title">TypeError</p> <p>a bytes-like object is required, not 'str'</p></div></div><div class="article-info"><div class="article-title">文档信息</div><p class="article-item">版权声明：著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。</p><p class="article-item">文章标题：IO操作</p><p class="article-item">原文链接：<a href="https://www.xiaoyulive.top/categories/python/_books/python/module/IO.html">https://www.xiaoyulive.top/categories/python/_books/python/module/IO.html</a></p><!----></div><!----><div class="content page-nav"><p class="inner"><span class="prev">← <a href="/categories/python/_books/python/module/Regex.html">正则表达式</a></span><span class="next"><a href="/categories/python/_books/python/module/Socket.html">网络套接字</a>  →</span></p></div></div><div class="footers" data-v-38547c78><p data-v-38547c78><span data-v-38547c78>MIT Licensed | Copyright © 2018-present  滇ICP备16006294号</span></p><p data-v-38547c78><span data-v-38547c78>Design by <a href="/">Quanzaiyu</a> | Power by <a href="https://vuepress.vuejs.org/" target="_blank">VuePress</a> | Hosted by <a href="https://pages.coding.me" target="_blank" style="font-weight: bold">Coding Pages</a></span></p></div></div><div class="global-ui"><!----><!----></div></div>
    <script src="/assets/js/app.795b447f.js" defer></script><script src="/assets/js/5.02c6f39a.js" defer></script>
  </body>
</html>
