<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>数据库操作之MySQL | 小昱个人网站</title>
    <meta name="description" content="小昱个人网站">
    <meta http-equiv="Expires" content="Mon,12 May 2050 00:20:00 GMT">
  <link rel="icon" href="/logo.png">
  <link rel="manifest" href="/manifest.json">
  <link rel="stylesheet" href="//at.alicdn.com/t/font_517060_lom78h954w.css">
  <link rel="stylesheet" href="https://img.xiaoyulive.top/css/animate.css">
    
    <link rel="preload" href="/assets/css/0.styles.d5495972.css" as="style"><link rel="preload" href="/assets/js/app.a1fa28c0.js" as="script"><link rel="preload" href="/assets/js/5.efabbda7.js" as="script"><link rel="prefetch" href="/assets/js/1.8d0c90f4.js"><link rel="prefetch" href="/assets/js/10.1e044dae.js"><link rel="prefetch" href="/assets/js/11.a456cb84.js"><link rel="prefetch" href="/assets/js/12.1c3ca95b.js"><link rel="prefetch" href="/assets/js/13.6eb93682.js"><link rel="prefetch" href="/assets/js/14.79c3b3c2.js"><link rel="prefetch" href="/assets/js/15.c61be471.js"><link rel="prefetch" href="/assets/js/2.d91e25f2.js"><link rel="prefetch" href="/assets/js/6.6448af6d.js"><link rel="prefetch" href="/assets/js/7.f3de0c54.js"><link rel="prefetch" href="/assets/js/8.98dd9a26.js"><link rel="prefetch" href="/assets/js/9.3f005558.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.26415d36.js">
    <link rel="stylesheet" href="/assets/css/0.styles.d5495972.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-38547c78><header class="navbar" data-v-38547c78><div class="navbar-content"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div><a href="/" class="home-link router-link-active"><img src="/logo.png" class="logo"><span class="site-name can-hide">小昱个人网站</span></a><div class="links"><nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link">开发者博客</a></div><div class="nav-item"><a href="/articles/" class="nav-link">生活漫谈</a></div><div class="nav-item"><a href="/note/" class="nav-link">阅读札记</a></div><div class="nav-item"><a href="/categories/" class="nav-link router-link-active">学无止境</a></div><div class="nav-item"><a href="/share/" class="nav-link">精品分享</a></div><div class="nav-item"><a href="/favorite/" class="nav-link">收藏夹</a></div><!----></nav><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""><!----></div></div></div></header><div class="sidebar-mask" data-v-38547c78></div><div class="sidebar" data-v-38547c78><div class="sidebar-container"><nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link">开发者博客</a></div><div class="nav-item"><a href="/articles/" class="nav-link">生活漫谈</a></div><div class="nav-item"><a href="/note/" class="nav-link">阅读札记</a></div><div class="nav-item"><a href="/categories/" class="nav-link router-link-active">学无止境</a></div><div class="nav-item"><a href="/share/" class="nav-link">精品分享</a></div><div class="nav-item"><a href="/favorite/" class="nav-link">收藏夹</a></div><!----></nav><ul class="sidebar-links"><li><div class="sidebar-group first collapsable"><p class="sidebar-heading"><span>Python3 学习指南</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>基础</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>数据类型</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>函数</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>进阶</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>面向对象</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading open"><span>模块</span> <span class="arrow down"></span></p> <ul class="sidebar-group-items"><li><a href="/categories/python/_books/python/module/" class="sidebar-link">模块</a></li><li><a href="/categories/python/_books/python/module/Package.html" class="sidebar-link">包</a></li><li><a href="/categories/python/_books/python/module/System.html" class="sidebar-link">系统相关</a></li><li><a href="/categories/python/_books/python/module/Time.html" class="sidebar-link">时间相关</a></li><li><a href="/categories/python/_books/python/module/Regex.html" class="sidebar-link">正则表达式</a></li><li><a href="/categories/python/_books/python/module/IO.html" class="sidebar-link">IO操作</a></li><li><a href="/categories/python/_books/python/module/Socket.html" class="sidebar-link">网络套接字</a></li><li><a href="/categories/python/_books/python/module/MySQL.html" class="active sidebar-link">数据库操作之MySQL</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/categories/python/_books/python/module/MySQL.html#简单使用" class="sidebar-link">简单使用</a></li><li class="sidebar-sub-header"><a href="/categories/python/_books/python/module/MySQL.html#crud" class="sidebar-link">CRUD</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/categories/python/_books/python/module/MySQL.html#_1-创建数据表" class="sidebar-link">1. 创建数据表</a></li><li class="sidebar-sub-header"><a href="/categories/python/_books/python/module/MySQL.html#_2-插入数据" class="sidebar-link">2. 插入数据</a></li><li class="sidebar-sub-header"><a href="/categories/python/_books/python/module/MySQL.html#_3-查询数据" class="sidebar-link">3. 查询数据</a></li><li class="sidebar-sub-header"><a href="/categories/python/_books/python/module/MySQL.html#_4-更新操作" class="sidebar-link">4. 更新操作</a></li><li class="sidebar-sub-header"><a href="/categories/python/_books/python/module/MySQL.html#_5-删除操作" class="sidebar-link">5. 删除操作</a></li></ul></li><li class="sidebar-sub-header"><a href="/categories/python/_books/python/module/MySQL.html#使用参考" class="sidebar-link">使用参考</a></li></ul></li><li><a href="/categories/python/_books/python/module/Other.html" class="sidebar-link">其他</a></li></ul></div></li></ul></div></div><div class="page" data-v-38547c78><div class="content__default"><h1 id="数据库操作之mysql"><a href="#数据库操作之mysql" aria-hidden="true" class="header-anchor">#</a> 数据库操作之MySQL</h1> <p>PyMySQL 是在 Python3.x 版本中用于连接 MySQL 服务器的一个库。</p> <ul><li><a href="https://pymysql.readthedocs.io/en/latest/index.html" target="_blank" rel="noopener noreferrer">PyMySQL 官网文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li><a href="http://www.runoob.com/python3/python3-mysql.html" target="_blank" rel="noopener noreferrer">Python3 MySQL 数据库连接 - PyMySQL 驱动<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <p>安装:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ pip3 <span class="token function">install</span> PyMySQL
</code></pre></div><ul><li>连接: 与数据库建立的通讯, 使用完后需要关闭</li> <li>游标: 处理数据的一种方法，游标提供了在结果集中一次一行或者多行前进或向后浏览数据的能力</li></ul> <h2 id="简单使用"><a href="#简单使用" aria-hidden="true" class="header-anchor">#</a> 简单使用</h2> <p>使用步骤:</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment">#!/usr/bin/python3</span>
<span class="token keyword">import</span> pymysql

<span class="token comment"># 打开数据库连接</span>
db <span class="token operator">=</span> pymysql<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token string">&quot;localhost&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;root&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;root&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;test&quot;</span> <span class="token punctuation">)</span>

<span class="token comment"># 使用 cursor() 方法创建一个游标对象 cursor</span>
cursor <span class="token operator">=</span> db<span class="token punctuation">.</span>cursor<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 使用 execute()  方法执行 SQL 查询</span>
cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">&quot;SELECT VERSION()&quot;</span><span class="token punctuation">)</span>

<span class="token comment"># 使用 fetchone() 方法获取单条数据.</span>
data <span class="token operator">=</span> cursor<span class="token punctuation">.</span>fetchone<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">&quot;Database version : %s &quot;</span> <span class="token operator">%</span> data<span class="token punctuation">)</span>

<span class="token comment"># 关闭数据库连接</span>
db<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p>或</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment">#!/usr/bin/python3</span>
<span class="token keyword">import</span> pymysql<span class="token punctuation">.</span>cursors

connection <span class="token operator">=</span> pymysql<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'localhost'</span><span class="token punctuation">,</span>
                             user<span class="token operator">=</span><span class="token string">'root'</span><span class="token punctuation">,</span>
                             password<span class="token operator">=</span><span class="token string">'root'</span><span class="token punctuation">,</span>
                             db<span class="token operator">=</span><span class="token string">'test'</span><span class="token punctuation">,</span>
                             charset<span class="token operator">=</span><span class="token string">'utf8mb4'</span><span class="token punctuation">,</span>
                             cursorclass<span class="token operator">=</span>pymysql<span class="token punctuation">.</span>cursors<span class="token punctuation">.</span>DictCursor<span class="token punctuation">)</span>

<span class="token keyword">try</span><span class="token punctuation">:</span>
    <span class="token keyword">with</span> connection<span class="token punctuation">.</span>cursor<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> cursor<span class="token punctuation">:</span>
        sql <span class="token operator">=</span> <span class="token string">&quot;SELECT * FROM `img` WHERE `title` like %s&quot;</span>
        cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>sql<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'%大%'</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        result <span class="token operator">=</span> cursor<span class="token punctuation">.</span>fetchall<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
<span class="token keyword">finally</span><span class="token punctuation">:</span>
    connection<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><ol><li>pymysql.connect 链接数据库, 顺序传入 <code>host, user, password, db</code>, 也可使用命名参数的方式传递</li> <li>db.cursor 创建游标, 以操作数据库</li> <li>cursor.execute 执行 SQL 语句</li> <li>fetchone/fetchall 查询一条或多条数据</li></ol> <h2 id="crud"><a href="#crud" aria-hidden="true" class="header-anchor">#</a> CRUD</h2> <h3 id="_1-创建数据表"><a href="#_1-创建数据表" aria-hidden="true" class="header-anchor">#</a> 1. 创建数据表</h3> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment">#!/usr/bin/python3</span>
<span class="token keyword">import</span> pymysql

<span class="token comment"># 打开数据库连接</span>
db <span class="token operator">=</span> pymysql<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token string">&quot;localhost&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;root&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;root&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;test&quot;</span> <span class="token punctuation">)</span>

<span class="token comment"># 使用 cursor() 方法创建一个游标对象 cursor</span>
cursor <span class="token operator">=</span> db<span class="token punctuation">.</span>cursor<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 使用 execute() 方法执行 SQL，如果表存在则删除</span>
cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">&quot;DROP TABLE IF EXISTS EMPLOYEE&quot;</span><span class="token punctuation">)</span>

<span class="token comment"># 使用预处理语句创建表</span>
sql <span class="token operator">=</span> <span class="token triple-quoted-string string">&quot;&quot;&quot;
      CREATE TABLE EMPLOYEE (
         FIRST_NAME CHAR(20) NOT NULL,
         LAST_NAME CHAR(20),
         AGE INT,
         SEX CHAR(1),
         INCOME FLOAT
      )
      &quot;&quot;&quot;</span>

cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>sql<span class="token punctuation">)</span>

<span class="token comment"># 关闭数据库连接</span>
db<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="_2-插入数据"><a href="#_2-插入数据" aria-hidden="true" class="header-anchor">#</a> 2. 插入数据</h3> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment">#!/usr/bin/python3</span>
<span class="token keyword">import</span> pymysql

<span class="token comment"># 打开数据库连接</span>
db <span class="token operator">=</span> pymysql<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token string">&quot;localhost&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;root&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;root&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;test&quot;</span> <span class="token punctuation">)</span>

<span class="token comment"># 使用cursor()方法获取操作游标</span>
cursor <span class="token operator">=</span> db<span class="token punctuation">.</span>cursor<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># SQL 插入语句</span>
sql <span class="token operator">=</span> <span class="token triple-quoted-string string">&quot;&quot;&quot;
        INSERT INTO EMPLOYEE(FIRST_NAME,LAST_NAME, AGE, SEX, INCOME)
        VALUES ('Mac', 'Mohan', 20, 'M', 2000)
      &quot;&quot;&quot;</span>
<span class="token keyword">try</span><span class="token punctuation">:</span>
   <span class="token comment"># 执行sql语句</span>
   cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>sql<span class="token punctuation">)</span>
   <span class="token comment"># 提交到数据库执行</span>
   db<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">except</span><span class="token punctuation">:</span>
   <span class="token comment"># 如果发生错误则回滚</span>
   db<span class="token punctuation">.</span>rollback<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 关闭数据库连接</span>
db<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p>以上 SQL 语句也可写为:</p> <div class="language-python extra-class"><pre class="language-python"><code>sql <span class="token operator">=</span> <span class="token triple-quoted-string string">&quot;&quot;&quot;
        INSERT INTO EMPLOYEE(FIRST_NAME,
        LAST_NAME, AGE, SEX, INCOME)
        VALUES (%s, %s,  %s,  %s,  %s )
      &quot;&quot;&quot;</span>
cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>sql<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'Mac'</span><span class="token punctuation">,</span> <span class="token string">'Mohan'</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token string">'M'</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="_3-查询数据"><a href="#_3-查询数据" aria-hidden="true" class="header-anchor">#</a> 3. 查询数据</h3> <ul><li>fetchone(): 该方法获取下一个查询结果集。结果集是一个对象</li> <li>fetchall(): 接收全部的返回结果行.</li> <li>rowcount: 这是一个只读属性，并返回执行execute()方法后影响的行数。</li></ul> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment">#!/usr/bin/python3</span>
<span class="token keyword">import</span> pymysql

<span class="token comment"># 打开数据库连接</span>
db <span class="token operator">=</span> pymysql<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token string">&quot;localhost&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;root&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;root&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;test&quot;</span> <span class="token punctuation">)</span>

<span class="token comment"># 使用cursor()方法获取操作游标</span>
cursor <span class="token operator">=</span> db<span class="token punctuation">.</span>cursor<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># SQL 查询语句</span>
sql <span class="token operator">=</span> &quot;SELECT <span class="token operator">*</span> FROM EMPLOYEE \
       WHERE INCOME <span class="token operator">&gt;</span> <span class="token operator">%</span>s&quot; <span class="token operator">%</span> <span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span>
<span class="token keyword">try</span><span class="token punctuation">:</span>
   <span class="token comment"># 执行SQL语句</span>
   cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>sql<span class="token punctuation">)</span>
   <span class="token comment"># 获取所有记录列表</span>
   results <span class="token operator">=</span> cursor<span class="token punctuation">.</span>fetchall<span class="token punctuation">(</span><span class="token punctuation">)</span>
   <span class="token keyword">for</span> row <span class="token keyword">in</span> results<span class="token punctuation">:</span>
      fname <span class="token operator">=</span> row<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
      lname <span class="token operator">=</span> row<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
      age <span class="token operator">=</span> row<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>
      sex <span class="token operator">=</span> row<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span>
      income <span class="token operator">=</span> row<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span>
      <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">&quot;fname=%s,lname=%s,age=%s,sex=%s,income=%s&quot;</span> <span class="token operator">%</span> \
             <span class="token punctuation">(</span>fname<span class="token punctuation">,</span> lname<span class="token punctuation">,</span> age<span class="token punctuation">,</span> sex<span class="token punctuation">,</span> income <span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token comment"># 打印结果: fname=Mac,lname=Mohan,age=20,sex=M,income=2000.0</span>
<span class="token keyword">except</span><span class="token punctuation">:</span>
   <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">&quot;Error: unable to fetch data&quot;</span><span class="token punctuation">)</span>

<span class="token comment"># 关闭数据库连接</span>
db<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="_4-更新操作"><a href="#_4-更新操作" aria-hidden="true" class="header-anchor">#</a> 4. 更新操作</h3> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment">#!/usr/bin/python3</span>
<span class="token keyword">import</span> pymysql

<span class="token comment"># 打开数据库连接</span>
db <span class="token operator">=</span> pymysql<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token string">&quot;localhost&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;root&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;root&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;test&quot;</span> <span class="token punctuation">)</span>

<span class="token comment"># 使用cursor()方法获取操作游标</span>
cursor <span class="token operator">=</span> db<span class="token punctuation">.</span>cursor<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># SQL 更新语句</span>
sql <span class="token operator">=</span> <span class="token string">&quot;UPDATE EMPLOYEE SET INCOME = INCOME + 100 WHERE SEX = '%c'&quot;</span> <span class="token operator">%</span> <span class="token punctuation">(</span><span class="token string">'M'</span><span class="token punctuation">)</span>
<span class="token keyword">try</span><span class="token punctuation">:</span>
   <span class="token comment"># 执行SQL语句</span>
   cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>sql<span class="token punctuation">)</span>
   <span class="token comment"># 提交到数据库执行</span>
   db<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">except</span><span class="token punctuation">:</span>
   <span class="token comment"># 发生错误时回滚</span>
   db<span class="token punctuation">.</span>rollback<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 关闭数据库连接</span>
db<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="_5-删除操作"><a href="#_5-删除操作" aria-hidden="true" class="header-anchor">#</a> 5. 删除操作</h3> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment">#!/usr/bin/python3</span>
<span class="token keyword">import</span> pymysql

<span class="token comment"># 打开数据库连接</span>
db <span class="token operator">=</span> pymysql<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token string">&quot;localhost&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;root&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;root&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;test&quot;</span> <span class="token punctuation">)</span>

<span class="token comment"># 使用cursor()方法获取操作游标</span>
cursor <span class="token operator">=</span> db<span class="token punctuation">.</span>cursor<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># SQL 删除语句</span>
sql <span class="token operator">=</span> <span class="token string">&quot;DELETE FROM EMPLOYEE WHERE AGE &gt;= %s&quot;</span> <span class="token operator">%</span> <span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span>
<span class="token keyword">try</span><span class="token punctuation">:</span>
   <span class="token comment"># 执行SQL语句</span>
   cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>sql<span class="token punctuation">)</span>
   <span class="token comment"># 提交修改</span>
   db<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">except</span><span class="token punctuation">:</span>
   <span class="token comment"># 发生错误时回滚</span>
   db<span class="token punctuation">.</span>rollback<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 关闭连接</span>
db<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="使用参考"><a href="#使用参考" aria-hidden="true" class="header-anchor">#</a> 使用参考</h2> <ol><li>事务</li></ol> <ul><li>cursor.commit() 方法提交游标的所有更新操作</li> <li>cursor.rollback() 方法回滚当前游标的所有操作</li></ul> <ol start="2"><li>查询</li></ol> <ul><li>cursor.fetchone() 返回第一条查询结果</li> <li>cursor.fetchall() 返回所有查询结果</li></ul> <ol start="3"><li>执行</li></ol> <ul><li>cursor.execute() 执行SQL语句</li></ul> <ol start="4"><li>连接与关闭</li></ol> <ul><li>pymysql.connect(host, user, password, db) 连接数据库</li> <li>connection.close() 关闭数据库</li> <li>connection.cursor() 创建游标</li></ul></div><div class="article-info"><div class="article-title">文档信息</div><p class="article-item">版权声明：著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。</p><p class="article-item">文章标题：数据库操作之MySQL</p><p class="article-item">原文链接：<a href="https://www.xiaoyulive.top/categories/python/_books/python/module/MySQL.html">https://www.xiaoyulive.top/categories/python/_books/python/module/MySQL.html</a></p><!----></div><!----><div class="content page-nav"><p class="inner"><span class="prev">← <a href="/categories/python/_books/python/module/Socket.html">网络套接字</a></span><span class="next"><a href="/categories/python/_books/python/module/Other.html">其他</a>  →</span></p></div></div><div class="footers" data-v-38547c78><p data-v-38547c78><span data-v-38547c78>MIT Licensed | Copyright © 2018-present  滇ICP备16006294号</span></p><p data-v-38547c78><span data-v-38547c78>Design by <a href="/">Quanzaiyu</a> | Power by <a href="https://vuepress.vuejs.org/" target="_blank">VuePress</a> | Hosted by <a href="https://pages.coding.me" target="_blank" style="font-weight: bold">Coding Pages</a></span></p></div></div><div class="global-ui"><!----><!----></div></div>
    <script src="/assets/js/app.a1fa28c0.js" defer></script><script src="/assets/js/5.efabbda7.js" defer></script>
  </body>
</html>
