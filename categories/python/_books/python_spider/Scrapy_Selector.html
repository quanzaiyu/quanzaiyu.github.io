<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Scrapy: Selector选择器 | 小昱个人网站</title>
    <meta name="description" content="小昱个人网站">
    <meta http-equiv="Expires" content="Mon,12 May 2050 00:20:00 GMT">
  <meta name="keywords" content="小昱,个人网站,Vue,JavaScript,HTML,CSS">
  <link rel="icon" href="/logo.png">
  <link rel="manifest" href="/manifest.json">
  <link rel="stylesheet" href="//at.alicdn.com/t/font_517060_lom78h954w.css">
  <link rel="stylesheet" href="https://img.xiaoyulive.top/css/animate.css">
    
    <link rel="preload" href="/assets/css/0.styles.e2d81a46.css" as="style"><link rel="preload" href="/assets/js/app.a8079cf5.js" as="script"><link rel="preload" href="/assets/js/5.b2d88b04.js" as="script"><link rel="prefetch" href="/assets/js/1.eaa33edf.js"><link rel="prefetch" href="/assets/js/10.38acf979.js"><link rel="prefetch" href="/assets/js/11.fc2d78c1.js"><link rel="prefetch" href="/assets/js/12.127174aa.js"><link rel="prefetch" href="/assets/js/13.9facbb15.js"><link rel="prefetch" href="/assets/js/14.09023cd3.js"><link rel="prefetch" href="/assets/js/15.5e3bfa95.js"><link rel="prefetch" href="/assets/js/2.8690f1f9.js"><link rel="prefetch" href="/assets/js/6.9cfaa079.js"><link rel="prefetch" href="/assets/js/7.12d7389a.js"><link rel="prefetch" href="/assets/js/8.2a2bed59.js"><link rel="prefetch" href="/assets/js/9.38d16243.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.9ca4b8ed.js">
    <link rel="stylesheet" href="/assets/css/0.styles.e2d81a46.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-38547c78><header class="navbar" data-v-38547c78><div class="navbar-content"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div><a href="/" class="home-link router-link-active"><img src="/logo.png" class="logo"><span class="site-name can-hide">小昱个人网站</span></a><div class="links"><nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link">开发者博客</a></div><div class="nav-item"><a href="/articles/" class="nav-link">生活漫谈</a></div><div class="nav-item"><a href="/note/" class="nav-link">阅读札记</a></div><div class="nav-item"><a href="/categories/" class="nav-link router-link-active">学无止境</a></div><div class="nav-item"><a href="/share/" class="nav-link">精品分享</a></div><div class="nav-item"><a href="/favorite/" class="nav-link">收藏夹</a></div><!----></nav><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""><!----></div></div></div></header><div class="sidebar-mask" data-v-38547c78></div><div class="sidebar" data-v-38547c78><div class="sidebar-container"><nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link">开发者博客</a></div><div class="nav-item"><a href="/articles/" class="nav-link">生活漫谈</a></div><div class="nav-item"><a href="/note/" class="nav-link">阅读札记</a></div><div class="nav-item"><a href="/categories/" class="nav-link router-link-active">学无止境</a></div><div class="nav-item"><a href="/share/" class="nav-link">精品分享</a></div><div class="nav-item"><a href="/favorite/" class="nav-link">收藏夹</a></div><!----></nav><ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>Python 爬虫实践</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/categories/python/_books/python_spider/" class="sidebar-link">Python 爬虫</a></li><li><a href="/categories/python/_books/python_spider/Intro.html" class="sidebar-link">简介</a></li><li><a href="/categories/python/_books/python_spider/Requests.html" class="sidebar-link">请求模块 - Requests</a></li><li><a href="/categories/python/_books/python_spider/Re.html" class="sidebar-link">正则模块 - re</a></li><li><a href="/categories/python/_books/python_spider/Bs4.html" class="sidebar-link">网页解析模块 - BeautifulSoup</a></li><li><a href="/categories/python/_books/python_spider/Pymysql.html" class="sidebar-link">数据库模块 - pymysql</a></li><li><a href="/categories/python/_books/python_spider/Scrapy.html" class="sidebar-link">爬虫框架 - Scrapy</a></li><li><a href="/categories/python/_books/python_spider/Scarpy_Basis.html" class="sidebar-link">Scrapy: 基础概念</a></li><li><a href="/categories/python/_books/python_spider/Scrapy_Simple.html" class="sidebar-link">Scrapy: 基础使用</a></li><li><a href="/categories/python/_books/python_spider/Scrapy_Selector.html" class="active sidebar-link">Scrapy: Selector选择器</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/categories/python/_books/python_spider/Scrapy_Selector.html#css-提取" class="sidebar-link">CSS 提取</a></li><li class="sidebar-sub-header"><a href="/categories/python/_books/python_spider/Scrapy_Selector.html#xpath-提取" class="sidebar-link">XPath 提取</a></li><li class="sidebar-sub-header"><a href="/categories/python/_books/python_spider/Scrapy_Selector.html#正则提取" class="sidebar-link">正则提取</a></li></ul></li><li><a href="/categories/python/_books/python_spider/Scrapy_Command.html" class="sidebar-link">Scrapy: 命令行</a></li><li><a href="/categories/python/_books/python_spider/Scrapy_File.html" class="sidebar-link">Scrapy: 存取为文本</a></li><li><a href="/categories/python/_books/python_spider/Scrapy_Image.html" class="sidebar-link">Scrapy: 存取为图片</a></li><li><a href="/categories/python/_books/python_spider/Scrapy_Mysql.html" class="sidebar-link">Scrapy: 存取到 MySQL</a></li><li><a href="/categories/python/_books/python_spider/Reference.html" class="sidebar-link">参考资料</a></li></ul></div></li></ul></div></div><div class="page" data-v-38547c78><div class="content__default"><h1 id="scrapy-selector选择器"><a href="#scrapy-selector选择器" aria-hidden="true" class="header-anchor">#</a> Scrapy: Selector选择器</h1> <p>当我们取得了网页的response之后，最关键的就是如何从繁杂的网页中把我们需要的数据提取出来，python从网页中提取数据的包很多，常用的有下面的几个：</p> <ul><li>BeautifulSoup 它基于HTML代码的结构来构造一个Python对象， 对不良标记的处理也非常合理，但是速度上有所欠缺。</li> <li>lxml 是一个基于 ElementTree (不是Python标准库的一部分)的python化的XML解析库(也可以解析HTML)。</li></ul> <p>你可以在scrapy中使用任意你熟悉的网页数据提取工具，但是，scrapy本身也为我们提供了一套提取数据的机制，我们称之为选择器(seletors)，他们通过特定的 XPath 或者 CSS 表达式来“选择” HTML文件中的某个部分。XPath 是一门用来在XML文件中选择节点的语言，也可以用在HTML上。 CSS 是一门将HTML文档样式化的语言。选择器由它定义，并与特定的HTML元素的样式相关连。</p> <p>Scrapy选择器构建于 lxml 库之上，这意味着它们在速度和解析准确性上非常相似。</p> <p>示例: 使用 Selector 的 css 或 xpath 方法提取 www.xiaoyulive.top 的标题</p> <p>css 提取</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">import</span> scrapy
<span class="token keyword">from</span> scrapy<span class="token punctuation">.</span>selector <span class="token keyword">import</span> Selector

<span class="token keyword">class</span> <span class="token class-name">test</span><span class="token punctuation">(</span>scrapy<span class="token punctuation">.</span>Spider<span class="token punctuation">)</span><span class="token punctuation">:</span>
    name <span class="token operator">=</span> <span class="token string">&quot;xiaoyu&quot;</span>
    start_urls <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'https://www.xiaoyulive.top/'</span><span class="token punctuation">]</span>
    <span class="token keyword">def</span> <span class="token function">parse</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">:</span>
        selector <span class="token operator">=</span> Selector<span class="token punctuation">(</span>response<span class="token operator">=</span>response<span class="token punctuation">)</span>
        title <span class="token operator">=</span> selector<span class="token punctuation">.</span>css<span class="token punctuation">(</span><span class="token string">'head title::text'</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>title<span class="token punctuation">)</span>
</code></pre></div><p>xpath 提取</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">import</span> scrapy
<span class="token keyword">from</span> scrapy<span class="token punctuation">.</span>selector <span class="token keyword">import</span> Selector

<span class="token keyword">class</span> <span class="token class-name">test</span><span class="token punctuation">(</span>scrapy<span class="token punctuation">.</span>Spider<span class="token punctuation">)</span><span class="token punctuation">:</span>
    name <span class="token operator">=</span> <span class="token string">&quot;xiaoyu&quot;</span>
    start_urls <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'https://www.xiaoyulive.top/'</span><span class="token punctuation">]</span>
    <span class="token keyword">def</span> <span class="token function">parse</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">:</span>
        selector <span class="token operator">=</span> Selector<span class="token punctuation">(</span>response<span class="token operator">=</span>response<span class="token punctuation">)</span>
        title <span class="token operator">=</span> selector<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'//title/text()'</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>title<span class="token punctuation">)</span>
</code></pre></div><p>选择器的使用可以分为下面的三步：</p> <ol><li>导入选择器 <code>from scrapy.selector import Selector</code></li> <li>创建选择器实例 <code>selector = Selector(response=response)</code></li> <li>使用选择器 <code>selector.xpath()</code> 或者 <code>selector.css()</code></li></ol> <p>当然你可以使用xpath或者css中的任意一种或者组合使用，怎么方便怎么来。仔细观察，你会发现每个选择器最后都有一个 <code>extract()</code>，你可以尝试去掉这个看一下，区别在于:</p> <ul><li>当你没有使用 <code>extract()</code> 的时候，提取出来的内容依然具有选择器属性，简而言之，你可以继续使用里面的内容进行提取下级内容</li> <li>当你使用了 <code>extract()</code> 之后，提取出来的内容就会变成字符串格式了。我们进行多级提取的时候，这会很有用。值得注意的是，选择器提取出来的内容是放在列表里面的，即使没有内容，那也是一个空列表，下面我们运行这个爬虫，你会发现内容已经被提取出来了</li></ul> <h2 id="css-提取"><a href="#css-提取" aria-hidden="true" class="header-anchor">#</a> CSS 提取</h2> <p>使用示例:</p> <div class="language-python extra-class"><pre class="language-python"><code>response<span class="token punctuation">.</span>css<span class="token punctuation">(</span><span class="token string">'title'</span><span class="token punctuation">)</span> <span class="token comment"># 提取整条title标签</span>
response<span class="token punctuation">.</span>css<span class="token punctuation">(</span><span class="token string">'title::text'</span><span class="token punctuation">)</span> <span class="token comment"># 提取title的InnerHTML(内容)</span>
response<span class="token punctuation">.</span>css<span class="token punctuation">(</span><span class="token string">&quot;.content img::attr(src)&quot;</span><span class="token punctuation">)</span> <span class="token comment"># 提取img的src属性值</span>
response<span class="token punctuation">.</span>css<span class="token punctuation">(</span><span class="token string">&quot;.navigator a::attr(href)&quot;</span><span class="token punctuation">)</span> <span class="token comment"># 提取a标签的href属性值</span>
</code></pre></div><p>一些常用的选择器</p> <table><thead><tr><th>选择器</th> <th>示例</th> <th>示例说明</th></tr></thead> <tbody><tr><td>.class</td> <td>.intro</td> <td>选择所有class=&quot;intro&quot;的元素</td></tr> <tr><td>#id</td> <td>#firstname</td> <td>选择所有id=&quot;firstname&quot;的元素</td></tr> <tr><td>*</td> <td>*</td> <td>选择所有元素</td></tr> <tr><td>element</td> <td>p</td> <td>选择所有&lt;p&gt;元素</td></tr> <tr><td>element,element</td> <td>div,p</td> <td>选择所有&lt;div&gt;元素和&lt;p&gt;元素</td></tr> <tr><td>element element</td> <td>div p</td> <td>选择&lt;div&gt;元素内的所有&lt;p&gt;元素</td></tr> <tr><td>element&gt;element</td> <td>div&gt;p</td> <td>选择所有父级是&lt;div&gt;元素的&lt;p&gt;元素</td></tr> <tr><td>element+element</td> <td>div+p</td> <td>选择所有紧接着&lt;div&gt;元素之后的&lt;p&gt;元素</td></tr> <tr><td>element1~element2</td> <td>p~ul</td> <td>选择&lt;p&gt;元素之后的每一个&lt;ul&gt;元素</td></tr> <tr><td>[attribute]</td> <td>[target]</td> <td>选择所有带有target属性元素</td></tr> <tr><td>[attribute=&quot;value&quot;]</td> <td>[target=_blank]</td> <td>选择所有使用target=&quot;_blank&quot;的元素</td></tr> <tr><td>[attribute~=&quot;value&quot;]</td> <td>[title~=flower]</td> <td>选择title属性包含单词&quot;flower&quot;的所有元素</td></tr> <tr><td>[attribute^=&quot;value&quot;]</td> <td>img[src^=&quot;https&quot;]</td> <td>选择每一个src属性的值以&quot;https&quot;开头的元素</td></tr> <tr><td>[attribute$=&quot;value&quot;]</td> <td>img[src$=&quot;.pdf&quot;]</td> <td>选择每一个src属性的值以&quot;.pdf&quot;结尾的元素</td></tr> <tr><td>[attribute*=&quot;value&quot;]</td> <td>img[src*=&quot;runoob&quot;]</td> <td>选择每一个src属性的值包含子字符串&quot;runoob&quot;的元素</td></tr> <tr><td>:link</td> <td>a:link</td> <td>选择所有未访问链接</td></tr> <tr><td>:visited</td> <td>a:visited</td> <td>选择所有访问过的链接</td></tr> <tr><td>:active</td> <td>a:active</td> <td>选择活动链接</td></tr> <tr><td>:hover</td> <td>a:hover</td> <td>选择鼠标在链接上面时</td></tr> <tr><td>:before</td> <td>p:before</td> <td>在每个&lt;p&gt;元素之前的伪元素</td></tr> <tr><td>:after</td> <td>p:after</td> <td>在每个&lt;p&gt;元素之后的伪元素</td></tr> <tr><td>:nth-child(n)</td> <td>p:nth-child(2)</td> <td>选择每个p元素是其父级的第二个子元素</td></tr> <tr><td>:nth-of-type(n)</td> <td>p:nth-of-type(2)</td> <td>选择每个p元素是其父级的第二个p元素</td></tr> <tr><td>:nth-last-child(n)</td> <td>p:nth-last-child(2)</td> <td>选择每个p元素的是其父级的第二个子元素，从最后一个子项计数</td></tr> <tr><td>:nth-last-of-type(n)</td> <td>p:nth-last-of-type(2)</td> <td>选择每个p元素的是其父级的第二个p元素，从最后一个子项计数</td></tr> <tr><td>:first-child</td> <td>p:first-child</td> <td>选择每个p元素是其父级的第一个子级。</td></tr> <tr><td>:last-child</td> <td>p:last-child</td> <td>选择每个p元素是其父级的最后一个子级。</td></tr> <tr><td>:focus</td> <td>input:focus</td> <td>选择具有焦点的输入元素</td></tr> <tr><td>:checked</td> <td>input:checked</td> <td>选择每个选中的输入元素</td></tr> <tr><td>:not(selector)</td> <td>:not(p)</td> <td>选择每个并非p元素的元素</td></tr> <tr><td>:first-letter</td> <td>p:first-letter</td> <td>选择每一个&lt;p&gt;元素的第一个字母</td></tr> <tr><td>:first-line</td> <td>p:first-line</td> <td>选择每一个&lt;p&gt;元素的第一行</td></tr></tbody></table> <h2 id="xpath-提取"><a href="#xpath-提取" aria-hidden="true" class="header-anchor">#</a> XPath 提取</h2> <p>使用示例:</p> <div class="language-python extra-class"><pre class="language-python"><code>response<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">&quot;//@href&quot;</span><span class="token punctuation">)</span>
response<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">&quot;//ol//@href&quot;</span><span class="token punctuation">)</span>
response<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">&quot;//ol[@class='page-navigator']//@href&quot;</span><span class="token punctuation">)</span>
response<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">&quot;//title//text()&quot;</span><span class="token punctuation">)</span>
response<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">&quot;//div[@class='post-content']//text()&quot;</span><span class="token punctuation">)</span>
response<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">&quot;string(//div[@class='post-content'])&quot;</span><span class="token punctuation">)</span>
</code></pre></div><p>XPath 表达式</p> <table><thead><tr><th>表达式</th> <th>描述</th></tr></thead> <tbody><tr><td>nodename</td> <td>选取此节点的所有子节点</td></tr> <tr><td>/</td> <td>从根节点选取</td></tr> <tr><td>//</td> <td>从匹配选择的当前节点选择文档中的节点，而不考虑它们的位置</td></tr> <tr><td>.</td> <td>选取当前节点</td></tr> <tr><td>..</td> <td>选取当前节点的父节点</td></tr> <tr><td>@</td> <td>选取属性</td></tr></tbody></table> <p>XPath 通配符可用来选取未知的 HTML元素。</p> <table><thead><tr><th>通配符</th> <th>描述</th></tr></thead> <tbody><tr><td>*</td> <td>匹配任何元素节点。</td></tr> <tr><td>@*</td> <td>匹配任何属性节点。</td></tr> <tr><td>node()</td> <td>匹配任何类型的节点。</td></tr></tbody></table> <p>在下面的表格中，我们列出了一些路径表达式，以及这些表达式的结果：</p> <table><thead><tr><th>路径表达式</th> <th>结果</th></tr></thead> <tbody><tr><td>/bookstore/*</td> <td>选取 bookstore 元素的所有子元素。</td></tr> <tr><td>//*</td> <td>选取文档中的所有元素。</td></tr> <tr><td>//title[@*]</td> <td>选取所有带有属性的 title 元素。</td></tr></tbody></table> <h2 id="正则提取"><a href="#正则提取" aria-hidden="true" class="header-anchor">#</a> 正则提取</h2> <p>如果我们想提取的内容不能使用一个选择器表示, 比如获取页脚的备案信息:</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">import</span> scrapy
<span class="token keyword">from</span> scrapy<span class="token punctuation">.</span>selector <span class="token keyword">import</span> Selector

<span class="token keyword">class</span> <span class="token class-name">test</span><span class="token punctuation">(</span>scrapy<span class="token punctuation">.</span>Spider<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment">#需要继承scrapy.Spider类</span>
    name <span class="token operator">=</span> <span class="token string">&quot;xiaoyu&quot;</span>
    start_urls <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'https://www.xiaoyulive.top/'</span><span class="token punctuation">]</span>
    <span class="token keyword">def</span> <span class="token function">parse</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">:</span>
        selector <span class="token operator">=</span> Selector<span class="token punctuation">(</span>response<span class="token operator">=</span>response<span class="token punctuation">)</span>
        text <span class="token operator">=</span> selector<span class="token punctuation">.</span>css<span class="token punctuation">(</span><span class="token string">'.footers&gt;p:first-child *::text'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>re<span class="token punctuation">(</span><span class="token string">r'\d{8}'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span>
</code></pre></div></div><div class="article-info"><div class="article-title">文档信息</div><p class="article-item">版权声明：著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。</p><p class="article-item">文章标题：Scrapy: Selector选择器</p><p class="article-item">原文链接：<a href="https://www.xiaoyulive.top/categories/python/_books/python_spider/Scrapy_Selector.html">https://www.xiaoyulive.top/categories/python/_books/python_spider/Scrapy_Selector.html</a></p><!----></div><!----><div class="content page-nav"><p class="inner"><span class="prev">← <a href="/categories/python/_books/python_spider/Scrapy_Simple.html">Scrapy: 基础使用</a></span><span class="next"><a href="/categories/python/_books/python_spider/Scrapy_Command.html">Scrapy: 命令行</a>  →</span></p></div></div><div class="footers" data-v-38547c78><p data-v-38547c78><span data-v-38547c78>MIT Licensed | Copyright © 2018-present  滇ICP备16006294号</span></p><p data-v-38547c78><span data-v-38547c78>Design by <a href="/">Quanzaiyu</a> | Power by <a href="https://vuepress.vuejs.org/" target="_blank">VuePress</a> | Hosted by <a href="https://pages.coding.me" target="_blank" style="font-weight: bold">Coding Pages</a></span></p></div></div><div class="global-ui"><!----><!----></div></div>
    <script src="/assets/js/app.a8079cf5.js" defer></script><script src="/assets/js/5.b2d88b04.js" defer></script>
  </body>
</html>
